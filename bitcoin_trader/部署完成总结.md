# 🎉 部署准备完成

## ✅ 已完成的工作

### 1. 代码准备
- ✅ EMA趋势策略已实现并测试通过
- ✅ 策略已切换到 `run_okx_live_demo.py`
- ✅ 所有代码已提交到GitHub
- ✅ 最新提交: ab5148f

### 2. 部署脚本
- ✅ `deploy_git.sh` - 自动化部署脚本
- ✅ `服务器部署命令.sh` - 手动部署命令
- ✅ `部署指南.md` - 详细部署文档

### 3. 文档
- ✅ EMA趋势策略说明
- ✅ 策略对比分析
- ✅ 测试脚本和示例
- ✅ 部署指南

---

## 🚀 立即部署

### 方法一：一键部署（推荐）

**在服务器上执行以下命令：**

```bash
# 1. SSH连接到服务器
ssh root@101.42.14.209
# 密码: czbcxy25809*

# 2. 执行一键部署命令
bash <(curl -s https://raw.githubusercontent.com/xingdong23/zhixing_trader/main/bitcoin_trader/服务器部署命令.sh)
```

### 方法二：手动部署

```bash
# 1. SSH连接
ssh root@101.42.14.209

# 2. 安装依赖
yum install -y git python3 python3-pip

# 3. 克隆代码
cd /opt
git clone https://github.com/xingdong23/zhixing_trader.git
cd zhixing_trader/bitcoin_trader

# 4. 安装Python依赖
pip3 install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# 5. 创建配置文件
cat > .env << 'EOF'
OKX_API_KEY=your_api_key_here
OKX_API_SECRET=your_api_secret_here
OKX_PASSPHRASE=your_passphrase_here
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=shuzhongren
DB_NAME=bitcoin_trader
LOG_LEVEL=INFO
EOF

# 6. 编辑配置（填入真实API）
vim .env

# 7. 创建日志目录
mkdir -p logs

# 8. 配置systemd服务
cat > /etc/systemd/system/bitcoin-trader.service << 'EOF'
[Unit]
Description=Bitcoin Trader - EMA Trend Strategy
After=network.target mysql.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/zhixing_trader/bitcoin_trader
ExecStart=/usr/bin/python3 /opt/zhixing_trader/bitcoin_trader/run_okx_live_demo.py
Restart=on-failure
RestartSec=10
StandardOutput=append:/opt/zhixing_trader/bitcoin_trader/logs/trader.log
StandardError=append:/opt/zhixing_trader/bitcoin_trader/logs/trader.error.log
Environment="PYTHONUNBUFFERED=1"

[Install]
WantedBy=multi-user.target
EOF

# 9. 重载systemd
systemctl daemon-reload

# 10. 测试运行
python3 test_strategy_integration.py
```

---

## ⚙️ 配置OKX API

**重要：必须配置真实的OKX API才能运行！**

```bash
# 编辑配置文件
vim /opt/zhixing_trader/bitcoin_trader/.env

# 修改以下内容：
OKX_API_KEY=你的API_KEY
OKX_API_SECRET=你的API_SECRET  
OKX_PASSPHRASE=你的PASSPHRASE
```

---

## 🎮 启动服务

```bash
# 启动
systemctl start bitcoin-trader

# 查看状态
systemctl status bitcoin-trader

# 查看日志
tail -f /opt/zhixing_trader/bitcoin_trader/logs/trader.log

# 设置开机自启
systemctl enable bitcoin-trader
```

---

## 🔄 后续更新流程

### 本地修改代码后：

```bash
# 1. 在本地提交
cd /Users/chengzheng/workspace/chuangxin/zhixing_trader
git add .
git commit -m "更新说明"
git push origin main
```

### 服务器更新：

```bash
# 2. SSH到服务器
ssh root@101.42.14.209

# 3. 停止服务
systemctl stop bitcoin-trader

# 4. 拉取最新代码
cd /opt/zhixing_trader
git pull origin main

# 5. 重启服务
systemctl start bitcoin-trader

# 6. 查看状态
systemctl status bitcoin-trader
```

---

## 📊 监控命令

```bash
# 实时日志
tail -f /opt/zhixing_trader/bitcoin_trader/logs/trader.log

# 错误日志
tail -f /opt/zhixing_trader/bitcoin_trader/logs/trader.error.log

# 服务状态
systemctl status bitcoin-trader

# 系统日志
journalctl -u bitcoin-trader -f
```

---

## 📁 服务器文件结构

```
/opt/zhixing_trader/
├── bitcoin_trader/
│   ├── app/
│   │   └── core/
│   │       └── strategies/
│   │           └── ema_trend_strategy.py  # EMA策略
│   ├── run_okx_live_demo.py               # 主程序
│   ├── .env                                # 配置文件（需手动配置）
│   ├── logs/                               # 日志目录
│   │   ├── trader.log                      # 运行日志
│   │   └── trader.error.log                # 错误日志
│   └── requirements.txt                    # Python依赖
└── .git/                                   # Git仓库
```

---

## 🎯 当前策略配置

**策略名称**: EMA趋势跟随策略

**核心参数**:
- EMA周期: 8/21/55
- 仓位比例: 30%
- 最大亏损: 4%
- 止盈目标: 5%/10%/15%
- 交易周期: 5分钟
- 检查间隔: 30秒

**风险控制**:
- 最大仓位: 0.05 BTC
- 单笔最大: 2000 USDT
- 日亏损限制: 5%
- 交易次数: 不限制

---

## ⚠️ 重要提示

1. **必须配置OKX API** - 否则无法连接交易所
2. **初期小仓位测试** - 建议先用小资金测试
3. **定期查看日志** - 监控交易情况
4. **严格遵守止损** - 不要手动干预策略
5. **代码管理规范** - 所有修改在本地完成，通过git部署

---

## 📞 快速命令

```bash
# 连接服务器
ssh root@101.42.14.209

# 查看服务
systemctl status bitcoin-trader

# 查看日志
tail -f /opt/zhixing_trader/bitcoin_trader/logs/trader.log

# 重启服务
systemctl restart bitcoin-trader

# 更新代码
cd /opt/zhixing_trader && git pull && systemctl restart bitcoin-trader
```

---

## ✅ 检查清单

部署前检查：
- [ ] 代码已推送到GitHub
- [ ] 服务器可以访问GitHub
- [ ] 服务器已安装Git、Python3
- [ ] 已准备好OKX API密钥

部署后检查：
- [ ] 代码已克隆到 /opt/zhixing_trader
- [ ] Python依赖已安装
- [ ] .env 文件已配置
- [ ] systemd服务已创建
- [ ] 测试脚本运行成功

启动前检查：
- [ ] OKX API配置正确
- [ ] 网络可以访问OKX
- [ ] 日志目录已创建
- [ ] 数据库连接正常（如需要）

---

**准备就绪！现在可以开始部署了！** 🚀

**GitHub仓库**: https://github.com/xingdong23/zhixing_trader
**最新提交**: ab5148f

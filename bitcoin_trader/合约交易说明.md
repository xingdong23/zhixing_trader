# 合约交易说明

## 重要说明 ⚠️

**本策略使用的是永续合约交易，不是现货交易！**

## 什么是永续合约？

### 永续合约 (Perpetual Swap)
- **可以做多做空**：看涨买入开多仓，看跌卖出开空仓
- **使用杠杆**：本策略使用3倍杠杆
- **保证金交易**：只需要一部分保证金就能交易更大的仓位
- **无交割日期**：永续合约没有到期日，可以一直持有

### 与现货交易的区别

| 特性 | 现货交易 | 永续合约 |
|------|---------|---------|
| 交易方向 | 只能做多（买涨） | 可以做多做空 |
| 杠杆 | 无杠杆（1倍） | 有杠杆（本策略3倍） |
| 资金占用 | 全额资金 | 保证金（1/3资金） |
| 风险 | 较低 | 较高（有爆仓风险） |
| 收益 | 较低 | 较高（放大3倍） |

## 代码实现

### 1. 设置交易类型为合约

```python
# 设置为永续合约模式
exchange.options['defaultType'] = 'swap'  # swap = 永续合约
```

### 2. 设置杠杆倍数

```python
# 下单时传入杠杆参数
params = {
    'leverage': 3.0,  # 3倍杠杆
}

order = exchange.create_market_buy_order(
    symbol='BTC/USDT',
    amount=0.001,
    params=params
)
```

### 3. 交易方向

```python
# 做多（看涨）
order = exchange.create_market_buy_order(
    symbol='BTC/USDT',
    amount=0.001,
    params={'leverage': 3.0}
)

# 做空（看跌）
order = exchange.create_market_sell_order(
    symbol='BTC/USDT',
    amount=0.001,
    params={'leverage': 3.0}
)
```

## 杠杆计算示例

### 假设场景
- 初始资金：300 USDT
- 杠杆倍数：3倍
- BTC价格：67,000 USDT

### 现货交易（无杠杆）
- 可买入BTC：300 / 67,000 = 0.00448 BTC
- 价格涨1%：盈利 = 300 × 1% = 3 USDT
- 价格跌1%：亏损 = 300 × 1% = 3 USDT

### 合约交易（3倍杠杆）
- 保证金：300 USDT
- 可开仓价值：300 × 3 = 900 USDT
- 可买入BTC：900 / 67,000 = 0.01343 BTC

**做多场景：**
- 价格涨1%：盈利 = 900 × 1% = 9 USDT（收益率3%）
- 价格跌1%：亏损 = 900 × 1% = 9 USDT（亏损率3%）

**做空场景：**
- 价格跌1%：盈利 = 900 × 1% = 9 USDT（收益率3%）
- 价格涨1%：亏损 = 900 × 1% = 9 USDT（亏损率3%）

## 风险说明

### ⚠️ 爆仓风险

**什么是爆仓？**
- 当亏损达到保证金的一定比例时，交易所会强制平仓
- 3倍杠杆下，价格反向波动约33%就会爆仓
- 爆仓后会损失全部保证金

**本策略的风险控制：**
- 止损：0.8%-1.2%（远小于爆仓线）
- 单日最大亏损：8%
- 连续亏损2单停止交易

### ⚠️ 资金费率

永续合约有资金费率机制：
- 每8小时结算一次
- 多空双方互相支付
- 通常很小（0.01%左右）
- 长期持仓需要注意

### ⚠️ 滑点风险

合约交易的滑点可能比现货大：
- 市价单可能以不利价格成交
- 波动大时滑点更明显
- 本策略使用市价单，会有滑点

## 启动日志说明

当你启动策略时，会看到：

```
✓ 使用OKX模拟盘API Key（虚拟资金，真实API调用）
✓ 交易类型: 永续合约 (SWAP)
✓ 杠杆倍数: 3.0x
```

这表示：
- ✅ 使用永续合约交易
- ✅ 使用3倍杠杆
- ✅ 可以做多做空

## 交易日志说明

### 做多开仓
```
✓ [模拟盘] 做多开仓成功: {...}
```
- 买入开多仓
- 看涨BTC
- 价格上涨盈利

### 做空开仓
```
✓ [模拟盘] 做空开仓成功: {...}
```
- 卖出开空仓
- 看跌BTC
- 价格下跌盈利

## 注意事项

### ⚠️ 模拟盘测试
1. **必须先在模拟盘充分测试**
2. 模拟盘也是真实的合约交易（虚拟资金）
3. 熟悉合约交易规则和风险

### ⚠️ 实盘交易
1. **风险远高于现货交易**
2. 杠杆放大收益，也放大亏损
3. 严格遵守风险控制规则
4. 不要投入超过承受能力的资金

### ⚠️ 杠杆倍数
- 当前设置：3倍杠杆
- 可以在 `config/high_frequency.json` 中修改
- 杠杆越高，风险越大
- 建议：新手使用2-3倍，熟练后可考虑5倍

## 修改杠杆倍数

编辑 `config/high_frequency.json`：

```json
{
  "trading": {
    "symbol": "BTC/USDT",
    "timeframe": "5m",
    "capital": 300.0,
    "leverage": 3.0  // 修改这里，范围：1-125（建议2-5）
  }
}
```

## 总结

✅ **本策略使用永续合约交易**
- 可以做多做空
- 使用3倍杠杆
- 收益和风险都放大3倍

⚠️ **风险提示**
- 合约交易风险高于现货
- 有爆仓风险
- 必须严格风控
- 建议先模拟盘测试

📚 **学习建议**
1. 了解永续合约基本概念
2. 理解杠杆和保证金机制
3. 熟悉做多做空的区别
4. 掌握风险控制方法

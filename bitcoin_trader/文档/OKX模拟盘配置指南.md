# OKX 模拟盘配置指南

## 📋 概述

本指南将帮助你配置 OKX 模拟账户，并运行完整的自动交易流程。

---

## 🔑 步骤1: 获取 OKX API 密钥

### 1.1 注册 OKX 账户

1. 访问 OKX 官网: https://www.okx.com
2. 注册账户（如果还没有）
3. 完成身份验证

### 1.2 开通模拟盘

1. 登录 OKX 账户
2. 进入 **交易** → **模拟盘交易**
3. 系统会自动为你分配模拟资金（通常是 1,000,000 USDT）

### 1.3 创建 API 密钥

1. 进入 **个人中心** → **API**
2. 点击 **创建 API**
3. 选择 **模拟盘 API**（重要！）
4. 设置 API 权限：
   - ✅ 读取
   - ✅ 交易
   - ❌ 提现（不需要）
5. 设置 API 密码（Passphrase）- 请记住这个密码
6. 完成二次验证
7. 保存以下信息：
   - **API Key**
   - **Secret Key**
   - **Passphrase**

⚠️ **重要提示**:
- API 密钥只显示一次，请妥善保存
- Secret Key 泄露可能导致资产损失
- 模拟盘 API 不会影响真实资金

---

## ⚙️ 步骤2: 配置环境变量

### 2.1 创建 .env 文件

在 `bitcoin_trader` 目录下创建 `.env` 文件：

```bash
cd bitcoin_trader
touch .env
```

### 2.2 添加 OKX 配置

编辑 `.env` 文件，添加以下内容：

```bash
# OKX 模拟盘配置
OKX_API_KEY=your_api_key_here
OKX_API_SECRET=your_secret_key_here
OKX_PASSPHRASE=your_passphrase_here
OKX_TESTNET=True

# 其他配置
APP_ENV=development
DEBUG=True
LOG_LEVEL=INFO
```

**示例**:

```bash
OKX_API_KEY=a1b2c3d4-e5f6-7890-abcd-ef1234567890
OKX_API_SECRET=A1B2C3D4E5F67890ABCDEF1234567890
OKX_PASSPHRASE=MySecurePassword123
OKX_TESTNET=True
```

### 2.3 验证配置

运行测试脚本验证配置：

```bash
python examples/okx_demo_trading.py
```

选择选项 `1` 测试连接。

---

## 🚀 步骤3: 运行交易流程

### 3.1 完整流程演示

```bash
python examples/okx_demo_trading.py
```

选择选项 `4` 运行完整流程：
1. 测试 OKX 连接
2. 运行模拟交易（Paper Trading）

### 3.2 各个模式说明

#### 模式1: Paper Trading（推荐新手）

```bash
# 选择选项 2
python examples/okx_demo_trading.py
```

**特点**:
- ✅ 不执行真实订单
- ✅ 完全模拟交易过程
- ✅ 无任何风险
- ✅ 用于测试策略逻辑

**适用场景**:
- 测试策略是否正常运行
- 验证代码逻辑
- 学习交易流程

#### 模式2: Live Trading（进阶用户）

```bash
# 选择选项 3
python examples/okx_demo_trading.py
```

**特点**:
- ⚠️ 在模拟盘执行真实订单
- ⚠️ 会实际下单、成交、平仓
- ✅ 使用模拟资金，无真实损失
- ✅ 完整测试交易流程

**适用场景**:
- 测试订单执行逻辑
- 验证止损止盈功能
- 真实环境测试

---

## 📊 步骤4: 监控和分析

### 4.1 实时监控

运行机器人后，你会看到：

```
🚀 机器人启动中...
================================================================================

[2025-10-18 16:00:00] INFO - 交易引擎初始化完成
[2025-10-18 16:00:01] INFO - 行情监控器启动
[2025-10-18 16:00:02] INFO - K线监控器启动
[2025-10-18 16:00:03] INFO - 订阅实时行情: BTC/USDT
[2025-10-18 16:00:04] INFO - 策略信号: hold - 未满足入场条件

...
```

### 4.2 查看性能报告

机器人停止后会显示：

```
╔══════════════════════════════════════════════════════════════╗
║                    交易机器人性能报告                        ║
╚══════════════════════════════════════════════════════════════╝

【基本信息】
  交易对: BTC/USDT
  策略:   稳健盈利策略
  周期:   15m
  模式:   PAPER
  状态:   已停止

【交易统计】
  总交易: 3
  盈利:   2
  亏损:   1
  胜率:   66.7%
  持仓:   0
  挂单:   0

【资金状况】
  初始:   10,000.00 USDT
  当前:   10,150.00 USDT
  盈亏:   +150.00 USDT
  收益率: +1.50%
```

---

## 🔧 步骤5: 调整参数

### 5.1 修改策略参数

编辑 `examples/okx_demo_trading.py`，找到策略配置部分：

```python
strategy = SteadyProfitStrategy(parameters={
    "base_position_ratio": 0.01,       # 调整基础仓位
    "max_daily_loss": 0.02,            # 调整日亏损限制
    "atr_multiplier": 1.5,             # 调整止损宽度
})
```

### 5.2 修改风险限制

```python
risk_limits = RiskLimits(
    max_position_size=0.05,            # 调整最大仓位
    max_daily_loss=0.02,               # 调整日亏损限制
    max_trades_per_day=10,             # 调整交易频率
)
```

### 5.3 修改运行时间

```python
# 修改运行时长（秒）
await asyncio.sleep(300)  # 5分钟
await asyncio.sleep(600)  # 10分钟
await asyncio.sleep(1800) # 30分钟
```

---

## 📝 常见问题

### Q1: API 连接失败

**错误信息**: `❌ 连接失败: Authentication failed`

**解决方法**:
1. 检查 API Key、Secret、Passphrase 是否正确
2. 确认使用的是模拟盘 API（不是实盘 API）
3. 检查 API 权限是否包含"交易"
4. 确认 `.env` 文件在正确的位置

### Q2: 没有模拟资金

**解决方法**:
1. 登录 OKX 网页版
2. 进入模拟盘交易
3. 系统会自动分配模拟资金
4. 刷新后重试

### Q3: 订单执行失败

**错误信息**: `❌ 市价单执行失败`

**可能原因**:
1. 模拟资金不足
2. 交易对不支持
3. 订单数量太小（低于最小交易量）
4. API 权限不足

**解决方法**:
- 检查账户余额
- 使用主流交易对（BTC/USDT, ETH/USDT）
- 增加订单数量
- 重新创建 API 密钥并授予交易权限

### Q4: 策略不产生信号

**原因**: 市场条件不满足策略入场条件

**解决方法**:
- 耐心等待（策略较为保守）
- 调整策略参数使其更激进
- 切换到波动更大的时间段
- 使用更短的时间周期（如 5m）

### Q5: 如何切换到实盘

⚠️ **强烈建议**:
1. 先在模拟盘充分测试（至少1周）
2. 确认策略稳定盈利
3. 从小资金开始（100-1000 USDT）

**切换步骤**:
1. 创建实盘 API 密钥
2. 更新 `.env` 文件中的 API 配置
3. 设置 `OKX_TESTNET=False`
4. 使用严格的风险限制
5. 从小仓位开始测试

---

## 🎯 下一步

### 学习资源

1. **策略优化**: 阅读 `文档/稳健盈利策略.md`
2. **风险管理**: 阅读 `文档/CCXT集成指南.md`
3. **自定义策略**: 阅读 `文档/自定义策略开发.md`

### 进阶功能

1. **多交易对**: 同时交易 BTC、ETH、BNB 等
2. **策略组合**: 使用多个策略分散风险
3. **参数优化**: 通过回测找到最优参数
4. **实时监控**: 集成告警和通知功能

---

## ⚠️ 风险提示

1. **模拟盘限制**:
   - 模拟盘行情可能与实盘有差异
   - 成交速度可能不同
   - 滑点可能不准确

2. **实盘风险**:
   - 加密货币市场波动极大
   - 可能造成本金损失
   - 建议从小资金开始
   - 设置严格的止损

3. **技术风险**:
   - 网络中断可能导致无法平仓
   - API 限流可能影响交易
   - 建议设置多重保护机制

---

## 📞 获取帮助

遇到问题？

1. 查看日志文件: `logs/trading.log`
2. 阅读完整文档: `文档/CCXT集成指南.md`
3. 检查 OKX API 文档: https://www.okx.com/docs-v5/

---

**祝交易顺利！** 🚀

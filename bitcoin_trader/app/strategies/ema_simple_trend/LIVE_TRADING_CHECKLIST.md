# 实盘交易检查清单

## ⚠️ 关键风险提示

**在开始实盘交易前，请仔细阅读并确认所有检查项！**

---

## 🔍 代码审查结果

### ✅ 策略代码检查（strategy_multiframe.py）

#### 1. **核心逻辑正确性** ✅
- [x] 日线EMA21趋势过滤正确
- [x] 1小时EMA入场信号正确
- [x] 只做多逻辑正确（不做空）
- [x] 止损止盈计算正确

#### 2. **风险控制** ✅
- [x] 止损：3.2% ✅
- [x] 止盈：7% ✅
- [x] 仓位控制：85% ✅
- [x] 杠杆限制：2.7x ✅
- [x] 移动止损：已启用 ✅

#### 3. **关键问题发现** ⚠️

##### 🔴 **严重问题：缺少实盘订单保存机制**

**当前代码没有订单保存到数据库的功能！**

```python
# 当前代码只有内存记录：
self.current_position = None
self.entry_price = None
self.total_trades = 0
```

**问题：**
1. ❌ 程序重启后丢失所有订单信息
2. ❌ 无法查询历史交易记录
3. ❌ 无法进行风险监控
4. ❌ 万一程序崩溃，可能无法平仓

##### 🟡 **其他需要注意的问题**

1. **日线数据依赖**
   ```python
   self.daily_data_file = parameters.get('daily_data_file', 'data/ETHUSDT-1d-from1h.csv')
   ```
   - ⚠️ 实盘需要实时更新日线数据
   - ⚠️ 如果日线数据过期，策略会失效

2. **没有网络异常处理**
   - ⚠️ 网络断开时无法获取价格
   - ⚠️ 订单提交失败时没有重试机制

3. **没有仓位恢复机制**
   - ⚠️ 程序重启后无法恢复持仓状态
   - ⚠️ 可能导致重复开仓或忘记平仓

---

## 🛠️ 必须修复的问题

### 1. 添加订单数据库保存（必须！）

需要实现：
- [ ] 订单保存到数据库（SQLite/MySQL/MongoDB）
- [ ] 程序启动时恢复持仓状态
- [ ] 记录所有交易历史
- [ ] 定期备份数据

**建议实现：**
```python
# 需要添加的功能：
1. 初始化数据库连接
2. save_order() - 保存订单
3. load_position() - 加载持仓
4. update_order() - 更新订单状态
5. get_trade_history() - 获取历史
```

### 2. 添加实盘安全检查

```python
# 建议添加：
1. 最大仓位检查（防止超额开仓）
2. 日内最大交易次数限制
3. 日内最大亏损限制（止损熔断）
4. 余额检查（防止余额不足）
5. 价格合理性检查（防止异常价格）
```

### 3. 添加日线数据更新机制

```python
# 需要实现：
1. 定时更新日线数据
2. 检查数据是否过期
3. 数据更新失败的处理
```

---

## 📋 实盘前检查清单

### A. 环境检查

- [ ] **1. Binance API配置**
  - [ ] API Key 已创建
  - [ ] API Secret 已保存
  - [ ] IP白名单已设置
  - [ ] 只开启交易权限（不开启提现）
  - [ ] 测试API连接成功

- [ ] **2. 资金准备**
  - [ ] 初始资金：300-1000 USDT
  - [ ] 资金已转入合约账户
  - [ ] 确认可用余额

- [ ] **3. 杠杆设置**
  - [ ] ETHUSDT杠杆设置为2.7x或3x
  - [ ] 确认仓位模式（逐仓/全仓）
  - [ ] 建议使用逐仓模式

### B. 代码检查

- [ ] **1. 配置文件检查**
  ```bash
  cat app/strategies/ema_simple_trend/config_multiframe.json
  ```
  - [ ] total_capital: 300-1000
  - [ ] position_size: 0.85
  - [ ] leverage: 2.7
  - [ ] stop_loss_pct: 0.032
  - [ ] allow_short: false

- [ ] **2. 数据文件检查**
  - [ ] ETHUSDT 1小时数据存在
  - [ ] ETHUSDT 日线数据存在
  - [ ] 数据是最新的（今天的）

- [ ] **3. 日志配置**
  - [ ] 开启详细日志
  - [ ] 日志保存到文件
  - [ ] 设置日志轮转

### C. 功能测试

- [ ] **1. 回测验证**
  ```bash
  # 再次运行回测确保策略正常
  python3 backtest/run_backtest.py --config app/strategies/ema_simple_trend/backtest_multiframe_2years.json
  ```
  - [ ] 回测成功运行
  - [ ] 收益率符合预期
  - [ ] 没有报错

- [ ] **2. 模拟盘测试（强烈建议！）**
  - [ ] 先用小资金（10-50u）测试3-7天
  - [ ] 验证订单能正常执行
  - [ ] 验证止损止盈正常
  - [ ] 验证数据保存正常

### D. 监控准备

- [ ] **1. 实时监控**
  - [ ] 设置价格提醒
  - [ ] 设置持仓提醒
  - [ ] 设置盈亏提醒

- [ ] **2. 紧急预案**
  - [ ] 记录手动平仓方法
  - [ ] 准备应急联系方式
  - [ ] 设置最大亏损止损

---

## ⚠️ 严重风险警告

### 1. 数据库缺失风险 🔴

**当前最大问题：没有订单数据库！**

**风险：**
- 程序崩溃 → 丢失所有订单记录
- 服务器重启 → 忘记平仓，持仓过夜
- 网络中断 → 无法恢复交易状态

**解决方案：**
```
必须先实现订单数据库，再上实盘！
建议使用：
1. SQLite（简单）
2. MySQL（推荐）
3. MongoDB（灵活）
```

### 2. 日线数据风险 ⚠️

**问题：策略依赖日线数据判断趋势**

**风险：**
- 日线数据过期 → 策略失效
- 数据更新失败 → 错误信号

**解决方案：**
```
1. 每天自动更新日线数据
2. 检查数据时效性
3. 数据异常时停止交易
```

### 3. 网络异常风险 ⚠️

**问题：没有网络异常处理**

**风险：**
- 网络断开 → 无法止损
- 订单失败 → 无法重试
- API限流 → 无法交易

**解决方案：**
```
1. 添加网络重试机制
2. 添加订单状态查询
3. 添加异常告警
```

### 4. 持仓恢复风险 🔴

**问题：程序重启后无法恢复持仓**

**风险：**
- 重启后忘记有持仓
- 可能重复开仓
- 可能忘记止损

**解决方案：**
```
1. 启动时从数据库加载持仓
2. 启动时从交易所查询持仓
3. 对比并修正状态
```

---

## 🚨 实盘启动前的最后检查

### 关键问题检查

```bash
# 1. 检查数据库是否已实现
grep -r "database\|db\|sqlite\|mysql" app/ --include="*.py"

# 2. 检查日线数据是否最新
ls -lh data/ETHUSDT-1d-*.csv
head data/ETHUSDT-1d-*.csv
tail data/ETHUSDT-1d-*.csv

# 3. 检查配置文件
cat app/strategies/ema_simple_trend/config_multiframe.json

# 4. 测试API连接
# python3 test_api.py  # 需要创建
```

### 启动顺序

```bash
# 1. 先模拟盘测试（10u，3-7天）
python3 app/run/live_trading.py --mode=testnet --capital=10

# 2. 观察3-7天，确认：
#    - 订单正常执行
#    - 止损止盈正常
#    - 数据保存正常
#    - 没有异常报错

# 3. 小资金实盘（50-100u，1周）
python3 app/run/live_trading.py --mode=live --capital=50

# 4. 观察1周，确认无误后，增加到300u
python3 app/run/live_trading.py --mode=live --capital=300
```

---

## 💡 实盘建议

### 1. 分阶段上线

| 阶段 | 资金 | 时长 | 目标 |
|------|------|------|------|
| 模拟盘 | 10u | 3-7天 | 验证功能 |
| 小资金测试 | 50-100u | 1-2周 | 验证策略 |
| 正式运行 | 300u+ | 长期 | 稳定盈利 |

### 2. 每日检查

- [ ] 检查持仓状态
- [ ] 检查数据更新
- [ ] 检查日志文件
- [ ] 检查异常报警

### 3. 风险控制

- [ ] 设置日内最大亏损（如-30u）
- [ ] 设置连续止损次数（如5次）
- [ ] 设置最大持仓时间（如3天）
- [ ] 到达限制后暂停交易

### 4. 紧急预案

```python
# 如果出现异常情况：

1. 立即停止程序
2. 手动平仓所有持仓
3. 检查数据库记录
4. 分析日志找原因
5. 修复后再启动
```

---

## 📞 紧急联系

**如果遇到严重问题：**

1. **立即停止程序**
2. **手动平仓**（Binance网页/App）
3. **查看日志** `logs/live_trading.log`
4. **检查数据库** `database/orders.db`
5. **分析原因后再启动**

---

## ✅ 我已经理解并确认

使用实盘前，请确认：

- [ ] 我已阅读所有风险提示
- [ ] 我理解当前代码缺少数据库功能
- [ ] 我知道程序重启会丢失订单信息
- [ ] 我会先在模拟盘测试
- [ ] 我会设置止损熔断机制
- [ ] 我准备好承担可能的损失
- [ ] 我不会投入无法承受损失的资金

---

## 🎯 总结

### 当前状态：⚠️ **不建议直接实盘**

**原因：**
1. 🔴 **缺少订单数据库**（关键问题）
2. ⚠️ 缺少实盘安全检查
3. ⚠️ 缺少网络异常处理
4. ⚠️ 缺少持仓恢复机制

### 建议流程：

```
1. 先实现订单数据库 ← 最重要！
2. 添加安全检查机制
3. 模拟盘测试3-7天
4. 小资金测试1-2周
5. 正式上线实盘
```

### 如果一定要立即实盘：

**最小化方案：**
1. 用极小资金（10-50u）
2. 人工盯盘（不要离开）
3. 准备随时手动平仓
4. 记录所有问题
5. 1-2天后停止，完善代码

---

*最后更新: 2025-11-01*
*强烈建议先完善代码再实盘！*

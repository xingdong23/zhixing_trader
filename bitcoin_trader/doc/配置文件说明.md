# 配置文件完整说明

配置文件：`config/high_frequency.json`

所有策略参数都已移到配置文件，无需修改代码即可调整策略行为。

---

## 1. 交易基础配置 (trading)

```json
"trading": {
  "symbol": "ETH/USDT",      // 交易对
  "timeframe": "5m",          // K线周期（5分钟）
  "capital": 300.0,           // 初始资金（USDT）
  "leverage": 3.0             // 杠杆倍数（3倍）
}
```

**调整建议：**
- `symbol`: BTC/USDT, ETH/USDT, SOL/USDT 等
- `leverage`: 建议 2-5 倍，不要超过 5 倍
- `capital`: 根据实际资金调整

---

## 2. 资金管理 (capital_management)

```json
"capital_management": {
  "num_portions": 6,              // 总分仓数量
  "portion_size": 50.0,           // 每份资金大小（USDT）
  "max_portions_per_trade": 2     // 单次最大开仓份数
}
```

**说明：**
- 总资金 = num_portions × portion_size = 6 × 50 = 300 USDT
- 单次最大开仓 = max_portions_per_trade × portion_size × leverage = 2 × 50 × 3 = 300 USDT 名义价值

**调整建议：**
- 保守：max_portions_per_trade = 1（单次只用 1 份）
- 激进：max_portions_per_trade = 3（单次用 3 份）

---

## 3. 技术指标参数 (indicators)

```json
"indicators": {
  "ema_fast": 8,                    // 快速EMA周期
  "ema_slow": 21,                   // 慢速EMA周期
  "rsi_period": 14,                 // RSI周期
  "rsi_long_threshold_low": 45,     // 做多RSI下限
  "rsi_short_threshold_high": 55,   // 做空RSI上限
  "bb_period": 20,                  // 布林带周期
  "bb_std": 2,                      // 布林带标准差
  "macd_fast": 12,                  // MACD快线
  "macd_slow": 26,                  // MACD慢线
  "macd_signal": 9                  // MACD信号线
}
```

**调整建议：**
- **更灵敏**：ema_fast=5, ema_slow=13（更多信号，但假突破也多）
- **更稳定**：ema_fast=10, ema_slow=30（信号少但质量高）
- **RSI 阈值**：
  - 保守：rsi_long_threshold_low=40, rsi_short_threshold_high=60
  - 激进：rsi_long_threshold_low=50, rsi_short_threshold_high=50

---

## 4. 入场条件 (entry_conditions)

```json
"entry_conditions": {
  "volume_lookback": 5,           // 成交量回看周期
  "volume_multiplier": 1.8,       // 成交量突增倍数
  "breakout_lookback": 15,        // 突破回看周期（分钟）
  "breakout_confirmation": 0.0015 // 突破确认幅度（0.15%）
}
```

**说明：**
- 成交量突增：当前成交量 > 最近 5 根均量 × 1.8
- 价格突破：突破前 15 分钟高/低点 + 0.15%

**调整建议：**
- **信号更多**：volume_multiplier=1.5, breakout_confirmation=0.001
- **信号更少但质量高**：volume_multiplier=2.0, breakout_confirmation=0.002

---

## 5. 出场条件 (exit_conditions)

```json
"exit_conditions": {
  "stop_loss_min": 0.008,         // 最小止损 0.8%
  "stop_loss_max": 0.010,         // 最大止损 1.0%
  "take_profit_min": 0.015,       // 最小止盈 1.5%
  "take_profit_max": 0.025,       // 最大止盈 2.5%
  "profit_risk_ratio_min": 1.5,   // 最小盈亏比
  "profit_risk_ratio_max": 2.0,   // 最大盈亏比
  "profit_level_1": 0.005,        // 盈利 0.5% 移动止损到成本价
  "profit_level_2": 0.010,        // 盈利 1.0% 移动止损到盈利 0.5%
  "profit_level_3": 0.015,        // 盈利 1.5% 分批平仓
  "partial_close_ratio": 0.5,     // 分批平仓比例（50%）
  "max_holding_time": 120,        // 最大持仓时间（分钟）
  "ideal_holding_time_min": 15,   // 理想持仓时间下限
  "ideal_holding_time_max": 45    // 理想持仓时间上限
}
```

**调整建议：**
- **更保守止损**：stop_loss_max=0.008（0.8%）
- **更激进止盈**：take_profit_max=0.030（3.0%）
- **更早分批**：profit_level_3=0.012（1.2%）
- **更晚分批**：profit_level_3=0.020（2.0%）

---

## 6. 风险控制 (risk_control)

```json
"risk_control": {
  "max_daily_profit": 0.05,       // 单日最大盈利 5%
  "max_daily_loss": 0.05,         // 单日最大亏损 5%
  "max_consecutive_losses": 2,    // 最大连续亏损次数
  "max_trades_per_day": 5,        // 每日最大交易次数
  "min_trades_per_day": 3,        // 每日最小交易次数
  "single_trade_max_loss": 0.02   // 单笔最大亏损 2%
}
```

**调整建议：**
- **极度保守**：max_daily_loss=0.03, max_trades_per_day=3
- **正常**：max_daily_loss=0.05, max_trades_per_day=5
- **激进**：max_daily_loss=0.08, max_trades_per_day=8

---

## 7. 特殊条件 (special_conditions)

```json
"special_conditions": {
  "avoid_news_minutes": 30,       // 重大数据前后避免交易（分钟）
  "max_1min_volatility": 0.005,   // 1分钟最大波动 0.5%
  "min_volume_threshold": 0.5     // 最小成交量阈值（相对均值）
}
```

**说明：**
- 成交量萎缩：当前成交量 < 均量 × 0.5 时暂停交易
- 波动过大：相邻K线波动 > 0.5% 时暂停交易

---

## 8. 时段过滤 (session_filter)

```json
"session_filter": {
  "enabled": true,                              // 是否启用
  "allowed_sessions": ["MORNING_BREAKOUT", "US_SESSION"]  // 允许的时段
}
```

**可选时段：**
- `MORNING_BREAKOUT`: 08:00-10:00（早盘突破）
- `NOON_OSCILLATION`: 14:00-16:00（午间震荡）
- `US_SESSION`: 20:00-22:00（美盘联动）

**调整建议：**
- **只做美盘**：`["US_SESSION"]`
- **早盘+美盘**：`["MORNING_BREAKOUT", "US_SESSION"]`
- **全天候**：设置 `enabled: false`

---

## 9. 顺势持有 (trend_following)

```json
"trend_following": {
  "enabled": true,                    // 是否启用
  "min_profit_to_activate": 0.01,     // 触发顺势的最低盈利（1%）
  "trailing_atr_multiplier": 1.2,     // ATR追踪止损倍数
  "use_ema_trailing": true,           // 结合EMA21追踪
  "extend_holding_time": true,        // 延长持仓时间
  "max_holding_time_on_trend": 240    // 趋势中最大持仓（分钟）
}
```

**说明：**
- 盈利 ≥ 1% 且趋势成立时：
  - 止损追踪：max(当前止损, 现价 - ATR×1.2, EMA21)
  - 最大持仓延长到 240 分钟

**调整建议：**
- **更保守追踪**：trailing_atr_multiplier=1.5（止损离价格更远）
- **更激进追踪**：trailing_atr_multiplier=1.0（止损离价格更近）
- **更早触发**：min_profit_to_activate=0.008（0.8%）
- **更晚触发**：min_profit_to_activate=0.015（1.5%）

---

## 10. 保守模式 (conservative_mode)

```json
"conservative_mode": {
  "enabled": true   // 是否启用保守模式
}
```

**启用后自动收紧：**
- 止损上限：1.2% → 1.0%
- 突破确认：0.1% → 0.15%
- 成交量倍数：1.5 → 1.8
- 单日最大亏损：8% → 5%
- 每日最大交易：8 笔 → 5 笔

**适用场景：**
- 新策略上线
- 市场波动异常
- 连续亏损后
- 资金量较大时

---

## 快速调参场景

### 场景1：信号太少
```json
"volume_multiplier": 1.5,           // 降低到 1.5
"breakout_confirmation": 0.001,     // 降低到 0.1%
"session_filter": { "enabled": false }  // 关闭时段过滤
```

### 场景2：假突破太多
```json
"volume_multiplier": 2.0,           // 提高到 2.0
"breakout_confirmation": 0.002,     // 提高到 0.2%
"ema_fast": 10,                     // 放慢EMA
"ema_slow": 30
```

### 场景3：想要更激进
```json
"conservative_mode": { "enabled": false },
"max_daily_loss": 0.08,
"max_trades_per_day": 8,
"stop_loss_max": 0.012,
"max_portions_per_trade": 3
```

### 场景4：想要更保守
```json
"conservative_mode": { "enabled": true },
"max_daily_loss": 0.03,
"max_trades_per_day": 3,
"stop_loss_max": 0.008,
"max_portions_per_trade": 1
```

---

## 配置文件验证

修改配置后，启动前验证：

```bash
# 验证JSON格式
python -m json.tool config/high_frequency.json

# 启动测试
python run/high_frequency.py --mode paper
```

---

## 注意事项

1. **修改后重启生效**：配置文件修改后需要重启程序
2. **备份配置**：修改前先备份原配置
3. **渐进调整**：一次只调整 1-2 个参数，观察效果
4. **模拟盘测试**：重大调整先在模拟盘跑 1-2 天
5. **记录调参**：记录每次调参和效果，便于回溯

---

## 推荐配置组合

### 保守型（适合新手/大资金）
```json
{
  "conservative_mode": { "enabled": true },
  "max_daily_loss": 0.03,
  "max_trades_per_day": 3,
  "stop_loss_max": 0.008,
  "volume_multiplier": 2.0,
  "session_filter": { 
    "enabled": true,
    "allowed_sessions": ["US_SESSION"]
  }
}
```

### 平衡型（当前默认）
```json
{
  "conservative_mode": { "enabled": true },
  "max_daily_loss": 0.05,
  "max_trades_per_day": 5,
  "stop_loss_max": 0.010,
  "volume_multiplier": 1.8,
  "session_filter": { 
    "enabled": true,
    "allowed_sessions": ["MORNING_BREAKOUT", "US_SESSION"]
  }
}
```

### 激进型（适合小资金/经验丰富）
```json
{
  "conservative_mode": { "enabled": false },
  "max_daily_loss": 0.08,
  "max_trades_per_day": 8,
  "stop_loss_max": 0.012,
  "volume_multiplier": 1.5,
  "session_filter": { "enabled": false },
  "max_portions_per_trade": 3
}
```

---

## 总结

✅ **所有参数都在配置文件中**
- 无需修改代码
- 修改后重启即生效
- 支持多套配置切换

✅ **参数分组清晰**
- trading: 基础交易设置
- capital_management: 资金管理
- indicators: 技术指标
- entry_conditions: 入场条件
- exit_conditions: 出场条件
- risk_control: 风险控制
- special_conditions: 特殊条件
- session_filter: 时段过滤
- trend_following: 顺势持有
- conservative_mode: 保守模式

✅ **灵活调整**
- 根据市场情况快速调参
- 支持保守/平衡/激进多种模式
- 可针对不同币种定制配置

# 配置文件对比说明

详细解释 `backtest_config.json` 和 `high_frequency.json` 的区别和关系。

---

## 配置文件对比

### 1. backtest_config.json (回测配置)

**位置**: `backtest/configs/backtest_config.json`

**职责**: 控制**回测系统本身**的行为

```json
{
  "backtest_name": "高频策略回测",
  "description": "ETH/USDT 高频短线策略历史数据回测",
  
  "data": {
    "source": "data/ETH-USDT-1m-2025.10.23.csv",
    "timeframe": "5m",
    "resample_from": "1m"
  },
  
  "strategy": {
    "name": "high_frequency",
    "config_file": "../app/config/high_frequency.json"
  },
  
  "backtest_settings": {
    "initial_capital": 300.0,
    "window_size": 200,
    "commission_rate": 0.0004,
    "slippage_rate": 0.0001
  },
  
  "output": {
    "result_file": "results/backtest_result_{timestamp}.json",
    "save_trades": true
  }
}
```

**控制内容**:
- 📊 使用哪些历史数据
- 💰 初始资金多少
- 📈 回测窗口大小
- 💸 手续费和滑点
- 📁 结果保存位置
- 🔗 使用哪个策略配置

---

### 2. high_frequency.json (策略配置)

**位置**: `app/config/high_frequency.json`

**职责**: 控制**交易策略本身**的行为

```json
{
  "trading": {
    "symbol": "ETH-USDT-SWAP",
    "capital": 300.0,
    "leverage": 3.0
  },
  
  "indicators": {
    "ema_fast": 20,
    "ema_slow": 50,
    "ema_trend": 200,
    "rsi_period": 14,
    "atr_period": 14
  },
  
  "entry_conditions": {
    "volume_multiplier": 2.0,
    "breakout_confirmation": 0.002,
    "rsi_long_threshold_low": 45,
    "rsi_short_threshold_high": 55
  },
  
  "exit_conditions": {
    "stop_loss_max": 0.010,
    "take_profit_max": 0.025,
    "profit_risk_ratio_max": 2.0
  },
  
  "risk_control": {
    "max_daily_loss": 0.05,
    "max_trades_per_day": 5
  }
}
```

**控制内容**:
- 📊 技术指标参数（EMA、RSI、ATR）
- 🎯 入场条件（成交量、突破确认）
- 🛡️ 出场条件（止损、止盈）
- ⚠️ 风险控制（最大亏损、交易次数）
- ⏰ 时段过滤
- 📈 顺势持有

---

## 详细对比

### 配置层级关系

```
backtest_config.json (回测层)
    ↓ 引用
high_frequency.json (策略层)
```

**关系**:
- `backtest_config.json` 通过 `strategy.config_file` 引用策略配置
- 回测配置控制"怎么测"
- 策略配置控制"怎么交易"

---

## 参数对比表

| 配置项 | backtest_config.json | high_frequency.json |
|--------|---------------------|---------------------|
| **数据源** | ✅ 控制 | ❌ 不涉及 |
| **初始资金** | ✅ 控制（回测用） | ✅ 控制（实盘用） |
| **杠杆** | ❌ 不涉及 | ✅ 控制 |
| **技术指标** | ❌ 不涉及 | ✅ 控制 |
| **入场条件** | ❌ 不涉及 | ✅ 控制 |
| **出场条件** | ❌ 不涉及 | ✅ 控制 |
| **风险控制** | ❌ 不涉及 | ✅ 控制 |
| **手续费** | ✅ 控制（回测模拟） | ❌ 不涉及 |
| **滑点** | ✅ 控制（回测模拟） | ❌ 不涉及 |
| **窗口大小** | ✅ 控制 | ❌ 不涉及 |
| **结果输出** | ✅ 控制 | ❌ 不涉及 |

---

## 使用场景对比

### 场景1: 回测历史数据

**使用**: `backtest_config.json` + `high_frequency.json`

```bash
# 运行回测
python backtest/run_backtest.py --config backtest/configs/backtest_config.json
```

**流程**:
```
1. 读取 backtest_config.json
   ├─ 加载历史数据: data/ETH-USDT-1m-2025.10.23.csv
   ├─ 设置初始资金: 300 USDT
   └─ 引用策略配置: ../app/config/high_frequency.json

2. 读取 high_frequency.json
   ├─ 加载策略参数: EMA、RSI、ATR
   ├─ 加载入场条件
   ├─ 加载出场条件
   └─ 加载风险控制

3. 运行回测
   └─ 使用策略参数分析历史数据
```

---

### 场景2: 实盘/模拟盘交易

**使用**: 只用 `high_frequency.json`

```bash
# 运行实盘
python app/run/high_frequency.py --mode paper
```

**流程**:
```
1. 读取 high_frequency.json
   ├─ 连接交易所
   ├─ 加载策略参数
   ├─ 实时获取市场数据
   └─ 执行交易

2. 不需要 backtest_config.json
   └─ 因为不是回测，是实时交易
```

---

## 为什么要分开？

### 原因1: 职责分离

**回测配置** (backtest_config.json):
- 关注"测试环境"
- 可以测试不同数据集
- 可以测试不同资金量
- 可以测试不同成本假设

**策略配置** (high_frequency.json):
- 关注"交易逻辑"
- 定义如何判断入场
- 定义如何判断出场
- 定义风险控制规则

---

### 原因2: 灵活性

**同一个策略，不同的回测场景**:

```bash
# 测试单日数据
python backtest/run_backtest.py --config configs/single_day.json

# 测试一周数据
python backtest/run_backtest.py --config configs/one_week.json

# 测试整月数据
python backtest/run_backtest.py --config configs/one_month.json
```

所有回测都使用**同一个策略配置** `high_frequency.json`，只是数据源不同。

---

### 原因3: 复用性

**策略配置可以在多个地方使用**:

```
high_frequency.json
    ├─ 回测系统使用
    ├─ 模拟盘使用
    └─ 实盘使用
```

**回测配置只在回测时使用**:

```
backtest_config.json
    └─ 仅回测系统使用
```

---

## 配置修改指南

### 想改变策略行为？

**修改**: `high_frequency.json`

```json
{
  "entry_conditions": {
    "volume_multiplier": 1.5,        // 改：降低成交量要求
    "breakout_confirmation": 0.001   // 改：降低突破确认
  }
}
```

**影响**: 
- ✅ 回测会使用新参数
- ✅ 实盘会使用新参数
- ✅ 模拟盘会使用新参数

---

### 想改变回测设置？

**修改**: `backtest_config.json`

```json
{
  "data": {
    "source": "data/ETH-USDT-*.csv"  // 改：使用多个文件
  },
  "backtest_settings": {
    "initial_capital": 1000.0        // 改：增加初始资金
  }
}
```

**影响**:
- ✅ 只影响回测
- ❌ 不影响实盘
- ❌ 不影响策略逻辑

---

## 实际例子

### 例子1: 测试不同资金量

**需求**: 测试策略在不同资金下的表现

**方案**: 创建多个回测配置，使用同一个策略配置

```bash
# configs/capital_100.json
{
  "backtest_settings": {
    "initial_capital": 100.0
  },
  "strategy": {
    "config_file": "../app/config/high_frequency.json"
  }
}

# configs/capital_500.json
{
  "backtest_settings": {
    "initial_capital": 500.0
  },
  "strategy": {
    "config_file": "../app/config/high_frequency.json"
  }
}

# configs/capital_1000.json
{
  "backtest_settings": {
    "initial_capital": 1000.0
  },
  "strategy": {
    "config_file": "../app/config/high_frequency.json"
  }
}
```

**运行**:
```bash
python backtest/run_backtest.py --config configs/capital_100.json
python backtest/run_backtest.py --config configs/capital_500.json
python backtest/run_backtest.py --config configs/capital_1000.json
```

**结果**: 同一个策略，三种资金量的回测结果

---

### 例子2: 测试不同策略参数

**需求**: 测试不同的止损止盈设置

**方案**: 创建多个策略配置，使用同一个回测配置

```bash
# config/conservative.json (保守)
{
  "exit_conditions": {
    "stop_loss_max": 0.008,
    "take_profit_max": 0.020
  }
}

# config/balanced.json (平衡)
{
  "exit_conditions": {
    "stop_loss_max": 0.010,
    "take_profit_max": 0.025
  }
}

# config/aggressive.json (激进)
{
  "exit_conditions": {
    "stop_loss_max": 0.015,
    "take_profit_max": 0.035
  }
}
```

**回测配置**:
```json
{
  "strategy": {
    "config_file": "../app/config/conservative.json"  // 切换这里
  }
}
```

---

## 配置文件关系图

```
项目结构
│
├── backtest/
│   ├── configs/
│   │   ├── backtest_config.json          ← 回测配置
│   │   ├── single_day.json               ← 单日回测
│   │   ├── one_week.json                 ← 一周回测
│   │   └── one_month.json                ← 整月回测
│   │
│   └── run_backtest.py                   ← 回测程序
│
└── app/
    ├── config/
    │   ├── high_frequency.json           ← 策略配置
    │   ├── conservative.json             ← 保守策略
    │   └── aggressive.json               ← 激进策略
    │
    └── run/
        └── high_frequency.py             ← 实盘程序
```

**关系**:
- 回测程序读取 `backtest_config.json`
- `backtest_config.json` 引用 `high_frequency.json`
- 实盘程序直接读取 `high_frequency.json`

---

## 总结

### backtest_config.json

**作用**: 控制回测环境  
**包含**: 数据源、初始资金、窗口大小、成本模拟  
**使用**: 仅回测时使用  
**修改影响**: 只影响回测行为

### high_frequency.json

**作用**: 控制交易策略  
**包含**: 指标参数、入场条件、出场条件、风险控制  
**使用**: 回测、模拟盘、实盘都使用  
**修改影响**: 影响所有交易行为

### 关键区别

| 维度 | backtest_config.json | high_frequency.json |
|------|---------------------|---------------------|
| **层级** | 回测层 | 策略层 |
| **职责** | 怎么测 | 怎么交易 |
| **范围** | 仅回测 | 回测+实盘 |
| **关注点** | 测试环境 | 交易逻辑 |

### 记忆口诀

```
回测配置管环境，策略配置管交易
回测只用回测配，实盘只用策略配
两者分工很明确，修改影响要清楚
```

---

更新时间: 2025-10-25 21:04

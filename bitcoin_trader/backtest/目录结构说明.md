# å›æµ‹ç³»ç»Ÿç›®å½•ç»“æ„è¯´æ˜

## å®Œæ•´ç›®å½•æ ‘

```
backtest/
â”œâ”€â”€ README.md                    # å›æµ‹ç³»ç»Ÿä½¿ç”¨æ–‡æ¡£
â”œâ”€â”€ ç›®å½•ç»“æ„è¯´æ˜.md              # æœ¬æ–‡æ¡£
â”œâ”€â”€ run_backtest.py              # å›æµ‹ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ __init__.py                  # æ¨¡å—åˆå§‹åŒ–æ–‡ä»¶
â”‚
â”œâ”€â”€ configs/                     # ğŸ“‹ é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ backtest_config.json     # é»˜è®¤å›æµ‹é…ç½®
â”‚   â”œâ”€â”€ conservative.json        # ä¿å®ˆé…ç½®ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ balanced.json            # å¹³è¡¡é…ç½®ï¼ˆå¯é€‰ï¼‰
â”‚   â””â”€â”€ aggressive.json          # æ¿€è¿›é…ç½®ï¼ˆå¯é€‰ï¼‰
â”‚
â”œâ”€â”€ data/                        # ğŸ“Š å†å²æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ ETH-USDT-1m-2025.10.23.csv
â”‚   â”œâ”€â”€ BTC-USDT-1m-2025.10.csv
â”‚   â””â”€â”€ ...                      # å…¶ä»–å†å²æ•°æ®æ–‡ä»¶
â”‚
â”œâ”€â”€ core/                        # ğŸ”§ æ ¸å¿ƒä»£ç ç›®å½•
â”‚   â”œâ”€â”€ __init__.py              # æ ¸å¿ƒæ¨¡å—å¯¼å‡º
â”‚   â”œâ”€â”€ data_loader.py           # æ•°æ®åŠ è½½å™¨
â”‚   â”œâ”€â”€ backtest_engine.py       # å›æµ‹å¼•æ“
â”‚   â””â”€â”€ performance_analyzer.py  # æ€§èƒ½åˆ†æå™¨
â”‚
â””â”€â”€ results/                     # ğŸ“ˆ å›æµ‹ç»“æœç›®å½•
    â”œâ”€â”€ backtest_result_20251025_204424.json
    â”œâ”€â”€ backtest_result_20251025_210000.json
    â””â”€â”€ ...                      # å…¶ä»–å›æµ‹ç»“æœæ–‡ä»¶
```

---

## ç›®å½•è¯¦è§£

### 1. æ ¹ç›®å½•æ–‡ä»¶

#### `run_backtest.py`
- **ä½œç”¨**: å›æµ‹ä¸»ç¨‹åºå…¥å£
- **åŠŸèƒ½**: 
  - è¯»å–é…ç½®æ–‡ä»¶
  - åŠ è½½å†å²æ•°æ®
  - åˆå§‹åŒ–ç­–ç•¥
  - è¿è¡Œå›æµ‹
  - ç”ŸæˆæŠ¥å‘Š
- **ä½¿ç”¨**: `python backtest/run_backtest.py --config backtest/configs/backtest_config.json`

#### `README.md`
- **ä½œç”¨**: å®Œæ•´çš„ä½¿ç”¨æ–‡æ¡£
- **å†…å®¹**:
  - å¿«é€Ÿå¼€å§‹æŒ‡å—
  - é…ç½®æ–‡ä»¶è¯´æ˜
  - æ•°æ®æ ¼å¼è¦æ±‚
  - ä½¿ç”¨ç¤ºä¾‹
  - å¸¸è§é—®é¢˜

#### `__init__.py`
- **ä½œç”¨**: PythonåŒ…åˆå§‹åŒ–
- **åŠŸèƒ½**: å¯¼å‡ºæ ¸å¿ƒæ¨¡å—ä¾›å¤–éƒ¨ä½¿ç”¨

---

### 2. configs/ - é…ç½®æ–‡ä»¶ç›®å½•

#### ç›®å½•ç”¨é€”
å­˜æ”¾æ‰€æœ‰å›æµ‹ç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼Œæ”¯æŒå¤šå¥—é…ç½®æ–¹æ¡ˆã€‚

#### é…ç½®æ–‡ä»¶ç»“æ„

**backtest_config.json** (é»˜è®¤é…ç½®)
```json
{
  "backtest_name": "å›æµ‹åç§°",
  "description": "å›æµ‹æè¿°",
  
  "data": {
    "source": "data/æ•°æ®æ–‡ä»¶.csv",
    "timeframe": "5m",
    "resample_from": "1m"
  },
  
  "strategy": {
    "name": "ç­–ç•¥åç§°",
    "config_file": "../config/ç­–ç•¥é…ç½®.json"
  },
  
  "backtest_settings": {
    "initial_capital": 300.0,
    "window_size": 200
  },
  
  "output": {
    "result_file": "results/backtest_result_{timestamp}.json",
    "save_trades": true
  }
}
```

#### é…ç½®æ–‡ä»¶ç®¡ç†

**åˆ›å»ºæ–°é…ç½®**:
```bash
# å¤åˆ¶é»˜è®¤é…ç½®
cp backtest/configs/backtest_config.json backtest/configs/my_config.json

# ç¼–è¾‘é…ç½®
nano backtest/configs/my_config.json

# ä½¿ç”¨æ–°é…ç½®è¿è¡Œ
python backtest/run_backtest.py --config backtest/configs/my_config.json
```

**æ¨èé…ç½®æ–¹æ¡ˆ**:
- `backtest_config.json`: é»˜è®¤é…ç½®
- `conservative.json`: ä¿å®ˆå‚æ•°é…ç½®
- `balanced.json`: å¹³è¡¡å‚æ•°é…ç½®
- `aggressive.json`: æ¿€è¿›å‚æ•°é…ç½®

---

### 3. data/ - å†å²æ•°æ®ç›®å½•

#### ç›®å½•ç”¨é€”
å­˜æ”¾æ‰€æœ‰ç”¨äºå›æµ‹çš„å†å²Kçº¿æ•°æ®ã€‚

#### æ•°æ®å‘½åè§„èŒƒ
```
{äº¤æ˜“å¯¹}-{æ—¶é—´æ¡†æ¶}-{æ—¥æœŸ}.csv

ç¤ºä¾‹:
ETH-USDT-1m-2025.10.23.csv       # ETH/USDT 1åˆ†é’Ÿæ•°æ® 2025å¹´10æœˆ23æ—¥
BTC-USDT-5m-2025.10.01-31.csv    # BTC/USDT 5åˆ†é’Ÿæ•°æ® 2025å¹´10æœˆå…¨æœˆ
SOL-USDT-1h-2025.Q3.csv          # SOL/USDT 1å°æ—¶æ•°æ® 2025å¹´ç¬¬3å­£åº¦
```

#### æ•°æ®æ ¼å¼è¦æ±‚

**CSVæ ¼å¼**:
```csv
instrument_name,open,high,low,close,vol,vol_ccy,vol_quote,open_time,confirm
ETH-USDT-SWAP,3839.44,3843.58,3836.71,3838.16,23503.2,2350.32,9024127.30277,1761148800000,1
```

**å¿…éœ€å­—æ®µ**:
- `open_time`: æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
- `open`, `high`, `low`, `close`: OHLCä»·æ ¼
- `vol`: æˆäº¤é‡

#### æ•°æ®è·å–æ–¹å¼

1. **äº¤æ˜“æ‰€APIä¸‹è½½**
2. **ç¬¬ä¸‰æ–¹æ•°æ®æä¾›å•†**
3. **è‡ªå·±é‡‡é›†å­˜å‚¨**

#### æ•°æ®ç®¡ç†å»ºè®®

```bash
# æŒ‰äº¤æ˜“å¯¹åˆ†ç±»
data/
â”œâ”€â”€ ETH-USDT/
â”‚   â”œâ”€â”€ 2025-10-01.csv
â”‚   â”œâ”€â”€ 2025-10-02.csv
â”‚   â””â”€â”€ ...
â”œâ”€â”€ BTC-USDT/
â”‚   â””â”€â”€ ...
â””â”€â”€ SOL-USDT/
    â””â”€â”€ ...

# æˆ–æŒ‰æ—¶é—´åˆ†ç±»
data/
â”œâ”€â”€ 2025-10/
â”‚   â”œâ”€â”€ ETH-USDT-1m.csv
â”‚   â”œâ”€â”€ BTC-USDT-1m.csv
â”‚   â””â”€â”€ ...
â””â”€â”€ 2025-11/
    â””â”€â”€ ...
```

---

### 4. core/ - æ ¸å¿ƒä»£ç ç›®å½•

#### ç›®å½•ç”¨é€”
å­˜æ”¾å›æµ‹ç³»ç»Ÿçš„æ ¸å¿ƒå®ç°ä»£ç ã€‚

#### æ¨¡å—è¯´æ˜

**data_loader.py** - æ•°æ®åŠ è½½å™¨
```python
class DataLoader:
    """å†å²æ•°æ®åŠ è½½å™¨"""
    
    def load(self) -> pd.DataFrame:
        """åŠ è½½CSVæ•°æ®"""
        
    def resample_to_5m(self) -> pd.DataFrame:
        """é‡é‡‡æ ·ä¸º5åˆ†é’Ÿ"""
        
    def to_klines(self, df) -> List[Dict]:
        """è½¬æ¢ä¸ºç­–ç•¥æ ¼å¼"""
```

**backtest_engine.py** - å›æµ‹å¼•æ“
```python
class BacktestEngine:
    """å›æµ‹å¼•æ“"""
    
    def run(self, klines, window_size) -> Dict:
        """è¿è¡Œå›æµ‹"""
        
    def _execute_signal(self, signal):
        """æ‰§è¡Œäº¤æ˜“ä¿¡å·"""
        
    def _generate_report(self) -> Dict:
        """ç”Ÿæˆå›æµ‹æŠ¥å‘Š"""
```

**performance_analyzer.py** - æ€§èƒ½åˆ†æå™¨
```python
class PerformanceAnalyzer:
    """æ€§èƒ½åˆ†æå™¨"""
    
    @staticmethod
    def print_report(result):
        """æ‰“å°å›æµ‹æŠ¥å‘Š"""
        
    @staticmethod
    def save_to_file(result, filename):
        """ä¿å­˜ç»“æœåˆ°æ–‡ä»¶"""
```

#### ä»£ç è§„èŒƒ

- âœ… ç±»å‹æ³¨è§£å®Œæ•´
- âœ… æ–‡æ¡£å­—ç¬¦ä¸²è¯¦ç»†
- âœ… å•ä¸€èŒè´£åŸåˆ™
- âœ… æ˜“äºæµ‹è¯•å’Œæ‰©å±•

---

### 5. results/ - å›æµ‹ç»“æœç›®å½•

#### ç›®å½•ç”¨é€”
å­˜æ”¾æ‰€æœ‰å›æµ‹ç”Ÿæˆçš„ç»“æœæ–‡ä»¶ã€‚

#### æ–‡ä»¶å‘½åè§„èŒƒ
```
backtest_result_{timestamp}.json

ç¤ºä¾‹:
backtest_result_20251025_204424.json
backtest_result_20251025_210530.json
```

#### ç»“æœæ–‡ä»¶å†…å®¹

```json
{
  "summary": {
    "initial_capital": 300.0,
    "final_capital": 315.5,
    "total_pnl": 15.5,
    "total_return": 5.17,
    "total_trades": 10,
    "winning_trades": 6,
    "losing_trades": 4,
    "win_rate": 60.0,
    "max_drawdown": 8.5
  },
  "trades": [
    {
      "entry_time": "2025-10-23 08:15:00",
      "exit_time": "2025-10-23 08:45:00",
      "side": "long",
      "entry_price": 3850.0,
      "exit_price": 3865.0,
      "pnl_amount": 4.5,
      "pnl_ratio": 0.0039
    }
  ],
  "equity_curve": [...]
}
```

#### ç»“æœç®¡ç†

**æŒ‰æ—¥æœŸå½’æ¡£**:
```bash
results/
â”œâ”€â”€ 2025-10/
â”‚   â”œâ”€â”€ backtest_result_20251025_204424.json
â”‚   â””â”€â”€ ...
â””â”€â”€ 2025-11/
    â””â”€â”€ ...
```

**æ¸…ç†æ—§ç»“æœ**:
```bash
# åˆ é™¤30å¤©å‰çš„ç»“æœ
find backtest/results -name "*.json" -mtime +30 -delete
```

---

## å·¥ä½œæµç¨‹

### æ ‡å‡†å›æµ‹æµç¨‹

```
1. å‡†å¤‡æ•°æ®
   â†“
   å°†CSVæ–‡ä»¶æ”¾å…¥ data/ ç›®å½•
   
2. é…ç½®å›æµ‹
   â†“
   ç¼–è¾‘ configs/backtest_config.json
   
3. è¿è¡Œå›æµ‹
   â†“
   python backtest/run_backtest.py
   
4. æŸ¥çœ‹ç»“æœ
   â†“
   æŸ¥çœ‹ results/ ç›®å½•ä¸­çš„JSONæ–‡ä»¶
   
5. åˆ†æä¼˜åŒ–
   â†“
   æ ¹æ®ç»“æœè°ƒæ•´ç­–ç•¥å‚æ•°
   
6. é‡å¤æµ‹è¯•
   â†“
   åˆ›å»ºæ–°é…ç½®ï¼Œç»§ç»­å›æµ‹
```

### æ‰¹é‡å›æµ‹æµç¨‹

```python
# æ‰¹é‡æµ‹è¯•è„šæœ¬ç¤ºä¾‹
configs = [
    'backtest/configs/conservative.json',
    'backtest/configs/balanced.json',
    'backtest/configs/aggressive.json'
]

for config in configs:
    subprocess.run(['python', 'backtest/run_backtest.py', '--config', config])
```

---

## æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„æ•°æ®æº

1. åœ¨ `core/data_loader.py` ä¸­æ·»åŠ æ–°çš„åŠ è½½æ–¹æ³•
2. æ›´æ–°é…ç½®æ–‡ä»¶æ”¯æŒæ–°æ ¼å¼
3. æµ‹è¯•æ•°æ®åŠ è½½åŠŸèƒ½

### æ·»åŠ æ–°çš„æ€§èƒ½æŒ‡æ ‡

1. åœ¨ `core/performance_analyzer.py` ä¸­æ·»åŠ è®¡ç®—æ–¹æ³•
2. æ›´æ–°æŠ¥å‘Šè¾“å‡ºæ ¼å¼
3. æ›´æ–°è¯„çº§ç³»ç»Ÿ

### æ·»åŠ å¯è§†åŒ–åŠŸèƒ½

1. åˆ›å»º `core/visualizer.py`
2. å®ç°æƒç›Šæ›²çº¿å›¾è¡¨
3. å®ç°äº¤æ˜“ä¿¡å·æ ‡æ³¨
4. é›†æˆåˆ°å›æµ‹æµç¨‹

---

## ç»´æŠ¤å»ºè®®

### å®šæœŸæ¸…ç†

```bash
# æ¸…ç†ç¼“å­˜æ–‡ä»¶
find backtest -name "__pycache__" -type d -exec rm -rf {} +
find backtest -name "*.pyc" -delete

# æ¸…ç†æ—§ç»“æœï¼ˆä¿ç•™æœ€è¿‘30å¤©ï¼‰
find backtest/results -name "*.json" -mtime +30 -delete
```

### å¤‡ä»½é‡è¦æ•°æ®

```bash
# å¤‡ä»½é…ç½®æ–‡ä»¶
tar -czf backtest_configs_backup.tar.gz backtest/configs/

# å¤‡ä»½å†å²æ•°æ®
tar -czf backtest_data_backup.tar.gz backtest/data/

# å¤‡ä»½é‡è¦ç»“æœ
tar -czf backtest_results_backup.tar.gz backtest/results/
```

### ç‰ˆæœ¬æ§åˆ¶

**åº”è¯¥æäº¤åˆ°Git**:
- âœ… `core/` ç›®å½•ä¸‹çš„æ‰€æœ‰ä»£ç 
- âœ… `configs/` ç›®å½•ä¸‹çš„é…ç½®æ¨¡æ¿
- âœ… `README.md` ç­‰æ–‡æ¡£

**ä¸åº”è¯¥æäº¤åˆ°Git**:
- âŒ `data/` ç›®å½•ï¼ˆæ•°æ®æ–‡ä»¶å¤ªå¤§ï¼‰
- âŒ `results/` ç›®å½•ï¼ˆç»“æœæ–‡ä»¶å¤ªå¤šï¼‰
- âŒ `__pycache__/` ç›®å½•
- âŒ `*.pyc` æ–‡ä»¶

**.gitignore é…ç½®**:
```
backtest/data/*.csv
backtest/results/*.json
backtest/**/__pycache__/
backtest/**/*.pyc
```

---

## æ€»ç»“

âœ… **æ¸…æ™°çš„ç›®å½•ç»“æ„**
- configs/: é…ç½®æ–‡ä»¶
- data/: å†å²æ•°æ®
- core/: æ ¸å¿ƒä»£ç 
- results/: å›æµ‹ç»“æœ

âœ… **ä¸“ä¸šçš„è®¾è®¡**
- é…ç½®é©±åŠ¨
- æ¨¡å—åŒ–ä»£ç 
- æ˜“äºæ‰©å±•
- ä¾¿äºç»´æŠ¤

âœ… **å®Œæ•´çš„æ–‡æ¡£**
- README.md: ä½¿ç”¨æŒ‡å—
- æœ¬æ–‡æ¡£: ç›®å½•ç»“æ„è¯´æ˜
- ä»£ç æ³¨é‡Š: å®ç°ç»†èŠ‚

ç°åœ¨ä½ æ‹¥æœ‰ä¸€ä¸ªä¸“ä¸šã€ä¼˜é›…ã€æ˜“ç”¨çš„å›æµ‹ç³»ç»Ÿï¼ğŸ‰

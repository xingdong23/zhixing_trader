# EMA144 趋势跟踪策略

## 策略概述

EMA144趋势跟踪策略是一个基于单一EMA144均线的简洁趋势跟踪策略。该策略使用EMA144作为多空分界线，在价格回踩时进场，配合固定止损和移动止盈来保护利润。

## 核心逻辑

### 多空判断
- **EMA144以上区域**：只做多，不做空
- **EMA144以下区域**：只做空，不做多

### 入场条件

#### 做多信号
1. 价格在EMA144上方
2. 价格回踩至EMA144附近（距离在设定范围内）
3. 最近几根K线的最低价触及或接近EMA144

#### 做空信号
1. 价格在EMA144下方
2. 价格反弹至EMA144附近（距离在设定范围内）
3. 最近几根K线的最高价触及或接近EMA144

### 出场条件

#### 固定止损
- 做多：-10%（可配置）
- 做空：+10%（可配置）

#### 固定止盈
- 使用风险回报比计算（默认3:1）
- 做多：止盈 = 入场价 + (止损距离 × 3)
- 做空：止盈 = 入场价 - (止损距离 × 3)

#### 移动止盈（Trailing Stop）
- **激活条件**：盈利超过2%（可配置）
- **跟踪距离**：当前价格的5%（可配置）
- **更新规则**：
  - 做多：只有当新止损高于原止损时才更新
  - 做空：只有当新止损低于原止损时才更新

#### 趋势反转
- 做多：价格跌破EMA144
- 做空：价格突破EMA144

#### 持仓超时
- 默认72小时强制平仓（可配置）

## 配置参数

### 入场参数
```json
{
  "entry_conditions": {
    "pullback_threshold": 0.02,        // 回踩阈值 ±2%
    "entry_distance_min": -0.005,      // 最小距离 -0.5%
    "entry_distance_max": 0.02,        // 最大距离 +2%
    "pullback_lookback": 5             // 回踩确认K线数量
  }
}
```

### 风险管理
```json
{
  "risk_management": {
    "total_capital": 300.0,              // 总资金
    "leverage": 2.0,                     // 杠杆倍数
    "risk_per_trade": 0.02,              // 每次交易风险（保守模式）
    "use_leverage_sizing": true,         // 是否使用杠杆仓位计算
    "position_ratio": 0.5,               // 仓位比例（激进模式）
    "reduce_position_after_loss": true   // 亏损后减仓
  }
}
```

### 止损止盈参数
```json
{
  "stop_loss_take_profit": {
    "stop_loss_pct": 0.10,               // 固定止损 10%
    "risk_reward_ratio": 3.0,            // 风险回报比 3:1
    "use_ema144_break": true,            // 启用EMA144突破出场
    "use_trailing_stop": true,           // 启用移动止盈
    "trailing_activation_pct": 0.02,     // 移动止盈激活阈值 2%
    "trailing_stop_pct": 0.05            // 移动止盈距离 5%
  }
}
```

### 风控参数
```json
{
  "daily_risk_controls": {
    "max_daily_loss": 0.05,                      // 日内最大亏损 5%
    "max_consecutive_losses": 3,                 // 最大连续亏损次数
    "pause_hours_after_consecutive_loss": 24     // 触发后暂停交易时间
  }
}
```

## 策略优势

### 1. 逻辑简单
- 仅使用一条EMA144均线
- 规则清晰明确
- 易于理解和执行

### 2. 顺势而为
- EMA144作为趋势过滤器
- 只在趋势方向上交易
- 避免逆势交易

### 3. 风险可控
- 固定止损10%
- 移动止盈保护利润
- 连续亏损熔断机制

### 4. 适应性强
- 参数可灵活配置
- 适用于不同周期
- 支持多种市场环境

## 使用示例

### 运行回测
```bash
cd /Users/chengzheng/workspace/chuangxin/zhixing_trader/bitcoin_trader

# 运行EMA144策略回测
python backtest/run_backtest.py --config backtest/configs/ema144_trend_1h_6m.json
```

### 查看结果
回测结果会保存在 `backtest/results/` 目录下，包括：
- JSON格式的详细结果
- 交易记录
- 权益曲线数据

## 策略适用场景

### 适合
- 趋势市场（单边行情）
- 中长期交易（持仓数小时到数天）
- 波动较大的品种（如加密货币）

### 不适合
- 震荡市场（频繁触发止损）
- 高频交易（入场机会较少）
- 波动极小的品种（止损空间不足）

## 优化建议

### 1. 参数优化
- 根据不同品种调整EMA周期
- 根据波动率调整止损止盈比例
- 根据市场状态调整回踩阈值

### 2. 过滤器增强
- 添加成交量过滤
- 添加波动率过滤
- 添加时段过滤

### 3. 出场优化
- 根据ATR动态调整移动止盈距离
- 增加部分止盈机制
- 增加时间止盈

## 注意事项

1. **回踩判断的准确性**
   - 需要足够的K线确认回踩
   - 避免假突破

2. **止损设置**
   - 10%的固定止损在某些市场可能过大或过小
   - 建议根据品种波动率调整

3. **移动止盈时机**
   - 过早激活可能错过大趋势
   - 过晚激活可能回吐利润

4. **持仓时间**
   - 趋势策略需要给予足够的持仓时间
   - 避免频繁换仓

## 版本历史

- **v1.0** (2024-10-30): 初始版本，实现基础EMA144趋势跟踪功能

## 作者
策略开发团队

## 许可
内部使用


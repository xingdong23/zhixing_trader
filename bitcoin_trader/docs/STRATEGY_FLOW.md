# 稳健盈利策略执行流程图

## 🔄 完整执行流程

```
┌─────────────────────────────────────────────────────────────┐
│                    策略执行流程开始                           │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ▼
┌──────────────────────────────────────────────────────────────┐
│  步骤1: 检查单日回撤限制                                      │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ if 今日累计亏损 >= 账户 × 3%:                        │   │
│  │     return "停止交易，明天再来"                       │   │
│  └──────────────────────────────────────────────────────┘   │
└──────────────────────────┬──────────────────────────────────┘
                           │ 未触及限制
                           ▼
┌──────────────────────────────────────────────────────────────┐
│  步骤2: 三线定趋势                                            │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ 第一线：日线定方向（200 EMA）                        │   │
│  │ ├─ 价格 > EMA200 且斜率向上 → 上升趋势               │   │
│  │ ├─ 价格 < EMA200 且斜率向下 → 下降趋势               │   │
│  │ └─ 其他 → 震荡趋势                                   │   │
│  │                                                         │   │
│  │ 第二线：4小时找结构                                   │   │
│  │ ├─ 寻找双底形态 → 看多信号                           │   │
│  │ ├─ 寻找双顶形态 → 看空信号                           │   │
│  │ └─ 寻找突破形态 → 跟随方向                           │   │
│  │                                                         │   │
│  │ 第三线：15分钟找入场                                  │   │
│  │ ├─ 快线上穿慢线（金叉）→ 做多入场                    │   │
│  │ └─ 快线下穿慢线（死叉）→ 做空入场                    │   │
│  └──────────────────────────────────────────────────────┘   │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ▼
┌──────────────────────────────────────────────────────────────┐
│  步骤3: 计算趋势强度系数                                      │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ 使用ADX指标判断：                                     │   │
│  │ ├─ ADX >= 25 → 单边市 → 系数 = 0.8                  │   │
│  │ └─ ADX < 25  → 震荡市 → 系数 = 0.3                  │   │
│  └──────────────────────────────────────────────────────┘   │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ▼
┌──────────────────────────────────────────────────────────────┐
│  步骤4: 分析市场情绪（反向思维）                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ 情绪评分 = RSI×50% + 成交量变化×30% + 波动率×20%    │   │
│  │                                                         │   │
│  │ ├─ 评分 < 25  → 极度恐慌 → 寻找做多机会 🔺          │   │
│  │ ├─ 评分 25-75 → 中性     → 跟随趋势                  │   │
│  │ └─ 评分 > 75  → 极度贪婪 → 警惕做空机会 🔻          │   │
│  └──────────────────────────────────────────────────────┘   │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ▼
┌──────────────────────────────────────────────────────────────┐
│  步骤5: 生成交易信号                                          │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ 做多条件（三个条件同时满足）：                        │   │
│  │ 1. (上升趋势) OR (震荡趋势 + 极度恐慌)               │   │
│  │ 2. 4小时有看多结构（双底/突破）                      │   │
│  │ 3. 15分钟金叉入场                                    │   │
│  │                                                         │   │
│  │ 做空条件（三个条件同时满足）：                        │   │
│  │ 1. (下降趋势) OR (震荡趋势 + 极度贪婪)               │   │
│  │ 2. 4小时有看空结构（双顶/突破）                      │   │
│  │ 3. 15分钟死叉入场                                    │   │
│  └──────────────────────────────────────────────────────┘   │
└──────────────────────────┬──────────────────────────────────┘
                           │
           ┌───────────────┴───────────────┐
           │                               │
       信号=hold                       信号=buy/sell
           │                               │
           ▼                               ▼
    ┌─────────────┐        ┌──────────────────────────────────┐
    │  返回观望    │        │  步骤6: 计算仓位和止损止盈        │
    └─────────────┘        │  ┌────────────────────────────┐  │
                           │  │ 仓位计算：                  │  │
                           │  │ 初始仓位 = 账户1% × 系数    │  │
                           │  │ 限制最大10%                │  │
                           │  │                            │  │
                           │  │ 止损计算（三重锚）：        │  │
                           │  │ 1. ATR止损 = 价格 ± 1.5ATR │  │
                           │  │ 2. 斐波那契止损 = 38.2%位  │  │
                           │  │ 3. 回撤止损 = 当前价×97%   │  │
                           │  │ → 选择最保守的一个          │  │
                           │  │                            │  │
                           │  │ 止盈计算（金字塔）：        │  │
                           │  │ 目标1 = 入场 + 2×风险      │  │
                           │  │   → 平仓50%，移动止损      │  │
                           │  │ 目标2 = 入场 + 4×风险      │  │
                           │  │   → 平仓30%                │  │
                           │  │ 剩余20% → 追踪止损         │  │
                           │  └────────────────────────────┘  │
                           └──────────────┬───────────────────┘
                                          │
                                          ▼
                           ┌──────────────────────────────────┐
                           │  返回完整交易信号：               │
                           │  ├─ signal: buy/sell             │
                           │  ├─ price: 入场价格              │
                           │  ├─ position_ratio: 仓位比例     │
                           │  ├─ stop_loss: 止损价            │
                           │  ├─ take_profit_levels: 止盈目标 │
                           │  ├─ risk_reward_ratio: 风险收益比│
                           │  └─ reason: 信号原因             │
                           └──────────────┬───────────────────┘
                                          │
                                          ▼
                           ┌──────────────────────────────────┐
                           │      策略执行流程结束             │
                           └──────────────────────────────────┘
```

---

## 📊 仓位管理详细流程

```
账户总资金: $100,000
└─ 基础仓位: 1% = $1,000
   └─ × 趋势强度系数
      ├─ 震荡市 (ADX < 25): × 0.3 = $300
      └─ 单边市 (ADX ≥ 25): × 0.8 = $800
         └─ 检查最大限制
            ├─ ≤ 10% ($10,000) → ✅ 通过
            └─ > 10% → ❌ 限制为 $10,000
```

---

## 🛡️ 三重止损机制

```
入场价: $50,000
├─ 止损方案1: ATR止损
│  └─ $50,000 - (1.5 × ATR) = $49,250
│
├─ 止损方案2: 斐波那契止损
│  └─ 最低点 + (最高点 - 最低点) × 38.2% = $49,400
│
└─ 止损方案3: 回撤止损
   └─ $50,000 × (1 - 3%) = $48,500

最终止损 = MAX($49,250, $49,400, $48,500) = $49,400 (最保守)
```

---

## 🎯 金字塔止盈流程

```
入场价: $50,000
止损价: $49,400
风险: $600
初始仓位: 1 BTC

第一目标: $50,000 + (2 × $600) = $51,200
├─ 达到时操作:
│  ├─ 平仓 50% (0.5 BTC)
│  │  └─ 锁定利润: 0.5 × $1,200 = $600
│  └─ 止损移至成本线: $50,000
│     └─ 剩余仓位 (0.5 BTC) 现在不会亏损

第二目标: $50,000 + (4 × $600) = $52,400
├─ 达到时操作:
│  ├─ 再平仓 30% (0.3 BTC)
│  │  └─ 再锁定利润: 0.3 × $2,400 = $720
│  └─ 总锁定: $600 + $720 = $1,320

剩余仓位: 20% (0.2 BTC)
└─ 使用追踪止损
   ├─ 价格上涨至 $53,000
   │  └─ 止损移至 $52,000 (跟随价格)
   ├─ 价格上涨至 $54,000
   │  └─ 止损移至 $53,000
   └─ 价格回落触发止损
      └─ $53,000 × 0.2 BTC = 再赚 $600

总利润: $600 + $720 + $600 = $1,920 (38.4%收益率)
```

---

## 🔄 实时监控流程

```
持仓状态监控循环
│
├─ 检查1: 价格是否触及止损?
│  └─ 是 → 立即平仓，记录亏损
│
├─ 检查2: 价格是否达到第一止盈目标?
│  └─ 是 → 平仓50%，止损移至成本线
│
├─ 检查3: 价格是否达到第二止盈目标?
│  └─ 是 → 平仓30%，启动追踪止损
│
├─ 检查4: 追踪止损是否触发?
│  └─ 是 → 平掉剩余20%
│
└─ 检查5: 单日亏损是否达到3%?
   └─ 是 → 平掉所有持仓，今日停止交易
```

---

## 📈 情绪指标计算流程

```
市场情绪评分 (0-100)
│
├─ RSI (50%权重)
│  ├─ RSI > 70 → 超买 → 贡献高分
│  ├─ RSI < 30 → 超卖 → 贡献低分
│  └─ RSI = 50 → 中性 → 贡献50分
│
├─ 成交量变化 (30%权重)
│  ├─ 成交量暴增 → 情绪激烈 → 贡献高分
│  ├─ 成交量缩减 → 情绪低迷 → 贡献低分
│  └─ 成交量正常 → 中性 → 贡献50分
│
└─ 波动率 (20%权重)
   ├─ 波动率高 → 恐慌/贪婪 → 贡献高分
   └─ 波动率低 → 平静 → 贡献低分

综合评分:
├─ 0-25: 极度恐慌 😱 → 反向做多机会
├─ 25-75: 中性 😐 → 跟随趋势
└─ 75-100: 极度贪婪 🤑 → 反向做空机会
```

---

## 🎮 实际交易示例

### 场景1: 上升趋势 + 双底 + 金叉

```
1. 日线: 价格在200EMA之上 → ✅ 上升趋势
2. 4H: 发现双底形态 → ✅ 看多结构
3. 15M: 12EMA上穿26EMA → ✅ 金叉入场
4. ADX: 30 → 单边市 → 系数0.8
5. 情绪: 45 → 中性

→ 生成买入信号
  ├─ 入场: $50,000
  ├─ 仓位: $100,000 × 1% × 0.8 = $800
  ├─ 止损: $49,400
  ├─ 目标1: $51,200 (平50%)
  └─ 目标2: $52,400 (平30%)
```

### 场景2: 震荡趋势 + 极度恐慌 + 金叉

```
1. 日线: 价格在200EMA附近震荡 → 震荡趋势
2. 情绪: 20 → ✅ 极度恐慌（反向机会）
3. 4H: 双底突破 → ✅ 看多结构
4. 15M: 金叉 → ✅ 入场信号
5. ADX: 20 → 震荡市 → 系数0.3

→ 生成买入信号（抄底）
  ├─ 入场: $48,000
  ├─ 仓位: $100,000 × 1% × 0.3 = $300 (较小仓位)
  ├─ 止损: $47,200
  └─ 风险较小，适合震荡市抄底
```

### 场景3: 下降趋势 + 极度贪婪 + 死叉

```
1. 日线: 价格在200EMA之下 → 下降趋势
2. 情绪: 85 → ✅ 极度贪婪（反向机会）
3. 4H: 双顶形态 → ✅ 看空结构
4. 15M: 死叉 → ✅ 做空入场
5. ADX: 35 → 单边市 → 系数0.8

→ 生成卖出信号
  ├─ 入场: $52,000
  ├─ 仓位: $100,000 × 1% × 0.8 = $800
  ├─ 止损: $52,800
  ├─ 目标1: $50,400 (平50%)
  └─ 目标2: $48,800 (平30%)
```

---

## 📋 每日交易检查清单

```
早盘准备:
□ 检查账户余额
□ 计算今日可用资金
□ 查看昨日盈亏
□ 重置单日回撤计数

盘中监控:
□ 每15分钟检查信号
□ 监控持仓止损止盈
□ 记录交易原因
□ 更新单日盈亏

盘后复盘:
□ 统计今日交易次数
□ 计算胜率和盈亏
□ 分析失败原因
□ 调整明日策略
```

---

这个流程图详细展示了策略的每一步执行逻辑，方便理解和实现！


# 🧪 功能测试指南

> **目的**: 快速测试新开发的功能  
> **更新时间**: 2025年10月18日

---

## 🚀 立即开始测试

### 1. 确保服务已启动

```bash
cd /Users/chengzheng/workspace/chuangxin/zhixing_trader/zhixing_fronted
npm run dev
```

服务地址: `http://localhost:3000`

---

## ✅ 测试清单 - 券商连接设置

### 步骤1: 访问设置页面 (10秒)

1. 打开浏览器访问 `http://localhost:3000`
2. 查看左侧边栏底部,应该看到 **"⚙️ 券商设置"** 按钮
3. 点击按钮,应该跳转到 `/settings/brokers`

**预期结果**:
- ✅ 页面顺利跳转
- ✅ 看到两个大卡片(IBKR蓝色 + Longbridge紫色)
- ✅ 顶部有"返回"按钮
- ✅ 标题显示"券商连接设置"

---

### 步骤2: 测试IBKR连接 (30秒)

#### 2.1 连接IBKR
1. 在IBKR卡片中,保持默认配置:
   - 主机地址: `127.0.0.1`
   - 端口: `7497`
   - Client ID: `1`
2. 点击 **"连接 IBKR"** 按钮
3. 观察按钮变成 "连接中..." (旋转图标)
4. 2秒后应该显示成功提示

**预期结果**:
- ✅ 按钮显示加载状态
- ✅ 2秒后右上角弹出绿色Toast: "✅ 成功连接到 IBKR"
- ✅ 卡片右上角状态从"未连接"变为"已连接"(绿色徽章)
- ✅ 连接配置区域消失,显示绿色成功消息框
- ✅ 出现"同步交易记录"和"断开连接"按钮

#### 2.2 同步交易记录
1. 点击 **"同步交易记录"** 按钮
2. 观察按钮变成 "同步中..."
3. 3秒后应该显示同步成功

**预期结果**:
- ✅ 按钮显示同步中状态
- ✅ 3秒后弹出Toast: "✅ 同步完成 - 成功同步 X 条交易记录" (X是5-20的随机数)
- ✅ 同步历史列表顶部出现新记录
- ✅ 显示"上次同步"时间

#### 2.3 验证数据生成
1. 打开浏览器开发者工具 (F12)
2. 切换到 **Console** 标签
3. 输入: `JSON.parse(localStorage.getItem('trades'))`
4. 按回车查看数据

**预期结果**:
- ✅ 看到一个数组
- ✅ 数组包含新生成的交易记录
- ✅ 每条记录有 `source: 'ibkr'` 和 `synced: true` 字段
- ✅ 数据格式正确(symbol, entryPrice, exitPrice, etc.)

#### 2.4 断开连接
1. 点击 **"断开连接"** 按钮

**预期结果**:
- ✅ 弹出Toast: "已断开 IBKR 连接"
- ✅ 状态徽章变回"未连接"
- ✅ 重新显示连接配置表单

---

### 步骤3: 测试Longbridge连接 (20秒)

#### 3.1 连接Longbridge
1. 在Longbridge卡片中,填写测试凭证(任意值):
   - App Key: `test123`
   - App Secret: `secret456`
   - Access Token: `token789`
2. 点击 **"连接 Longbridge"** 按钮
3. 2秒后查看结果

**预期结果**:
- ✅ 按钮显示"连接中..."
- ✅ 2秒后成功连接
- ✅ 状态变为"已连接"
- ✅ 出现同步和断开按钮

#### 3.2 测试同步
1. 点击"同步交易记录"
2. 等待3秒

**预期结果**:
- ✅ 同步成功
- ✅ 同步历史增加新记录
- ✅ 显示紫色"LB"标识

---

### 步骤4: 测试自动同步设置 (10秒)

1. 滚动到"自动同步设置"卡片
2. 点击"启用自动同步"开关
3. 观察下方出现配置选项

**预期结果**:
- ✅ 开关切换成功
- ✅ 显示"同步频率"下拉框
- ✅ 显示"同步时间段"时间选择器
- ✅ 可以修改频率(5/15/30/60分钟)
- ✅ 可以修改时间段

---

### 步骤5: 测试同步历史 (5秒)

1. 滚动到"同步历史"卡片
2. 查看同步记录列表

**预期结果**:
- ✅ 看到之前的同步记录
- ✅ 每条记录显示:
  - 券商Logo (IB或LB)
  - 券商名称
  - 同步时间
  - 记录数量(绿色徽章)

---

### 步骤6: 测试导航 (10秒)

#### 6.1 返回首页
1. 点击顶部"返回"按钮

**预期结果**:
- ✅ 跳转回首页 (`/`)
- ✅ 看到股票列表

#### 6.2 再次进入设置
1. 点击侧边栏底部"券商设置"
2. 查看页面状态

**预期结果**:
- ✅ 跳转到设置页面
- ✅ 之前的连接状态**未保持**(因为我们断开了)
- ✅ 如果之前连接了且没断开,应该保持连接状态

---

### 步骤7: 测试暗色模式 (5秒)

1. 在系统中切换到暗色模式
2. 查看页面样式

**预期结果**:
- ✅ 卡片背景变深
- ✅ 文字颜色适配
- ✅ 渐变色仍然美观
- ✅ 徽章颜色清晰

---

## 🔍 深度测试

### 测试1: 数据持久化

```javascript
// 在浏览器Console执行

// 1. 查看IBKR配置
console.log('IBKR Config:', localStorage.getItem('ibkr_config'));

// 2. 查看Longbridge配置
console.log('Longbridge Config:', localStorage.getItem('longbridge_config'));

// 3. 查看交易数据
const trades = JSON.parse(localStorage.getItem('trades') || '[]');
console.log('Total Trades:', trades.length);
console.log('Synced Trades:', trades.filter(t => t.synced).length);
console.log('IBKR Trades:', trades.filter(t => t.source === 'ibkr').length);

// 4. 查看最新的5条交易
console.table(trades.slice(0, 5));
```

**预期结果**:
- ✅ IBKR配置包含host, port, clientId, connected等字段
- ✅ 交易数据正确保存
- ✅ 同步的交易有`synced: true`和`source`字段

---

### 测试2: 错误场景

#### 场景1: 空凭证连接Longbridge
1. 清空所有输入框
2. 点击连接

**预期结果**:
- ✅ 弹出红色Toast: "请填写完整的连接信息"
- ✅ 不执行连接

#### 场景2: 快速重复点击
1. 点击"连接 IBKR"
2. 在连接完成前再次点击

**预期结果**:
- ✅ 按钮在加载状态时被禁用
- ✅ 不会重复执行连接

---

### 测试3: 性能测试

#### 多次同步测试
1. 连接IBKR
2. 连续点击"同步交易记录" 3次
3. 等待所有同步完成
4. 检查localStorage中的数据

**预期结果**:
- ✅ 每次同步都生成新数据
- ✅ 数据累积,不会覆盖
- ✅ 同步历史正确记录3次
- ✅ localStorage数据量合理(不会过大)

---

## 📊 测试报告模板

完成测试后,填写此报告:

```markdown
## 测试报告

**测试人**: [你的名字]
**测试时间**: [日期时间]
**浏览器**: [Chrome/Firefox/Safari] [版本号]

### 功能测试结果

| 功能 | 状态 | 备注 |
|------|------|------|
| 页面跳转 | ✅/❌ | |
| IBKR连接 | ✅/❌ | |
| IBKR同步 | ✅/❌ | |
| IBKR断开 | ✅/❌ | |
| Longbridge连接 | ✅/❌ | |
| Longbridge同步 | ✅/❌ | |
| 自动同步设置 | ✅/❌ | |
| 同步历史显示 | ✅/❌ | |
| 数据持久化 | ✅/❌ | |
| 暗色模式 | ✅/❌ | |

### 发现的问题

1. [问题描述]
2. [问题描述]

### 改进建议

1. [建议]
2. [建议]

### 总体评价

[优秀/良好/一般/需改进]
```

---

## 🐛 常见问题排查

### Q1: 点击"券商设置"没反应?
**排查步骤**:
1. 检查浏览器Console是否有错误
2. 确认页面已完全加载
3. 刷新页面重试

### Q2: 连接后状态没变化?
**排查步骤**:
1. 检查网络延迟(模拟延迟2秒)
2. 等待足够时间
3. 查看Console是否有错误

### Q3: 同步后没看到数据?
**排查步骤**:
1. 打开Console执行: `console.log(JSON.parse(localStorage.getItem('trades')))`
2. 检查是否有数据
3. 返回交易列表页面查看
4. 刷新页面

### Q4: Toast通知没显示?
**排查步骤**:
1. 检查是否安装了`sonner`包
2. 确认页面引入了Toast组件
3. 查看浏览器设置是否阻止了通知

---

## 🎉 测试完成标准

完成以下所有项即视为测试通过:

- ✅ 所有功能按钮可点击
- ✅ 加载状态正确显示
- ✅ Toast通知正常弹出
- ✅ 数据正确保存到localStorage
- ✅ 页面跳转正常
- ✅ 暗色模式显示正常
- ✅ 没有Console错误
- ✅ 没有明显UI问题

---

## 📝 测试反馈

请将测试结果反馈给开发团队:

**反馈内容**:
1. 功能是否满足需求?
2. UI是否美观易用?
3. 交互是否流畅?
4. 有哪些改进建议?

**反馈方式**:
- 直接口头反馈
- 填写测试报告
- 记录在项目文档中

---

**祝测试顺利! 🚀**



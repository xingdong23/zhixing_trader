# 市场情绪监控功能说明

## 功能概述

基于您的交易策略需求，实现了市场情绪监控功能，帮助您根据恐慌贪婪指数动态调整小盘股/大盘股投资策略。

## 策略逻辑

**核心规则：**
- 当恐慌贪婪指数 > 标普500基准值时 → 适合买入小盘股
- 当恐慌贪婪指数 ≤ 标普500基准值时 → 建议转向大盘股

**策略说明：**
- 小盘股在市场情绪较好时往往有更大的上涨空间
- 大盘股在市场情绪偏弱时更加稳健安全
- 通过情绪指标动态调整持仓结构，降低风险

## 功能特性

### 1. 实时监控
- 显示当前恐慌贪婪指数
- 显示标普500基准值
- 自动计算市场情绪等级（极度恐慌/恐慌/中性/贪婪/极度贪婪）
- 每5分钟自动更新数据

### 2. 策略建议
- 根据指数对比自动给出策略建议
- 清晰的视觉提示（绿色=小盘股，蓝色=大盘股）
- 详细的策略说明和理由

### 3. 可视化展示
- 进度条直观显示指数位置
- 颜色编码的情绪等级
- 实时时间戳显示

## 使用方法

### 访问入口
1. 启动前端：`pnpm dev`
2. 在左侧导航栏点击"市场情绪"
3. 查看当前市场情绪和策略建议

### 手动刷新
点击页面底部的"立即刷新数据"按钮可手动更新数据

## 技术实现

### 前端组件
- **位置**: `/components/market/MarketSentimentMonitor.tsx`
- **功能**: 
  - 显示恐慌贪婪指数和标普500基准
  - 计算情绪等级和策略建议
  - 自动定时更新数据

### API接口
- **位置**: `/app/api/market/sentiment/route.ts`
- **端点**: `GET /api/market/sentiment`
- **返回格式**:
```json
{
  "success": true,
  "data": {
    "fearGreedIndex": 65,
    "sp500Index": 50,
    "sentiment": "greed",
    "recommendation": "small_cap",
    "timestamp": "2025-10-22T09:58:00.000Z",
    "source": "mock"
  }
}
```

### 当前状态
- ✅ 前端UI完成
- ✅ API接口框架完成
- ⚠️ 使用Mock数据（需要集成老虎证券API）

## 集成老虎证券API

### 步骤1: 获取API密钥
1. 访问老虎证券开放平台：https://quant.itigerup.com/
2. 注册并申请API密钥
3. 获取以下信息：
   - Tiger ID (API Key)
   - Private Key (Secret Key)
   - Account ID

### 步骤2: 配置环境变量
在项目根目录创建 `.env.local` 文件：
```bash
TIGER_API_KEY=your_tiger_id
TIGER_SECRET_KEY=your_private_key
TIGER_ACCOUNT=your_account_id
```

### 步骤3: 安装SDK（可选）
```bash
pnpm add tigeropen-client-js
```

### 步骤4: 更新API路由
修改 `/app/api/market/sentiment/route.ts`，替换Mock数据为真实API调用：

```typescript
import { TigerClient } from 'tigeropen-client-js'

export async function GET() {
  try {
    // 初始化老虎证券客户端
    const client = new TigerClient({
      tigerId: process.env.TIGER_API_KEY,
      privateKey: process.env.TIGER_SECRET_KEY,
      account: process.env.TIGER_ACCOUNT
    })
    
    // 获取恐慌贪婪指数
    const sentimentData = await client.getSentimentIndex()
    
    // 获取标普500数据
    const sp500Data = await client.getMarketIndex('SPX')
    
    const fearGreedIndex = sentimentData.value
    const sp500Index = 50 // 或从sp500Data计算
    
    const getSentimentLevel = (index: number) => {
      if (index <= 20) return 'extreme_fear'
      if (index <= 40) return 'fear'
      if (index <= 60) return 'neutral'
      if (index <= 80) return 'greed'
      return 'extreme_greed'
    }
    
    const sentiment = getSentimentLevel(fearGreedIndex)
    const recommendation = fearGreedIndex > sp500Index ? 'small_cap' : 'large_cap'
    
    return NextResponse.json({
      success: true,
      data: {
        fearGreedIndex,
        sp500Index,
        sentiment,
        recommendation,
        timestamp: new Date().toISOString(),
        source: 'tiger'
      }
    })
  } catch (error) {
    console.error('获取市场情绪数据失败:', error)
    return NextResponse.json(
      { success: false, error: '获取市场情绪数据失败' },
      { status: 500 }
    )
  }
}
```

### 步骤5: 测试
1. 重启开发服务器
2. 访问市场情绪页面
3. 检查是否显示真实数据
4. 查看控制台确认没有错误

## 扩展功能建议

### 1. 历史趋势图
添加恐慌贪婪指数的历史走势图，帮助识别趋势

### 2. 自定义阈值
允许用户自定义小盘股/大盘股切换的阈值

### 3. 提醒功能
当市场情绪发生重大变化时发送通知

### 4. 策略回测
基于历史数据回测该策略的表现

### 5. 多市场支持
支持A股、港股等其他市场的情绪指标

## 注意事项

1. **API限流**: 老虎证券API可能有调用频率限制，注意控制请求频率
2. **数据延迟**: 市场数据可能有延迟，不要用于高频交易
3. **策略风险**: 该策略仅供参考，实际交易需结合其他因素综合判断
4. **成本考虑**: 频繁切换大小盘可能产生较高的交易成本

## 相关文件

- `/components/market/MarketSentimentMonitor.tsx` - 前端组件
- `/app/api/market/sentiment/route.ts` - API路由
- `/app/page.tsx` - 主页面（已集成）

## 更新日志

- 2025-10-22: 初始版本，实现基础功能和Mock数据
- 待完成: 集成老虎证券真实API

## 支持

如有问题或建议，请联系开发团队。

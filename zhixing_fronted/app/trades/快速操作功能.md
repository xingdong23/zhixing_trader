# 交易卡片快速操作功能

## 更新说明

根据您的需求，现在每个交易卡片（无论是持仓中、等待执行还是历史记录）都支持快速添加笔记、上传截图和设置提醒。

## 新增功能

### 1. 交易卡片底部快速操作按钮

每个交易卡片现在都有三个快速操作按钮：

#### 📝 添加笔记按钮
- **位置**：所有状态的交易卡片底部
- **功能**：快速添加交易相关笔记
- **适用场景**：
  - 计划阶段：记录入场思路、市场分析
  - 持仓中：记录持仓观察、市场变化
  - 已平仓：记录复盘总结、经验教训

#### 📸 上传截图按钮
- **位置**：所有状态的交易卡片底部
- **功能**：上传K线图、技术指标等截图
- **支持格式**：JPG、PNG、GIF
- **最大大小**：10MB
- **快速标签**：K线图、入场点、平仓点、技术指标、其他

#### 🔔 设置提醒按钮
- **位置**：持仓中的交易卡片底部
- **功能**：设置价格、盈亏、时间提醒
- **提醒类型**：
  - 价格提醒：突破某个价位时提醒
  - 盈亏提醒：达到目标盈亏比例时提醒
  - 时间提醒：定时提醒查看交易

## 界面展示

### 交易卡片结构（更新后）

```
┌─────────────────────────────────────────────────────┐
│ AAPL - Apple Inc.            [查看详情] [编辑]      │
│ 入场: $180.80 → 当前: $185.20 (+2.43%)             │
│ 数量: 100股 | 浮动盈亏: +$440.00                   │
│ 策略: 技术面突破+基本面支撑，iPhone销量超预期       │
├─────────────────────────────────────────────────────┤
│ ⏱️ 3天  📝 3  📸 2  🔔 2                            │
│ 🎯 止损: $177.00  🎯 止盈: $190.00                 │
├─────────────────────────────────────────────────────┤
│ [📝 添加笔记] [📸 上传截图] [🔔 设置提醒]           │  ← 新增
└─────────────────────────────────────────────────────┘
```

## 使用流程

### 添加笔记流程

1. 点击交易卡片的"📝 添加笔记"按钮
2. 弹出笔记对话框
3. 填写笔记标题（例如：入场观察、持仓分析）
4. 填写笔记内容（支持记录任何与交易相关的内容）
5. 点击"保存笔记"

**笔记内容建议：**
- K线形态分析
- 技术指标信号
- 市场情绪判断
- 新闻事件影响
- 交易心理状态
- 执行纪律记录

### 上传截图流程

1. 点击交易卡片的"📸 上传截图"按钮
2. 弹出截图上传对话框
3. 点击上传区域或拖拽图片
4. 选择截图类型标签（K线图、入场点等）
5. 填写截图说明
6. 点击"上传"

**截图类型：**
- **K线图**：日线、周线、月线图
- **入场点**：入场时的价格和形态
- **平仓点**：平仓时的价格和形态
- **技术指标**：MACD、RSI、布林带等
- **其他**：新闻截图、数据截图等

### 设置提醒流程

1. 点击持仓中交易卡片的"🔔 设置提醒"按钮
2. 弹出提醒设置对话框
3. 选择提醒类型（价格/盈亏/时间）
4. 填写触发条件（如目标价格）
5. 填写提醒内容
6. 勾选通知方式（浏览器通知）
7. 点击"设置提醒"

**提醒应用场景：**
- 价格突破关键位置
- 达到止损或止盈价格
- 盈亏达到预期目标
- 定期检查持仓状态

## 对话框设计

### 📝 添加笔记对话框

```
┌─────────────────────────────────────────┐
│ 添加笔记 - AAPL Apple Inc.              │
├─────────────────────────────────────────┤
│ 笔记标题                                 │
│ [例如：入场观察、持仓分析、平仓总结...] │
│                                          │
│ 笔记内容                                 │
│ ┌────────────────────────────────────┐  │
│ │ 记录你对这次交易的想法、观察、      │  │
│ │ 分析...                             │  │
│ │                                     │  │
│ │                                     │  │
│ └────────────────────────────────────┘  │
│                                          │
│ 💡 提示：你可以记录K线形态、技术指标、  │
│    市场情绪、新闻事件等任何与交易相关   │
│    的内容                                │
├─────────────────────────────────────────┤
│                    [取消]  [保存笔记]    │
└─────────────────────────────────────────┘
```

### 📸 上传截图对话框

```
┌─────────────────────────────────────────┐
│ 上传截图 - AAPL Apple Inc.              │
├─────────────────────────────────────────┤
│ ┌────────────────────────────────────┐  │
│ │        📤                           │  │
│ │  点击上传或拖拽图片到这里           │  │
│ │  支持 JPG、PNG、GIF 格式，最大 10MB │  │
│ │  [选择文件...]                      │  │
│ └────────────────────────────────────┘  │
│                                          │
│ 截图说明                                 │
│ [描述这张截图的内容和重要性...]         │
│                                          │
│ 快速标签：                               │
│ [K线图] [入场点] [平仓点] [技术指标]    │
│ [其他]                                   │
├─────────────────────────────────────────┤
│                       [取消]  [上传]     │
└─────────────────────────────────────────┘
```

### 🔔 设置提醒对话框

```
┌─────────────────────────────────────────┐
│ 设置提醒 - AAPL Apple Inc.              │
├─────────────────────────────────────────┤
│ 提醒类型                                 │
│ [价格提醒 ▼]                            │
│                                          │
│ 触发价格                                 │
│ [例如：190.00]                          │
│                                          │
│ 提醒内容                                 │
│ [价格突破目标位，考虑止盈...]           │
│                                          │
│ ☑ 浏览器通知                            │
├─────────────────────────────────────────┤
│                    [取消]  [设置提醒]    │
└─────────────────────────────────────────┘
```

## 按钮显示规则

### 📝 添加笔记
- **显示条件**：所有状态的交易
- **理由**：任何阶段都可能有值得记录的想法

### 📸 上传截图
- **显示条件**：所有状态的交易
- **理由**：任何阶段都可能需要保存图表截图

### 🔔 设置提醒
- **显示条件**：仅持仓中的交易
- **理由**：只有持仓中的交易需要实时监控和提醒

## 数据关联

### 笔记关联
- 每个笔记都关联到具体的交易
- 笔记可以标记阶段（计划/入场/持仓/平仓/复盘）
- 在交易详情页可以查看所有关联笔记

### 截图关联
- 每张截图都关联到具体的交易
- 截图可以标记类型（K线图/入场点/平仓点等）
- 截图可以添加文字说明
- 在交易详情页可以浏览所有截图

### 提醒关联
- 每个提醒都关联到具体的交易
- 提醒包含触发条件和通知内容
- 活跃的提醒会在交易卡片上显示数量
- 触发后的提醒会在详情页显示历史

## 技术实现

### 状态管理
```typescript
// 对话框状态
const [noteDialogOpen, setNoteDialogOpen] = useState(false);
const [screenshotDialogOpen, setScreenshotDialogOpen] = useState(false);
const [alertDialogOpen, setAlertDialogOpen] = useState(false);
const [currentTrade, setCurrentTrade] = useState<Trade | null>(null);
```

### 回调函数
```typescript
// TradeCard 接收回调
interface TradeCardProps {
  trade: Trade;
  onViewDetails: (trade: Trade) => void;
  onEdit?: (trade: Trade) => void;
  onAddNote?: (trade: Trade) => void;      // 新增
  onAddScreenshot?: (trade: Trade) => void; // 新增
  onAddAlert?: (trade: Trade) => void;      // 新增
}
```

### 按钮点击处理
```typescript
// 防止事件冒泡
onClick={(e) => {
  e.stopPropagation();
  onAddNote(trade);
}}
```

## 演示模式

当前为演示模式，所有操作会弹出提示但不会真正保存：
- 保存笔记 → alert("笔记已保存（演示模式）")
- 上传截图 → alert("截图已上传（演示模式）")
- 设置提醒 → alert("提醒已设置（演示模式）")

## 待实现（需要后端）

- [ ] 笔记实际保存到数据库
- [ ] 截图文件上传和存储
- [ ] 提醒触发和通知
- [ ] 笔记/截图/提醒的编辑和删除
- [ ] 在交易详情页显示完整列表
- [ ] 笔记支持Markdown格式
- [ ] 截图支持图片预览
- [ ] 提醒支持邮件/短信通知

## 用户价值

### 💡 记录完整
无论交易处于哪个阶段，都可以随时记录想法和截图，形成完整的交易档案。

### ⚡ 操作便捷
不需要进入详情页，直接在列表页就能快速添加笔记和截图。

### 🎯 提醒及时
持仓中的交易可以设置多种提醒，避免错过关键时机。

### 📊 复盘参考
积累的笔记和截图为后续复盘提供详实的参考资料。

---

**更新时间**: 2024-10-18  
**版本**: v1.1  
**状态**: ✅ 已实现前端交互


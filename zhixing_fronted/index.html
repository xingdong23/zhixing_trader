<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuantMind - 智能量化交易系统</title>
    <style>
        :root {
            --color-bg: #1a1a1a;
            --color-surface: #2c2c34;
            --color-surface-hover: #3a3a42;
            --color-border: #404040;
            --color-text: #e0e0e0;
            --color-text-muted: #a0a0a0;
            --color-primary: #3b82f6;
            --color-primary-hover: #2563eb;
            --color-success: #10b981;
            --color-danger: #ef4444;
            --color-warning: #f59e0b;
            --color-yellow: #eab308;
            --color-purple: #8b5cf6;
            --color-pink: #ec4899;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Navigation */
        .nav {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--color-border);
            padding-bottom: 15px;
        }

        .nav-item {
            padding: 10px 20px;
            background: var(--color-surface);
            border: none;
            border-radius: 8px;
            color: var(--color-text);
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-item:hover {
            background: var(--color-surface-hover);
        }

        .nav-item.active {
            background: var(--color-primary);
        }

        /* Pages */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Cards */
        .card {
            background: var(--color-surface);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--color-border);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
        }

        /* Enhanced alert dashboard for daily triggered alerts */
        .alert-dashboard {
            background: linear-gradient(135deg, var(--color-danger), var(--color-warning));
            border: none;
            margin-bottom: 30px;
        }

        .alert-dashboard h3 {
            color: white;
            margin-bottom: 15px;
        }

        .triggered-alerts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .alert-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .alert-item .stock-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .alert-item .alert-condition {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Buttons */
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            background: var(--color-primary);
            color: white;
            cursor: pointer;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .btn:hover {
            background: var(--color-primary-hover);
        }

        .btn-secondary {
            background: var(--color-surface-hover);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background: var(--color-border);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-danger {
            background: var(--color-danger);
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid var(--color-border);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--color-surface);
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }

        th {
            background: var(--color-surface-hover);
            font-weight: 600;
            font-size: 14px;
        }

        tr:hover {
            background: var(--color-surface-hover);
        }

        .stock-name {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .ticker {
            font-size: 12px;
            color: var(--color-text-muted);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .price-up {
            color: var(--color-success);
        }

        .price-down {
            color: var(--color-danger);
        }

        /* Tags */
        .tag {
            display: inline-block;
            padding: 4px 8px;
            background: var(--color-surface-hover);
            border-radius: 4px;
            font-size: 12px;
            margin-right: 4px;
            margin-bottom: 4px;
        }

        /* Enhanced complex alert expression builder */
        .alert-expression-builder {
            background: var(--color-surface-hover);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }

        .expression-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .expression-select {
            padding: 8px 12px;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            color: var(--color-text);
            min-width: 120px;
        }

        .expression-input {
            padding: 8px 12px;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            color: var(--color-text);
            width: 100px;
        }

        .add-condition-btn {
            background: var(--color-success);
            padding: 6px 10px;
            font-size: 12px;
        }

        /* Filters */
        .multi-dim-filters {
            margin-bottom: 20px;
            padding: 15px;
            background: var(--color-surface-hover);
            border-radius: 8px;
        }

        .filter-group {
            margin-bottom: 15px;
        }

        .filter-group:last-child {
            margin-bottom: 0;
        }

        .filter-group-title {
            font-weight: 600;
            margin-bottom: 8px;
            display: block;
        }

        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .filter-tag {
            padding: 6px 12px;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
        }

        .filter-tag:hover {
            background: var(--color-surface-hover);
        }

        .filter-tag.active {
            background: var(--color-primary);
            border-color: var(--color-primary);
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--color-surface);
            border-radius: 12px;
            padding: 0;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--color-border);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 24px;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--color-text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: var(--color-surface-hover);
            color: var(--color-text);
        }

        /* Enhanced stock detail modal with intelligence display */
        .stock-detail-modal {
            max-width: 1200px;
            width: 95vw;
        }

        .stock-detail-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        .stock-chart-panel {
            min-height: 400px;
        }

        .stock-chart-container {
            width: 100%;
            height: 400px;
            background: var(--color-surface-hover);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-text-muted);
        }

        .stock-info-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: var(--color-surface-hover);
            border-radius: 6px;
        }

        .info-item .label {
            font-size: 13px;
            color: var(--color-text-muted);
        }

        .info-item .value {
            font-weight: 600;
        }

        /* Enhanced intelligence notes section */
        .intelligence-section {
            background: var(--color-surface-hover);
            border-radius: 8px;
            padding: 15px;
        }

        .intelligence-section h4 {
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .intel-note {
            background: var(--color-surface);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 3px solid var(--color-primary);
        }

        .intel-note.has-alert {
            border-left-color: var(--color-warning);
        }

        .intel-note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .intel-note-meta {
            font-size: 12px;
            color: var(--color-text-muted);
        }

        .intel-note-text {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .intel-note-image {
            width: 100%;
            max-width: 200px;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .intel-alert-info {
            background: rgba(245, 158, 11, 0.1);
            padding: 8px;
            border-radius: 4px;
            font-size: 13px;
            color: var(--color-warning);
        }

        .tag-section {
            background: var(--color-surface-hover);
            border-radius: 8px;
            padding: 15px;
        }

        .tag-section h4 {
            margin-bottom: 10px;
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 10px;
        }

        .add-tag-input {
            width: 100%;
            padding: 8px 12px;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            color: var(--color-text);
            font-size: 13px;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            background: var(--color-surface-hover);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            color: var(--color-text);
            font-size: 14px;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
        }

        /* Enhanced image upload preview */
        .image-upload-preview {
            margin-top: 10px;
            display: none;
        }

        .image-upload-preview img {
            max-width: 200px;
            border-radius: 6px;
            border: 1px solid var(--color-border);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .nav {
                flex-wrap: wrap;
                gap: 10px;
            }

            .stock-detail-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .triggered-alerts {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <nav class="nav">
            <button class="nav-item active" data-page="dashboard">仪表板</button>
            <button class="nav-item" data-page="stock-pool">股票池</button>
            <button class="nav-item" data-page="plans">交易计划</button>
            <button class="nav-item" data-page="intelligence">情报中心</button>
        </nav>

        <!-- ========== 仪表板页面 ========== -->
        <div id="dashboard" class="page active">
            <!-- Enhanced daily alert dashboard -->
            <div class="card alert-dashboard">
                <h3><i data-lucide="alert-triangle"></i> 今日触发提醒 (3)</h3>
                <div class="triggered-alerts">
                    <div class="alert-item">
                        <div class="stock-info">
                            <span><strong>贵州茅台 (600519)</strong></span>
                            <span style="color: #10b981;">+2.3%</span>
                        </div>
                        <div class="alert-condition">价格突破 EMA55 (1847.50) 且成交量 > 昨日1.5倍</div>
                    </div>
                    <div class="alert-item">
                        <div class="stock-info">
                            <span><strong>宁德时代 (300750)</strong></span>
                            <span style="color: #ef4444;">-1.8%</span>
                        </div>
                        <div class="alert-condition">跌破支撑位 185.00 (大佬A分析)</div>
                    </div>
                    <div class="alert-item">
                        <div class="stock-info">
                            <span><strong>比亚迪 (002594)</strong></span>
                            <span style="color: #10b981;">+3.1%</span>
                        </div>
                        <div class="alert-condition">RSI(14) > 70 且 MACD金叉</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>市场概览</h3>
                </div>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="label">上证指数</span>
                        <div class="value price-up">3,247.89 (+1.2%)</div>
                    </div>
                    <div class="info-item">
                        <span class="label">深证成指</span>
                        <div class="value price-down">10,456.23 (-0.8%)</div>
                    </div>
                    <div class="info-item">
                        <span class="label">创业板指</span>
                        <div class="value price-up">2,189.45 (+0.5%)</div>
                    </div>
                    <div class="info-item">
                        <span class="label">活跃股票</span>
                        <div class="value">156</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== 股票池页面 ========== -->
        <div id="stock-pool" class="page">
            <div class="card">
                <div class="card-header">
                    <h3>股票池</h3>
                    <button class="btn" id="import-stocks-btn">
                        <i data-lucide="upload"></i> 导入股票列表
                    </button>
                </div>
                <div id="multi-dim-filters-container" class="multi-dim-filters">
                    <!-- JS动态生成多维筛选器 -->
                </div>
                <div class="table-container">
                    <table id="stock-pool-table">
                        <thead>
                        <tr>
                            <th>代码/名称</th>
                            <th>现价</th>
                            <th>涨跌幅</th>
                            <th>成交额</th>
                            <th>匹配模式</th>
                            <th>情报/提醒</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- JS动态生成 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ========== 交易计划页面 ========== -->
        <div id="plans" class="page">
            <div class="card">
                <div class="card-header">
                    <h3>交易计划管理</h3>
                    <button class="btn" id="create-plan-btn-page">
                        <i data-lucide="plus"></i> 新建计划
                    </button>
                </div>
                <div class="table-container">
                    <table id="plans-table">
                        <thead>
                        <tr>
                            <th>股票</th>
                            <th>计划类型</th>
                            <th>目标价格</th>
                            <th>止损价格</th>
                            <th>状态</th>
                            <th>创建时间</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- JS动态生成 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ========== 情报中心页面 ========== -->
        <div id="intelligence" class="page">
            <div class="card">
                <div class="card-header">
                    <h3>情报中心</h3>
                    <button class="btn" id="add-intel-btn">
                        <i data-lucide="plus"></i> 添加情报
                    </button>
                </div>
                <div id="intel-sources-container">
                    <!-- JS动态生成情报源 -->
                </div>
            </div>
        </div>
    </div>

    <!-- ========== 模态框 ========== -->

    <!-- Enhanced stock detail modal with intelligence display -->
    <div id="stock-detail-modal" class="modal-overlay">
        <div class="modal-content stock-detail-modal">
            <div class="modal-header">
                <h2 id="stock-detail-title">股票详情</h2>
                <button class="close-btn" data-modal-close="stock-detail-modal"><i data-lucide="x"></i></button>
            </div>
            <div class="modal-body">
                <div class="stock-detail-layout">
                    <div class="stock-chart-panel">
                        <div id="stock-chart" class="stock-chart-container">
                            <div>K线图表区域 (集成TradingView或自定义图表)</div>
                        </div>
                    </div>
                    <div class="stock-info-panel">
                        <h4>关键数据</h4>
                        <div class="info-grid">
                            <div class="info-item"><span class="label">今开</span><div id="detail-open" class="value">185.20</div></div>
                            <div class="info-item"><span class="label">昨收</span><div id="detail-close" class="value">183.45</div></div>
                            <div class="info-item"><span class="label">最高</span><div id="detail-high" class="value price-up">187.80</div></div>
                            <div class="info-item"><span class="label">最低</span><div id="detail-low" class="value price-down">184.10</div></div>
                        </div>

                        <!-- Enhanced intelligence notes display -->
                        <div class="intelligence-section">
                            <h4>
                                情报与分析
                                <button class="btn btn-sm add-intel-note-btn" data-ticker="">
                                    <i data-lucide="plus"></i> 添加
                                </button>
                            </h4>
                            <div id="intel-notes-container">
                                <div class="intel-note has-alert">
                                    <div class="intel-note-header">
                                        <span class="intel-note-meta">大佬A • 2小时前</span>
                                        <i data-lucide="bell" style="width: 14px; color: var(--color-warning);"></i>
                                    </div>
                                    <div class="intel-note-text">此处是强支撑位，跌破185可以考虑加仓</div>
                                    <img src="/placeholder.svg?height=100&width=200" alt="分析截图" class="intel-note-image">
                                    <div class="intel-alert-info">
                                        <i data-lucide="alert-circle" style="width: 14px;"></i>
                                        价格提醒: 跌破 ¥185.00 时通知
                                    </div>
                                </div>
                                <div class="intel-note">
                                    <div class="intel-note-header">
                                        <span class="intel-note-meta">大佬B • 1天前</span>
                                    </div>
                                    <div class="intel-note-text">技术面看涨，MACD即将金叉，建议关注</div>
                                </div>
                            </div>
                        </div>

                        <div class="tag-section" data-concept-type="industry">
                            <h4>行业分类</h4>
                            <div class="tags">
                                <span class="tag">新能源汽车</span>
                                <span class="tag">锂电池</span>
                            </div>
                            <input type="text" class="add-tag-input" placeholder="添加行业分类...">
                        </div>

                        <div class="tag-section" data-concept-type="fundamentals">
                            <h4>基本面标签</h4>
                            <div class="tags">
                                <span class="tag">高成长</span>
                                <span class="tag">龙头股</span>
                            </div>
                            <input type="text" class="add-tag-input" placeholder="添加基本面标签...">
                        </div>

                        <div class="tag-section" data-concept-type="custom">
                            <h4>自定义标签</h4>
                            <div class="tags">
                                <span class="tag">重点关注</span>
                            </div>
                            <input type="text" class="add-tag-input" placeholder="添加自定义标签...">
                        </div>

                        <div class="form-actions" style="justify-content: center; margin-top: 30px;">
                            <button class="btn" id="create-plan-from-detail">
                                <i data-lucide="plus-circle"></i> 创建交易计划
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced intelligence note modal with complex alert expressions -->
    <div id="add-intel-note-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 id="intel-note-title">添加情报与提醒</h2>
                <button class="close-btn" data-modal-close="add-intel-note-modal"><i data-lucide="x"></i></button>
            </div>
            <form id="intel-note-form">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="intel-note-text">记录关键信息</label>
                        <textarea id="intel-note-text" rows="4" placeholder="例如：大佬A认为此处是强支撑位，技术分析显示..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="intel-note-image">上传分析截图 (可选)</label>
                        <input type="file" id="intel-note-image" accept="image/*">
                        <div class="image-upload-preview" id="image-preview">
                            <img id="preview-img" alt="预览">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>设置智能提醒条件</label>
                        <div class="alert-expression-builder">
                            <div class="expression-row">
                                <select class="expression-select" id="condition-type">
                                    <option value="price">价格</option>
                                    <option value="technical">技术指标</option>
                                    <option value="volume">成交量</option>
                                    <option value="custom">自定义表达式</option>
                                </select>
                                <select class="expression-select" id="operator">
                                    <option value=">">&gt;</option>
                                    <option value="<">&lt;</option>
                                    <option value=">=">&gt;=</option>
                                    <option value="<=">&lt;=</option>
                                    <option value="=">=</option>
                                    <option value="cross_above">突破</option>
                                    <option value="cross_below">跌破</option>
                                </select>
                                <input type="text" class="expression-input" id="condition-value" placeholder="数值">
                                <button type="button" class="btn btn-sm add-condition-btn">
                                    <i data-lucide="plus"></i>
                                </button>
                            </div>
                            
                            <div id="technical-options" style="display: none;">
                                <div class="expression-row">
                                    <span>技术指标:</span>
                                    <select class="expression-select" id="technical-indicator">
                                        <option value="ema5">EMA5</option>
                                        <option value="ema10">EMA10</option>
                                        <option value="ema20">EMA20</option>
                                        <option value="ema55">EMA55</option>
                                        <option value="sma20">SMA20</option>
                                        <option value="rsi">RSI(14)</option>
                                        <option value="macd">MACD</option>
                                        <option value="kdj">KDJ</option>
                                        <option value="boll_upper">布林上轨</option>
                                        <option value="boll_lower">布林下轨</option>
                                    </select>
                                </div>
                            </div>

                            <div id="volume-options" style="display: none;">
                                <div class="expression-row">
                                    <span>成交量条件:</span>
                                    <select class="expression-select" id="volume-condition">
                                        <option value="volume_ratio">成交量比率</option>
                                        <option value="volume_ma">成交量均线</option>
                                        <option value="volume_absolute">绝对成交量</option>
                                    </select>
                                    <span>倍数:</span>
                                    <input type="number" class="expression-input" id="volume-multiplier" placeholder="1.5" step="0.1">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>表达式预览:</label>
                                <div id="expression-preview" style="background: var(--color-surface-hover); padding: 10px; border-radius: 6px; font-family: monospace; font-size: 13px;">
                                    价格 > 185.00
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" data-modal-close="add-intel-note-modal">取消</button>
                    <button type="submit" class="btn">保存情报</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 其他模态框保持不变 -->
    <div id="create-plan-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>创建交易计划</h2>
                <button class="close-btn" data-modal-close="create-plan-modal"><i data-lucide="x"></i></button>
            </div>
            <form id="create-plan-form">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="plan-stock">选择股票</label>
                        <select id="plan-stock" required>
                            <option value="">请选择股票</option>
                            <option value="600519">贵州茅台 (600519)</option>
                            <option value="000858">五粮液 (000858)</option>
                            <option value="300750">宁德时代 (300750)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="plan-type">计划类型</label>
                        <select id="plan-type" required>
                            <option value="buy">买入计划</option>
                            <option value="sell">卖出计划</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="plan-target-price">目标价格</label>
                        <input type="number" id="plan-target-price" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="plan-stop-loss">止损价格</label>
                        <input type="number" id="plan-stop-loss" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="plan-notes">备注</label>
                        <textarea id="plan-notes" rows="3"></textarea>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" data-modal-close="create-plan-modal">取消</button>
                    <button type="submit" class="btn">创建计划</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        class TradingSystem {
            constructor() {
                this.currentPage = 'dashboard';
                this.currentTicker = null;
                this.stockPoolData = [
                    {
                        ticker: '600519',
                        name: '贵州茅台',
                        price: 1847.50,
                        change: 2.3,
                        volume: '45.2亿',
                        rules: ['EMA突破', '成交量放大'],
                        concepts: {
                            industry: ['白酒', '消费'],
                            fundamentals: ['蓝筹股', '高分红'],
                            custom: ['核心持仓']
                        },
                        intelNotes: [
                            {
                                text: '技术面强势，突破前高阻力位',
                                image: '/placeholder.svg?height=100&width=200',
                                alertPrice: 1850,
                                triggered: false,
                                author: '大佬A',
                                time: '2小时前',
                                expression: '价格 > 1850 且 成交量 > 昨日1.5倍'
                            }
                        ]
                    },
                    {
                        ticker: '300750',
                        name: '宁德时代',
                        price: 184.20,
                        change: -1.8,
                        volume: '128.5亿',
                        rules: ['支撑位测试'],
                        concepts: {
                            industry: ['新能源', '锂电池'],
                            fundamentals: ['高成长', '龙头股'],
                            custom: ['重点关注']
                        },
                        intelNotes: [
                            {
                                text: '此处是强支撑位，跌破185可以考虑加仓',
                                image: '/placeholder.svg?height=100&width=200',
                                alertPrice: 185,
                                triggered: true,
                                author: '大佬A',
                                time: '2小时前',
                                expression: '价格 < 185.00'
                            },
                            {
                                text: '技术面看涨，MACD即将金叉，建议关注',
                                image: null,
                                alertPrice: null,
                                triggered: false,
                                author: '大佬B',
                                time: '1天前',
                                expression: null
                            }
                        ]
                    },
                    {
                        ticker: '002594',
                        name: '比亚迪',
                        price: 267.80,
                        change: 3.1,
                        volume: '89.3亿',
                        rules: ['RSI超买', 'MACD金叉'],
                        concepts: {
                            industry: ['新能源汽车', '汽车制造'],
                            fundamentals: ['高成长', '创新'],
                            custom: ['新能源龙头']
                        },
                        intelNotes: [
                            {
                                text: 'RSI已达超买区域，注意回调风险',
                                image: null,
                                alertPrice: null,
                                triggered: false,
                                author: '技术分析师',
                                time: '30分钟前',
                                expression: 'RSI(14) > 70 且 MACD金叉'
                            }
                        ]
                    }
                ];
                this.plansData = [];
                this.init();
            }

            init() {
                this.bindEvents();
                this.renderStockPool();
                this.renderTagFilters();
                this.renderPlans();
                lucide.createIcons();
            }

            bindEvents() {
                // Navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        const page = e.target.dataset.page;
                        this.switchPage(page);
                    });
                });

                // Modal controls
                document.querySelectorAll('[data-modal-close]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const modalId = e.target.closest('[data-modal-close]').dataset.modalClose;
                        this.closeModal(modalId);
                    });
                });

                // Stock pool events
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.view-detail-btn')) {
                        const ticker = e.target.closest('.view-detail-btn').dataset.ticker;
                        this.showStockDetail(ticker);
                    }
                    if (e.target.closest('.add-intel-note-btn')) {
                        const ticker = e.target.closest('.add-intel-note-btn').dataset.ticker;
                        this.showAddIntelNote(ticker);
                    }
                });

                document.getElementById('condition-type')?.addEventListener('change', (e) => {
                    this.updateExpressionBuilder(e.target.value);
                });

                document.getElementById('intel-note-image')?.addEventListener('change', (e) => {
                    this.handleImagePreview(e);
                });

                // Form submissions
                document.getElementById('intel-note-form')?.addEventListener('submit', (e) => {
                    this.handleIntelNoteSubmit(e);
                });

                document.getElementById('create-plan-form')?.addEventListener('submit', (e) => {
                    this.handleCreatePlan(e);
                });

                // Filter events
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('filter-tag')) {
                        e.target.classList.toggle('active');
                        this.applyFilters();
                    }
                });
            }

            switchPage(page) {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                
                document.getElementById(page).classList.add('active');
                document.querySelector(`[data-page="${page}"]`).classList.add('active');
                
                this.currentPage = page;
            }

            openModal(modalId) {
                document.getElementById(modalId).classList.add('active');
            }

            closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
            }

            showStockDetail(ticker) {
                const stock = this.stockPoolData.find(s => s.ticker === ticker);
                if (!stock) return;

                this.currentTicker = ticker;
                document.getElementById('stock-detail-title').textContent = `${stock.name} (${stock.ticker})`;
                
                this.renderIntelNotes(stock.intelNotes);
                
                this.openModal('stock-detail-modal');
            }

            renderIntelNotes(notes) {
                const container = document.getElementById('intel-notes-container');
                if (!container) return;

                container.innerHTML = notes.map(note => `
                    <div class="intel-note ${note.alertPrice ? 'has-alert' : ''}">
                        <div class="intel-note-header">
                            <span class="intel-note-meta">${note.author} • ${note.time}</span>
                            ${note.alertPrice ? '<i data-lucide="bell" style="width: 14px; color: var(--color-warning);"></i>' : ''}
                        </div>
                        <div class="intel-note-text">${note.text}</div>
                        ${note.image ? `<img src="${note.image}" alt="分析截图" class="intel-note-image">` : ''}
                        ${note.expression ? `
                            <div class="intel-alert-info">
                                <i data-lucide="alert-circle" style="width: 14px;"></i>
                                提醒条件: ${note.expression}
                            </div>
                        ` : ''}
                    </div>
                `).join('');
                
                lucide.createIcons();
            }

            showAddIntelNote(ticker) {
                this.currentTicker = ticker;
                const stock = this.stockPoolData.find(s => s.ticker === ticker);
                if (stock) {
                    document.getElementById('intel-note-title').textContent = `为 ${stock.name} 添加情报`;
                }
                this.openModal('add-intel-note-modal');
            }

            updateExpressionBuilder(type) {
                const technicalOptions = document.getElementById('technical-options');
                const volumeOptions = document.getElementById('volume-options');
                
                // Hide all options first
                technicalOptions.style.display = 'none';
                volumeOptions.style.display = 'none';
                
                // Show relevant options
                if (type === 'technical') {
                    technicalOptions.style.display = 'block';
                } else if (type === 'volume') {
                    volumeOptions.style.display = 'block';
                }
                
                this.updateExpressionPreview();
            }

            updateExpressionPreview() {
                const conditionType = document.getElementById('condition-type')?.value;
                const operator = document.getElementById('operator')?.value;
                const value = document.getElementById('condition-value')?.value;
                const preview = document.getElementById('expression-preview');
                
                if (!preview) return;
                
                let expression = '';
                
                switch (conditionType) {
                    case 'price':
                        expression = `价格 ${operator} ${value || '___'}`;
                        break;
                    case 'technical':
                        const indicator = document.getElementById('technical-indicator')?.value || 'EMA55';
                        expression = `${indicator.toUpperCase()} ${operator} ${value || '___'}`;
                        break;
                    case 'volume':
                        const condition = document.getElementById('volume-condition')?.value || 'volume_ratio';
                        const multiplier = document.getElementById('volume-multiplier')?.value || '1.5';
                        expression = `成交量 ${operator} 昨日${multiplier}倍`;
                        break;
                    case 'custom':
                        expression = value || '自定义表达式...';
                        break;
                }
                
                preview.textContent = expression;
            }

            handleImagePreview(e) {
                const file = e.target.files[0];
                const preview = document.getElementById('image-preview');
                const img = document.getElementById('preview-img');
                
                if (file && preview && img) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        img.src = e.target.result;
                        preview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            }

            handleIntelNoteSubmit(e) {
                e.preventDefault();
                const stock = this.stockPoolData.find(s => s.ticker === this.currentTicker);
                if (!stock) return;

                const text = document.getElementById('intel-note-text').value;
                const conditionType = document.getElementById('condition-type')?.value;
                const operator = document.getElementById('operator')?.value;
                const value = document.getElementById('condition-value')?.value;
                
                // Build expression
                let expression = null;
                let alertPrice = null;
                
                if (value) {
                    switch (conditionType) {
                        case 'price':
                            expression = `价格 ${operator} ${value}`;
                            alertPrice = parseFloat(value);
                            break;
                        case 'technical':
                            const indicator = document.getElementById('technical-indicator')?.value || 'EMA55';
                            expression = `${indicator.toUpperCase()} ${operator} ${value}`;
                            break;
                        case 'volume':
                            const multiplier = document.getElementById('volume-multiplier')?.value || '1.5';
                            expression = `成交量 ${operator} 昨日${multiplier}倍`;
                            break;
                        case 'custom':
                            expression = value;
                            break;
                    }
                }

                if (text || expression) {
                    stock.intelNotes.push({
                        text: text,
                        image: '/placeholder.svg?height=100&width=200',
                        alertPrice: alertPrice,
                        triggered: false,
                        author: '我',
                        time: '刚刚',
                        expression: expression
                    });
                    
                    alert('情报已保存！');
                    this.closeModal('add-intel-note-modal');
                    this.renderStockPool();
                    
                    // Reset form
                    document.getElementById('intel-note-form').reset();
                    document.getElementById('image-preview').style.display = 'none';
                }
            }

            renderStockPool(data = this.stockPoolData) {
                const tableBody = document.querySelector('#stock-pool-table tbody');
                if (!tableBody) return;
                
                tableBody.innerHTML = '';
                data.forEach(stock => {
                    const changeClass = stock.change >= 0 ? 'price-up' : 'price-down';
                    const changeSign = stock.change >= 0 ? '+' : '';
                    const hasAlert = stock.intelNotes.some(n => n.alertPrice && !n.triggered);
                    const intelCount = stock.intelNotes.length;
                    
                    const row = `
                        <tr data-ticker="${stock.ticker}">
                            <td>
                                <div class="stock-name">
                                    <span>${stock.name}</span>
                                    <span class="ticker">${stock.ticker}</span>
                                </div>
                            </td>
                            <td class="${changeClass}">${stock.price.toFixed(2)}</td>
                            <td class="${changeClass}">${changeSign}${stock.change.toFixed(2)}%</td>
                            <td>${stock.volume}</td>
                            <td>${stock.rules.map(r => `<span class="tag">${r}</span>`).join('')}</td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    ${hasAlert ? '<i data-lucide="bell" style="width: 14px; color: var(--color-warning);" title="有活跃提醒"></i>' : ''}
                                    <span class="tag" style="background: var(--color-primary);">${intelCount} 条情报</span>
                                </div>
                            </td>
                            <td>
                                <button class="btn btn-secondary btn-sm add-intel-note-btn" data-ticker="${stock.ticker}" title="添加情报/提醒">
                                    <i data-lucide="edit-3" style="width:14px; height:14px;"></i>
                                </button>
                                <button class="btn btn-secondary btn-sm view-detail-btn" data-ticker="${stock.ticker}">详情</button>
                            </td>
                        </tr>
                    `;
                    tableBody.insertAdjacentHTML('beforeend', row);
                });
                lucide.createIcons();
            }

            renderTagFilters() {
                const concepts = { industry: new Set(), fundamentals: new Set(), custom: new Set() };
                this.stockPoolData.forEach(stock => {
                    stock.concepts.industry.forEach(tag => concepts.industry.add(tag));
                    stock.concepts.fundamentals.forEach(tag => concepts.fundamentals.add(tag));
                    stock.concepts.custom.forEach(tag => concepts.custom.add(tag));
                });

                const container = document.getElementById('multi-dim-filters-container');
                if (!container) return;
                
                container.innerHTML = `
                    <div class="filter-group">
                        <span class="filter-group-title">行业分类:</span>
                        <div class="filter-tags" data-filter-type="industry">
                            ${[...concepts.industry].map(tag => `<span class="filter-tag" data-tag="${tag}">${tag}</span>`).join('')}
                        </div>
                    </div>
                    <div class="filter-group">
                        <span class="filter-group-title">基本面:</span>
                        <div class="filter-tags" data-filter-type="fundamentals">
                             ${[...concepts.fundamentals].map(tag => `<span class="filter-tag" data-tag="${tag}">${tag}</span>`).join('')}
                        </div>
                    </div>
                    <div class="filter-group">
                        <span class="filter-group-title">自定义:</span>
                        <div class="filter-tags" data-filter-type="custom">
                             ${[...concepts.custom].map(tag => `<span class="filter-tag" data-tag="${tag}">${tag}</span>`).join('')}
                        </div>
                    </div>
                `;
            }

            applyFilters() {
                const activeFilters = {
                    industry: [],
                    fundamentals: [],
                    custom: []
                };

                document.querySelectorAll('.filter-tag.active').forEach(tag => {
                    const filterType = tag.closest('.filter-tags').dataset.filterType;
                    activeFilters[filterType].push(tag.dataset.tag);
                });

                const filteredData = this.stockPoolData.filter(stock => {
                    return Object.keys(activeFilters).every(type => {
                        if (activeFilters[type].length === 0) return true;
                        return activeFilters[type].some(tag => stock.concepts[type].includes(tag));
                    });
                });

                this.renderStockPool(filteredData);
            }

            handleCreatePlan(e) {
                e.preventDefault();
                // Implementation for creating trading plans
                alert('交易计划创建功能待实现');
                this.closeModal('create-plan-modal');
            }

            renderPlans() {
                // Implementation for rendering trading plans
                const tableBody = document.querySelector('#plans-table tbody');
                if (tableBody) {
                    tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: var(--color-text-muted);">暂无交易计划</td></tr>';
                }
            }
        }

        // Initialize the trading system
        document.addEventListener('DOMContentLoaded', () => {
            new TradingSystem();
        });
    </script>
</body>
</html>

# æˆ‘çš„äº¤æ˜“æ¨¡å—è®¾è®¡æ–¹æ¡ˆ

## 1. åŠŸèƒ½æ¦‚è¿°

"æˆ‘çš„äº¤æ˜“"æ˜¯äº¤æ˜“æ—¥å¿—ç³»ç»Ÿçš„æ ¸å¿ƒæ¨¡å—ï¼Œç”¨äºç®¡ç†å®Œæ•´çš„äº¤æ˜“ç”Ÿå‘½å‘¨æœŸã€‚

### 1.1 æ ¸å¿ƒåŠŸèƒ½

1. **æ­£åœ¨äº¤æ˜“**ï¼šæ˜¾ç¤ºå½“å‰æŒä»“çš„äº¤æ˜“ï¼Œå®æ—¶è·Ÿè¸ªç›ˆäº
2. **å†å²äº¤æ˜“è®°å½•**ï¼šå·²å¹³ä»“çš„äº¤æ˜“å†å²ï¼Œæ”¯æŒåˆ†æå’Œå¤ç›˜
3. **ç­‰å¾…æ‰§è¡Œçš„äº¤æ˜“è®¡åˆ’**ï¼šå¾…è§¦å‘çš„äº¤æ˜“è®¡åˆ’ï¼Œæ”¯æŒæé†’å’Œç›‘æ§

### 1.2 äº¤æ˜“ç”Ÿå‘½å‘¨æœŸ

```
äº¤æ˜“è®¡åˆ’ â†’ ç­‰å¾…æ‰§è¡Œ â†’ å¼€ä»“ â†’ æŒä»“ä¸­ â†’ å¹³ä»“ â†’ å†å²è®°å½•
   â†“          â†“          â†“         â†“        â†“
  ç¬”è®°      æé†’      ç¬”è®°      ç¬”è®°     å¤ç›˜ç¬”è®°
  æˆªå›¾      æˆªå›¾      æˆªå›¾      æˆªå›¾      æ€»ç»“
  æ€è·¯      æ€è·¯      è°ƒæ•´      è°ƒæ•´      ç»éªŒ
```

## 2. æ•°æ®åº“è®¾è®¡

### 2.1 äº¤æ˜“è¡¨ (trades)

```sql
CREATE TABLE trades (
    id INT PRIMARY KEY AUTO_INCREMENT,
    
    -- åŸºæœ¬ä¿¡æ¯
    symbol VARCHAR(20) NOT NULL COMMENT 'è‚¡ç¥¨ä»£ç ',
    stock_name VARCHAR(100) COMMENT 'è‚¡ç¥¨åç§°',
    
    -- äº¤æ˜“çŠ¶æ€
    status ENUM('planned', 'pending', 'active', 'closed', 'cancelled') NOT NULL DEFAULT 'planned' COMMENT 'äº¤æ˜“çŠ¶æ€',
    
    -- è®¡åˆ’é˜¶æ®µ
    plan_type ENUM('long', 'short') NOT NULL COMMENT 'äº¤æ˜“æ–¹å‘ï¼šåšå¤š/åšç©º',
    plan_entry_price DECIMAL(10, 2) COMMENT 'è®¡åˆ’å…¥åœºä»·æ ¼',
    plan_entry_price_range_low DECIMAL(10, 2) COMMENT 'å…¥åœºä»·æ ¼åŒºé—´-ä½',
    plan_entry_price_range_high DECIMAL(10, 2) COMMENT 'å…¥åœºä»·æ ¼åŒºé—´-é«˜',
    plan_quantity INT COMMENT 'è®¡åˆ’äº¤æ˜“æ•°é‡',
    plan_stop_loss DECIMAL(10, 2) COMMENT 'è®¡åˆ’æ­¢æŸä»·',
    plan_take_profit DECIMAL(10, 2) COMMENT 'è®¡åˆ’æ­¢ç›ˆä»·',
    plan_notes TEXT COMMENT 'è®¡åˆ’é˜¶æ®µç¬”è®°',
    plan_strategy TEXT COMMENT 'äº¤æ˜“ç­–ç•¥/æ€è·¯',
    plan_created_at DATETIME COMMENT 'è®¡åˆ’åˆ›å»ºæ—¶é—´',
    
    -- æ‰§è¡Œé˜¶æ®µ
    entry_price DECIMAL(10, 2) COMMENT 'å®é™…å…¥åœºä»·æ ¼',
    entry_time DATETIME COMMENT 'å…¥åœºæ—¶é—´',
    entry_quantity INT COMMENT 'å®é™…å…¥åœºæ•°é‡',
    entry_notes TEXT COMMENT 'å…¥åœºç¬”è®°',
    
    -- æŒä»“é˜¶æ®µ
    current_price DECIMAL(10, 2) COMMENT 'å½“å‰ä»·æ ¼',
    current_quantity INT COMMENT 'å½“å‰æŒä»“æ•°é‡',
    unrealized_pnl DECIMAL(10, 2) COMMENT 'æµ®åŠ¨ç›ˆäº',
    unrealized_pnl_pct DECIMAL(5, 2) COMMENT 'æµ®åŠ¨ç›ˆäºç™¾åˆ†æ¯”',
    
    -- å¹³ä»“é˜¶æ®µ
    exit_price DECIMAL(10, 2) COMMENT 'å¹³ä»“ä»·æ ¼',
    exit_time DATETIME COMMENT 'å¹³ä»“æ—¶é—´',
    exit_quantity INT COMMENT 'å¹³ä»“æ•°é‡',
    exit_notes TEXT COMMENT 'å¹³ä»“ç¬”è®°',
    
    -- äº¤æ˜“ç»“æœ
    realized_pnl DECIMAL(10, 2) COMMENT 'å·²å®ç°ç›ˆäº',
    realized_pnl_pct DECIMAL(5, 2) COMMENT 'å·²å®ç°ç›ˆäºç™¾åˆ†æ¯”',
    commission DECIMAL(10, 2) DEFAULT 0 COMMENT 'æ‰‹ç»­è´¹',
    net_pnl DECIMAL(10, 2) COMMENT 'å‡€ç›ˆäº',
    
    -- æ­¢æŸæ­¢ç›ˆ
    stop_loss_price DECIMAL(10, 2) COMMENT 'æ­¢æŸä»·',
    take_profit_price DECIMAL(10, 2) COMMENT 'æ­¢ç›ˆä»·',
    stop_loss_updated_at DATETIME COMMENT 'æ­¢æŸæ›´æ–°æ—¶é—´',
    
    -- å¤ç›˜
    review_rating TINYINT COMMENT 'äº¤æ˜“è¯„åˆ†(1-5)',
    review_notes TEXT COMMENT 'å¤ç›˜ç¬”è®°',
    review_lessons TEXT COMMENT 'ç»éªŒæ•™è®­',
    review_tags VARCHAR(500) COMMENT 'å¤ç›˜æ ‡ç­¾(JSONæ•°ç»„)',
    
    -- å…³è”
    strategy_id INT COMMENT 'å…³è”çš„ç­–ç•¥ID',
    category_id INT COMMENT 'å…³è”çš„åˆ†ç±»ID',
    
    -- å…ƒæ•°æ®
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at DATETIME COMMENT 'è½¯åˆ é™¤æ—¶é—´',
    
    INDEX idx_symbol (symbol),
    INDEX idx_status (status),
    INDEX idx_entry_time (entry_time),
    INDEX idx_exit_time (exit_time),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='äº¤æ˜“è®°å½•è¡¨';
```

### 2.2 äº¤æ˜“ç¬”è®°å…³è”è¡¨ (trade_notes)

```sql
CREATE TABLE trade_notes (
    id INT PRIMARY KEY AUTO_INCREMENT,
    trade_id INT NOT NULL COMMENT 'äº¤æ˜“ID',
    note_id INT NOT NULL COMMENT 'ç¬”è®°ID',
    note_stage ENUM('plan', 'entry', 'holding', 'exit', 'review') NOT NULL COMMENT 'ç¬”è®°é˜¶æ®µ',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (trade_id) REFERENCES trades(id) ON DELETE CASCADE,
    FOREIGN KEY (note_id) REFERENCES notes(id) ON DELETE CASCADE,
    INDEX idx_trade_id (trade_id),
    INDEX idx_note_stage (note_stage)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='äº¤æ˜“ç¬”è®°å…³è”è¡¨';
```

### 2.3 äº¤æ˜“æˆªå›¾è¡¨ (trade_screenshots)

```sql
CREATE TABLE trade_screenshots (
    id INT PRIMARY KEY AUTO_INCREMENT,
    trade_id INT NOT NULL COMMENT 'äº¤æ˜“ID',
    screenshot_type ENUM('kline', 'entry', 'exit', 'other') NOT NULL COMMENT 'æˆªå›¾ç±»å‹',
    screenshot_stage ENUM('plan', 'entry', 'holding', 'exit', 'review') NOT NULL COMMENT 'æˆªå›¾é˜¶æ®µ',
    file_path VARCHAR(500) NOT NULL COMMENT 'æ–‡ä»¶è·¯å¾„',
    file_url VARCHAR(500) COMMENT 'è®¿é—®URL',
    description TEXT COMMENT 'æˆªå›¾æè¿°',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (trade_id) REFERENCES trades(id) ON DELETE CASCADE,
    INDEX idx_trade_id (trade_id),
    INDEX idx_screenshot_type (screenshot_type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='äº¤æ˜“æˆªå›¾è¡¨';
```

### 2.4 äº¤æ˜“æé†’è¡¨ (trade_alerts)

```sql
CREATE TABLE trade_alerts (
    id INT PRIMARY KEY AUTO_INCREMENT,
    trade_id INT NOT NULL COMMENT 'äº¤æ˜“ID',
    
    -- æé†’ç±»å‹
    alert_type ENUM('price', 'time', 'pnl', 'custom') NOT NULL COMMENT 'æé†’ç±»å‹',
    
    -- ä»·æ ¼æé†’
    trigger_price DECIMAL(10, 2) COMMENT 'è§¦å‘ä»·æ ¼',
    price_direction ENUM('above', 'below') COMMENT 'ä»·æ ¼æ–¹å‘ï¼šå‘ä¸Š/å‘ä¸‹',
    
    -- æ—¶é—´æé†’
    trigger_time DATETIME COMMENT 'è§¦å‘æ—¶é—´',
    
    -- ç›ˆäºæé†’
    trigger_pnl_pct DECIMAL(5, 2) COMMENT 'è§¦å‘ç›ˆäºç™¾åˆ†æ¯”',
    pnl_direction ENUM('profit', 'loss') COMMENT 'ç›ˆäºæ–¹å‘',
    
    -- æé†’è®¾ç½®
    alert_title VARCHAR(200) NOT NULL COMMENT 'æé†’æ ‡é¢˜',
    alert_message TEXT COMMENT 'æé†’å†…å®¹',
    is_repeating BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦é‡å¤æé†’',
    repeat_interval INT COMMENT 'é‡å¤é—´éš”(åˆ†é’Ÿ)',
    
    -- çŠ¶æ€
    status ENUM('active', 'triggered', 'cancelled') NOT NULL DEFAULT 'active',
    triggered_at DATETIME COMMENT 'è§¦å‘æ—¶é—´',
    
    -- é€šçŸ¥æ–¹å¼
    notify_browser BOOLEAN DEFAULT TRUE COMMENT 'æµè§ˆå™¨é€šçŸ¥',
    notify_email BOOLEAN DEFAULT FALSE COMMENT 'é‚®ä»¶é€šçŸ¥',
    notify_sms BOOLEAN DEFAULT FALSE COMMENT 'çŸ­ä¿¡é€šçŸ¥',
    
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (trade_id) REFERENCES trades(id) ON DELETE CASCADE,
    INDEX idx_trade_id (trade_id),
    INDEX idx_status (status),
    INDEX idx_trigger_time (trigger_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='äº¤æ˜“æé†’è¡¨';
```

### 2.5 äº¤æ˜“è°ƒæ•´è®°å½•è¡¨ (trade_adjustments)

```sql
CREATE TABLE trade_adjustments (
    id INT PRIMARY KEY AUTO_INCREMENT,
    trade_id INT NOT NULL COMMENT 'äº¤æ˜“ID',
    adjustment_type ENUM('add_position', 'reduce_position', 'stop_loss', 'take_profit', 'other') NOT NULL,
    
    -- è°ƒæ•´å†…å®¹
    price DECIMAL(10, 2) COMMENT 'è°ƒæ•´ä»·æ ¼',
    quantity INT COMMENT 'è°ƒæ•´æ•°é‡',
    new_stop_loss DECIMAL(10, 2) COMMENT 'æ–°æ­¢æŸä»·',
    new_take_profit DECIMAL(10, 2) COMMENT 'æ–°æ­¢ç›ˆä»·',
    
    -- è¯´æ˜
    reason TEXT COMMENT 'è°ƒæ•´åŸå› ',
    notes TEXT COMMENT 'è°ƒæ•´ç¬”è®°',
    
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (trade_id) REFERENCES trades(id) ON DELETE CASCADE,
    INDEX idx_trade_id (trade_id),
    INDEX idx_adjustment_type (adjustment_type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='äº¤æ˜“è°ƒæ•´è®°å½•è¡¨';
```

## 3. API æ¥å£è®¾è®¡

### 3.1 äº¤æ˜“è®¡åˆ’ç›¸å…³

```python
# åˆ›å»ºäº¤æ˜“è®¡åˆ’
POST /api/v1/trades/plans
{
    "symbol": "AAPL",
    "plan_type": "long",
    "plan_entry_price": 180.50,
    "plan_entry_price_range_low": 179.00,
    "plan_entry_price_range_high": 182.00,
    "plan_quantity": 100,
    "plan_stop_loss": 175.00,
    "plan_take_profit": 190.00,
    "plan_notes": "çªç ´æœˆçº¿é˜»åŠ›ä½",
    "plan_strategy": "æŠ€æœ¯é¢çªç ´+åŸºæœ¬é¢æ”¯æ’‘"
}

# è·å–ç­‰å¾…æ‰§è¡Œçš„äº¤æ˜“è®¡åˆ’
GET /api/v1/trades/plans/pending

# æ›´æ–°äº¤æ˜“è®¡åˆ’
PUT /api/v1/trades/plans/{trade_id}

# å–æ¶ˆäº¤æ˜“è®¡åˆ’
POST /api/v1/trades/plans/{trade_id}/cancel
```

### 3.2 äº¤æ˜“æ‰§è¡Œç›¸å…³

```python
# å¼€ä»“ï¼ˆæ‰§è¡Œè®¡åˆ’ï¼‰
POST /api/v1/trades/{trade_id}/open
{
    "entry_price": 180.80,
    "entry_quantity": 100,
    "entry_time": "2024-01-15T10:30:00",
    "entry_notes": "æŒ‰è®¡åˆ’å…¥åœº"
}

# åŠ ä»“
POST /api/v1/trades/{trade_id}/add-position
{
    "price": 182.50,
    "quantity": 50,
    "notes": "çªç ´å…³é”®ä½ç½®åŠ ä»“"
}

# å‡ä»“
POST /api/v1/trades/{trade_id}/reduce-position
{
    "price": 185.00,
    "quantity": 50,
    "notes": "éƒ¨åˆ†æ­¢ç›ˆ"
}

# å¹³ä»“
POST /api/v1/trades/{trade_id}/close
{
    "exit_price": 188.50,
    "exit_quantity": 100,
    "exit_time": "2024-01-20T15:30:00",
    "exit_notes": "è¾¾åˆ°æ­¢ç›ˆç›®æ ‡"
}

# æ›´æ–°æ­¢æŸæ­¢ç›ˆ
PUT /api/v1/trades/{trade_id}/stop-loss-take-profit
{
    "stop_loss_price": 183.00,
    "take_profit_price": 195.00
}
```

### 3.3 æŒä»“æŸ¥è¯¢ç›¸å…³

```python
# è·å–æ­£åœ¨äº¤æ˜“çš„æŒä»“
GET /api/v1/trades/active
# è¿”å›ï¼šæŒä»“åˆ—è¡¨ï¼ŒåŒ…å«å®æ—¶ç›ˆäº

# è·å–å†å²äº¤æ˜“è®°å½•
GET /api/v1/trades/history
# æŸ¥è¯¢å‚æ•°ï¼š
# - page, page_size: åˆ†é¡µ
# - symbol: è‚¡ç¥¨ä»£ç 
# - start_date, end_date: æ—¥æœŸèŒƒå›´
# - status: äº¤æ˜“çŠ¶æ€
# - min_pnl, max_pnl: ç›ˆäºèŒƒå›´
# - strategy_id: ç­–ç•¥ç­›é€‰

# è·å–å•ä¸ªäº¤æ˜“è¯¦æƒ…
GET /api/v1/trades/{trade_id}
# è¿”å›ï¼šå®Œæ•´äº¤æ˜“ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‰€æœ‰ç¬”è®°ã€æˆªå›¾ã€è°ƒæ•´è®°å½•
```

### 3.4 äº¤æ˜“ç¬”è®°ç›¸å…³

```python
# ä¸ºäº¤æ˜“æ·»åŠ ç¬”è®°
POST /api/v1/trades/{trade_id}/notes
{
    "note_id": 123,  # ç°æœ‰ç¬”è®°ID
    "note_stage": "entry"
}

# åˆ›å»ºå¹¶å…³è”ç¬”è®°
POST /api/v1/trades/{trade_id}/notes/create
{
    "note_stage": "holding",
    "title": "æŒä»“è§‚å¯Ÿ",
    "content": "...",
    "tags": [...]
}

# è·å–äº¤æ˜“çš„æ‰€æœ‰ç¬”è®°
GET /api/v1/trades/{trade_id}/notes
```

### 3.5 äº¤æ˜“æˆªå›¾ç›¸å…³

```python
# ä¸Šä¼ äº¤æ˜“æˆªå›¾
POST /api/v1/trades/{trade_id}/screenshots
# Content-Type: multipart/form-data
{
    "file": <binary>,
    "screenshot_type": "kline",
    "screenshot_stage": "plan",
    "description": "è®¡åˆ’é˜¶æ®µKçº¿å›¾"
}

# è·å–äº¤æ˜“æˆªå›¾
GET /api/v1/trades/{trade_id}/screenshots

# åˆ é™¤æˆªå›¾
DELETE /api/v1/trades/screenshots/{screenshot_id}
```

### 3.6 äº¤æ˜“æé†’ç›¸å…³

```python
# åˆ›å»ºæé†’
POST /api/v1/trades/{trade_id}/alerts
{
    "alert_type": "price",
    "trigger_price": 185.00,
    "price_direction": "above",
    "alert_title": "ä»·æ ¼çªç ´æé†’",
    "alert_message": "AAPL çªç ´ 185 ç¾å…ƒ",
    "notify_browser": true
}

# è·å–äº¤æ˜“æé†’
GET /api/v1/trades/{trade_id}/alerts

# å–æ¶ˆæé†’
DELETE /api/v1/trades/alerts/{alert_id}

# è·å–æ‰€æœ‰æ´»è·ƒæé†’ï¼ˆç”¨äºå‰ç«¯è½®è¯¢ï¼‰
GET /api/v1/trades/alerts/active
```

### 3.7 ç»Ÿè®¡åˆ†æç›¸å…³

```python
# äº¤æ˜“ç»Ÿè®¡
GET /api/v1/trades/statistics
# è¿”å›ï¼š
# - æ€»äº¤æ˜“æ¬¡æ•°
# - ç›ˆåˆ©æ¬¡æ•°ã€äºæŸæ¬¡æ•°
# - èƒœç‡
# - æ€»ç›ˆäºã€å¹³å‡ç›ˆäº
# - æœ€å¤§å•ç¬”ç›ˆåˆ©/äºæŸ
# - æœ€å¤§è¿ç»­ç›ˆåˆ©/äºæŸ

# æŒ‰è‚¡ç¥¨ç»Ÿè®¡
GET /api/v1/trades/statistics/by-symbol

# æŒ‰ç­–ç•¥ç»Ÿè®¡
GET /api/v1/trades/statistics/by-strategy
```

## 4. å‰ç«¯ç•Œé¢è®¾è®¡

### 4.1 é¡µé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æˆ‘çš„äº¤æ˜“                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [æ­£åœ¨äº¤æ˜“] [ç­‰å¾…æ‰§è¡Œ] [å†å²è®°å½•] [ç»Ÿè®¡åˆ†æ]           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç­›é€‰ï¼š[è‚¡ç¥¨ä»£ç ] [æ—¥æœŸèŒƒå›´] [ç­–ç•¥] [ç›ˆäºèŒƒå›´]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ AAPL - Apple Inc.                    [æŸ¥çœ‹è¯¦æƒ…] â”‚    â”‚
â”‚  â”‚ å…¥åœº: $180.50 â†’ å½“å‰: $185.20 (+2.61%)         â”‚    â”‚
â”‚  â”‚ æ•°é‡: 100è‚¡ | æµ®åŠ¨ç›ˆäº: +$470.00               â”‚    â”‚
â”‚  â”‚ æ­¢æŸ: $175.00 | æ­¢ç›ˆ: $190.00                  â”‚    â”‚
â”‚  â”‚ [æ·»åŠ ç¬”è®°] [ä¸Šä¼ æˆªå›¾] [è®¾ç½®æé†’] [è°ƒæ•´ä»“ä½]   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ TSLA - Tesla Inc.                    [æŸ¥çœ‹è¯¦æƒ…] â”‚    â”‚
â”‚  â”‚ å…¥åœº: $220.00 â†’ å½“å‰: $215.50 (-2.05%)         â”‚    â”‚
â”‚  â”‚ ...                                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 äº¤æ˜“è¯¦æƒ…é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† è¿”å›    AAPL - Apple Inc.                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [è®¡åˆ’] [å…¥åœº] [æŒä»“] [è°ƒæ•´] [å¹³ä»“] [å¤ç›˜]             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æŒä»“æ¦‚è§ˆ                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ å…¥åœºä»·æ ¼   â”‚ å½“å‰ä»·æ ¼   â”‚ æµ®åŠ¨ç›ˆäº   â”‚ æŒä»“å¤©æ•°   â”‚  â”‚
â”‚  â”‚ $180.50    â”‚ $185.20    â”‚ +$470      â”‚ 5å¤©        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Kçº¿å›¾ [ä¸Šä¼ æˆªå›¾]                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â”‚          [Kçº¿å›¾æ˜¾ç¤ºåŒºåŸŸ]                         â”‚    â”‚
â”‚  â”‚                                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  äº¤æ˜“ç¬”è®° [æ–°å»ºç¬”è®°]                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ“ 2024-01-15 10:30 - å…¥åœºç¬”è®°                  â”‚    â”‚
â”‚  â”‚    æŒ‰è®¡åˆ’ä»·æ ¼å…¥åœºï¼Œçªç ´æœˆçº¿é˜»åŠ›ä½...             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ“ 2024-01-17 14:00 - æŒä»“è§‚å¯Ÿ                  â”‚    â”‚
â”‚  â”‚    è‚¡ä»·æŒç»­å‘ä¸Šï¼Œå…³æ³¨MACDé‡‘å‰ä¿¡å·...            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ´»è·ƒæé†’ [æ–°å»ºæé†’]                                     â”‚
â”‚  ğŸ”” ä»·æ ¼çªç ´ $190 æé†’                                   â”‚
â”‚  ğŸ”” æ­¢æŸä»·æ ¼ $175 ç›‘æ§                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 ç»„ä»¶æ¸…å•

1. **TradeList.tsx** - äº¤æ˜“åˆ—è¡¨ç»„ä»¶
2. **TradeCard.tsx** - äº¤æ˜“å¡ç‰‡ç»„ä»¶
3. **TradeDetail.tsx** - äº¤æ˜“è¯¦æƒ…ç»„ä»¶
4. **TradePlanForm.tsx** - äº¤æ˜“è®¡åˆ’è¡¨å•
5. **TradePositionPanel.tsx** - æŒä»“é¢æ¿
6. **TradeAdjustmentForm.tsx** - ä»“ä½è°ƒæ•´è¡¨å•
7. **TradeAlertForm.tsx** - æé†’è®¾ç½®è¡¨å•
8. **TradeScreenshotUploader.tsx** - æˆªå›¾ä¸Šä¼ ç»„ä»¶
9. **TradeTimeline.tsx** - äº¤æ˜“æ—¶é—´çº¿
10. **TradeStatistics.tsx** - äº¤æ˜“ç»Ÿè®¡é¢æ¿

## 5. å…³é”®åŠŸèƒ½å®ç°

### 5.1 å®æ—¶ç›ˆäºè®¡ç®—

```python
# åå°ä»»åŠ¡ï¼šå®šæ—¶æ›´æ–°æŒä»“ç›ˆäº
@scheduler.task('interval', minutes=1)
async def update_active_trades_pnl():
    active_trades = await get_active_trades()
    for trade in active_trades:
        # è·å–æœ€æ–°ä»·æ ¼
        current_price = await market_data.get_latest_price(trade.symbol)
        
        # è®¡ç®—ç›ˆäº
        if trade.plan_type == 'long':
            unrealized_pnl = (current_price - trade.entry_price) * trade.current_quantity
        else:  # short
            unrealized_pnl = (trade.entry_price - current_price) * trade.current_quantity
        
        unrealized_pnl_pct = (unrealized_pnl / (trade.entry_price * trade.current_quantity)) * 100
        
        # æ›´æ–°æ•°æ®åº“
        await update_trade(trade.id, {
            'current_price': current_price,
            'unrealized_pnl': unrealized_pnl,
            'unrealized_pnl_pct': unrealized_pnl_pct
        })
        
        # æ£€æŸ¥æé†’è§¦å‘
        await check_trade_alerts(trade)
```

### 5.2 æé†’è§¦å‘æ£€æŸ¥

```python
async def check_trade_alerts(trade):
    alerts = await get_active_alerts(trade.id)
    
    for alert in alerts:
        triggered = False
        
        if alert.alert_type == 'price':
            if alert.price_direction == 'above' and trade.current_price >= alert.trigger_price:
                triggered = True
            elif alert.price_direction == 'below' and trade.current_price <= alert.trigger_price:
                triggered = True
        
        elif alert.alert_type == 'pnl':
            if alert.pnl_direction == 'profit' and trade.unrealized_pnl_pct >= alert.trigger_pnl_pct:
                triggered = True
            elif alert.pnl_direction == 'loss' and trade.unrealized_pnl_pct <= -alert.trigger_pnl_pct:
                triggered = True
        
        elif alert.alert_type == 'time':
            if datetime.now() >= alert.trigger_time:
                triggered = True
        
        if triggered:
            await trigger_alert(alert, trade)
```

### 5.3 æˆªå›¾å­˜å‚¨

```python
# æ–‡ä»¶å­˜å‚¨ç»“æ„
/uploads/
  /trades/
    /{trade_id}/
      /screenshots/
        /plan/
        /entry/
        /holding/
        /exit/
        /review/

# æ–‡ä»¶å‘½åè§„åˆ™
{timestamp}_{screenshot_type}_{random}.jpg
```

## 6. å®ç°ä¼˜å…ˆçº§

### Phase 1 - æ ¸å¿ƒåŠŸèƒ½ï¼ˆç¬¬1å‘¨ï¼‰
- [ ] æ•°æ®åº“è¡¨åˆ›å»º
- [ ] åŸºç¡€APIæ¥å£ï¼ˆCRUDï¼‰
- [ ] äº¤æ˜“åˆ—è¡¨é¡µé¢ï¼ˆæ­£åœ¨äº¤æ˜“/ç­‰å¾…æ‰§è¡Œ/å†å²è®°å½•ï¼‰
- [ ] äº¤æ˜“è®¡åˆ’åˆ›å»ºè¡¨å•
- [ ] å¼€ä»“/å¹³ä»“åŠŸèƒ½

### Phase 2 - å¢å¼ºåŠŸèƒ½ï¼ˆç¬¬2å‘¨ï¼‰
- [ ] äº¤æ˜“è¯¦æƒ…é¡µé¢
- [ ] ç¬”è®°å…³è”åŠŸèƒ½
- [ ] æˆªå›¾ä¸Šä¼ åŠŸèƒ½
- [ ] ä»“ä½è°ƒæ•´åŠŸèƒ½
- [ ] å®æ—¶ç›ˆäºæ›´æ–°

### Phase 3 - é«˜çº§åŠŸèƒ½ï¼ˆç¬¬3å‘¨ï¼‰
- [ ] æé†’ç³»ç»Ÿ
- [ ] äº¤æ˜“æ—¶é—´çº¿
- [ ] ç»Ÿè®¡åˆ†æé¢æ¿
- [ ] å¤ç›˜åŠŸèƒ½
- [ ] æ‰¹é‡æ“ä½œ

## 7. æŠ€æœ¯è¦ç‚¹

### 7.1 å®æ—¶æ•°æ®æ›´æ–°
- ä½¿ç”¨ WebSocket æ¨é€ä»·æ ¼æ›´æ–°
- å‰ç«¯ä½¿ç”¨ SWR æˆ– React Query è‡ªåŠ¨åˆ·æ–°
- ä¹è§‚æ›´æ–°æå‡ç”¨æˆ·ä½“éªŒ

### 7.2 æ–‡ä»¶ä¸Šä¼ 
- æ”¯æŒæ‹–æ‹½ä¸Šä¼ 
- å›¾ç‰‡å‹ç¼©å’Œé¢„è§ˆ
- CDN åŠ é€Ÿè®¿é—®

### 7.3 æé†’é€šçŸ¥
- æµè§ˆå™¨ Notification API
- å¯é€‰é‚®ä»¶/çŸ­ä¿¡é€šçŸ¥
- æé†’å†å²è®°å½•

### 7.4 æ€§èƒ½ä¼˜åŒ–
- å†å²è®°å½•åˆ†é¡µåŠ è½½
- è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤§é‡æ•°æ®ï¼‰
- å›¾ç‰‡æ‡’åŠ è½½

## 8. ä¸å…¶ä»–æ¨¡å—çš„é›†æˆ

### 8.1 ä¸äº¤æ˜“ç¬”è®°çš„å…³ç³»
- äº¤æ˜“å¯ä»¥å…³è”å¤šä¸ªç¬”è®°
- ç¬”è®°å¯ä»¥å±äºäº¤æ˜“çš„ä¸åŒé˜¶æ®µ
- ä»äº¤æ˜“è¯¦æƒ…å¿«é€Ÿåˆ›å»ºç¬”è®°

### 8.2 ä¸ç­–ç•¥ç³»ç»Ÿçš„å…³ç³»
- äº¤æ˜“å¯ä»¥æ ‡è®°ä½¿ç”¨çš„ç­–ç•¥
- æŒ‰ç­–ç•¥ç»Ÿè®¡äº¤æ˜“æ•ˆæœ
- éªŒè¯ç­–ç•¥æœ‰æ•ˆæ€§

### 8.3 ä¸æ•°æ®æºçš„å…³ç³»
- å®æ—¶è·å–è‚¡ç¥¨ä»·æ ¼
- å†å²Kçº¿æ•°æ®å±•ç¤º
- åŸºæœ¬é¢æ•°æ®å‚è€ƒ

## 9. æœªæ¥æ‰©å±•

- [ ] äº¤æ˜“æ—¥å†è§†å›¾
- [ ] äº¤æ˜“å¯¹æ¯”åˆ†æ
- [ ] AI äº¤æ˜“å»ºè®®
- [ ] äº¤æ˜“åˆ†äº«åŠŸèƒ½
- [ ] äº¤æ˜“æ¨¡æ¿
- [ ] æ¨¡æ‹Ÿäº¤æ˜“

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-18  
**æœ€åæ›´æ–°**: 2025-10-18


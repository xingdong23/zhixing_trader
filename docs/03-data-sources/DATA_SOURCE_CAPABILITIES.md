# æ•°æ®æºèƒ½åŠ›å¯¹æ¯”åˆ†æ

> **ç›®çš„**ï¼šä¸ºå›æµ‹ç³»ç»Ÿé€‰æ‹©æœ€åˆé€‚çš„æ•°æ®æºï¼Œè·å–è‡ªé€‰è‚¡çš„å®Œæ•´å†å²æ•°æ®

## ğŸ“Š å¿«é€Ÿå¯¹æ¯”è¡¨

| æ•°æ®æº | å…è´¹é¢åº¦ | æ”¯æŒæ—¶é—´çº§åˆ« | å†å²æ•°æ®èŒƒå›´ | é€‚ç”¨åœºæ™¯ | æ¨èåº¦ |
|--------|---------|-------------|-------------|---------|--------|
| **Yahoo Finance** | æ— é™åˆ¶(æœ‰éšå½¢é™æµ) | 1m, 2m, 5m, 15m, 30m, 60m, 90m, 1h, 1d, 5d, 1wk, 1mo, 3mo | æœ€é•¿20å¹´(æ—¥çº¿), 60å¤©(1åˆ†é’Ÿçº¿) | æ—¥çº¿åŠä»¥ä¸Šå›æµ‹ | â­â­â­â­â­ |
| **Alpha Vantage** | 5æ¬¡/åˆ†é’Ÿ, 500æ¬¡/å¤© | 1min, 5min, 15min, 30min, 60min, daily, weekly, monthly | 20å¹´(æ—¥çº¿), æœ€è¿‘1-2ä¸ªæœˆ(åˆ†é’Ÿçº¿) | æ—¥çº¿é•¿æœŸå›æµ‹ | â­â­â­â­ |
| **Finnhub** | 60æ¬¡/åˆ†é’Ÿ | 1, 5, 15, 30, 60, D, W, M | 1å¹´(å…è´¹ç‰ˆ) | å®æ—¶æ•°æ® | â­â­â­ |
| **Twelve Data** | 8æ¬¡/åˆ†é’Ÿ, 800æ¬¡/å¤© | 1min, 5min, 15min, 30min, 1h, 1day, 1week, 1month | æœ€å¤š5000ä¸ªæ•°æ®ç‚¹ | ä¸­æœŸå›æµ‹ | â­â­â­â­ |

---

## 1ï¸âƒ£ Yahoo Financeï¼ˆæ¨èç”¨äºå›æµ‹ï¼‰

### âœ… ä¼˜åŠ¿
- **æ— éœ€API Key**ï¼šå®Œå…¨å…è´¹ï¼Œæ— éœ€æ³¨å†Œ
- **æ•°æ®é‡æœ€å¤§**ï¼šæ”¯æŒæœ€é•¿å†å²æ•°æ®
- **æ—¶é—´çº§åˆ«æœ€å…¨**ï¼šä»1åˆ†é’Ÿåˆ°æœˆçº¿éƒ½æ”¯æŒ
- **æ•°æ®è´¨é‡é«˜**ï¼šæ¥è‡ªå®˜æ–¹äº¤æ˜“æ‰€æ•°æ®

### âš ï¸ é™åˆ¶
- **éšå½¢é™æµ**ï¼šé¢‘ç¹è¯·æ±‚ä¼šè¢«ä¸´æ—¶å°ç¦ï¼ˆé€šå¸¸å‡ å°æ—¶åæ¢å¤ï¼‰
- **åˆ†é’Ÿçº¿é™åˆ¶**ï¼š1åˆ†é’Ÿçº¿æ•°æ®åªèƒ½è·å–æœ€è¿‘7å¤©ï¼Œ5åˆ†é’Ÿçº¿æœ€è¿‘60å¤©
- **ä¸ç¨³å®š**ï¼šYahooå¯èƒ½éšæ—¶è°ƒæ•´APIæˆ–é™åˆ¶

### ğŸ“ˆ æ”¯æŒçš„æ—¶é—´çº§åˆ«ï¼ˆintervalï¼‰

| Interval | è¯´æ˜ | æœ€å¤§å†å²èŒƒå›´ | é€‚åˆåœºæ™¯ |
|----------|------|-------------|---------|
| `1m` | 1åˆ†é’Ÿçº¿ | 7å¤© | è¶…çŸ­çº¿å›æµ‹ |
| `2m` | 2åˆ†é’Ÿçº¿ | 60å¤© | è¶…çŸ­çº¿å›æµ‹ |
| `5m` | 5åˆ†é’Ÿçº¿ | 60å¤© | çŸ­çº¿å›æµ‹ |
| `15m` | 15åˆ†é’Ÿçº¿ | 60å¤© | æ—¥å†…å›æµ‹ |
| `30m` | 30åˆ†é’Ÿçº¿ | 60å¤© | æ—¥å†…å›æµ‹ |
| `60m` / `1h` | 1å°æ—¶çº¿ | 730å¤©(2å¹´) | æ³¢æ®µå›æµ‹ |
| `90m` | 90åˆ†é’Ÿçº¿ | 60å¤© | æ³¢æ®µå›æµ‹ |
| `1d` | æ—¥çº¿ | 20å¹´+ | **æœ€å¸¸ç”¨** |
| `5d` | 5æ—¥çº¿ | 20å¹´+ | å‘¨çº§åˆ«åˆ†æ |
| `1wk` | å‘¨çº¿ | 20å¹´+ | ä¸­é•¿æœŸå›æµ‹ |
| `1mo` | æœˆçº¿ | 20å¹´+ | é•¿æœŸè¶‹åŠ¿ |
| `3mo` | å­£çº¿ | 20å¹´+ | é•¿æœŸè¶‹åŠ¿ |

### ğŸ“… Periodï¼ˆæ—¶é—´èŒƒå›´ï¼‰å‚æ•°
```python
periods = [
    "1d",      # 1å¤©
    "5d",      # 5å¤©
    "1mo",     # 1ä¸ªæœˆ
    "3mo",     # 3ä¸ªæœˆ
    "6mo",     # 6ä¸ªæœˆ
    "1y",      # 1å¹´
    "2y",      # 2å¹´
    "5y",      # 5å¹´
    "10y",     # 10å¹´
    "ytd",     # å¹´åˆè‡³ä»Š
    "max"      # æœ€å¤§èŒƒå›´ï¼ˆå¯èƒ½20å¹´+ï¼‰
]
```

### ğŸ’¡ å›æµ‹å»ºè®®
```python
# æ—¥çº¿å›æµ‹ï¼ˆæ¨èï¼‰
interval = "1d"
period = "max"  # è·å–æœ€é•¿å†å²ï¼Œé€šå¸¸èƒ½æ‹¿åˆ°15-20å¹´

# å°æ—¶çº¿å›æµ‹
interval = "1h"
period = "2y"   # æœ€å¤š2å¹´

# 15åˆ†é’Ÿçº¿å›æµ‹
interval = "15m"
period = "60d"  # æœ€å¤š60å¤©
```

### ğŸ”§ ä½¿ç”¨ç¤ºä¾‹
```python
from app.core.market_data import YahooFinanceProvider

provider = YahooFinanceProvider(rate_limit_delay=1.0)

# è·å–AAPLçš„æ‰€æœ‰å†å²æ—¥çº¿æ•°æ®
data = await provider.get_stock_data("AAPL", period="max", interval="1d")
print(f"è·å–åˆ° {len(data)} æ¡æ•°æ®")
# è¾“å‡º: è·å–åˆ° 5000+ æ¡æ•°æ®ï¼ˆçº¦20å¹´ï¼‰
```

---

## 2ï¸âƒ£ Alpha Vantage

### âœ… ä¼˜åŠ¿
- **æ•°æ®æƒå¨**ï¼šæ¥è‡ªå®˜æ–¹æ•°æ®æä¾›å•†
- **æ—¥çº¿æ•°æ®å®Œæ•´**ï¼š20å¹´å®Œæ•´å†å²
- **APIç¨³å®š**ï¼šä¸ä¼šè¢«å°ç¦

### âš ï¸ é™åˆ¶
- **ä¸¥æ ¼é™æµ**ï¼šå…è´¹ç‰ˆä»…5æ¬¡/åˆ†é’Ÿï¼Œ500æ¬¡/å¤©
- **åˆ†é’Ÿçº¿æœ‰é™**ï¼šæœ€è¿‘1-2ä¸ªæœˆ
- **éœ€è¦API Key**ï¼šéœ€è¦æ³¨å†Œè·å–

### ğŸ“ˆ æ”¯æŒçš„æ—¶é—´çº§åˆ«

| Function | Interval | æœ€å¤§å†å²èŒƒå›´ | è¯´æ˜ |
|----------|----------|-------------|------|
| `TIME_SERIES_INTRADAY` | 1min | æœ€è¿‘1-2ä¸ªæœˆ | æ—¥å†…æ•°æ® |
| `TIME_SERIES_INTRADAY` | 5min | æœ€è¿‘1-2ä¸ªæœˆ | æ—¥å†…æ•°æ® |
| `TIME_SERIES_INTRADAY` | 15min | æœ€è¿‘1-2ä¸ªæœˆ | æ—¥å†…æ•°æ® |
| `TIME_SERIES_INTRADAY` | 30min | æœ€è¿‘1-2ä¸ªæœˆ | æ—¥å†…æ•°æ® |
| `TIME_SERIES_INTRADAY` | 60min | æœ€è¿‘1-2ä¸ªæœˆ | æ—¥å†…æ•°æ® |
| `TIME_SERIES_DAILY` | daily | **20å¹´+** | **å›æµ‹é¦–é€‰** |
| `TIME_SERIES_WEEKLY` | weekly | **20å¹´+** | å‘¨çº¿æ•°æ® |
| `TIME_SERIES_MONTHLY` | monthly | **20å¹´+** | æœˆçº¿æ•°æ® |

### ğŸ“Š æ•°æ®é‡åˆ†æ
- **æ—¥çº¿**ï¼š`outputsize=full` å¯è·å–20å¹´æ•°æ®ï¼ˆçº¦5000ä¸ªäº¤æ˜“æ—¥ï¼‰
- **åˆ†é’Ÿçº¿**ï¼š`outputsize=full` çº¦1-2ä¸ªæœˆæ•°æ®ï¼ˆå–å†³äºäº¤æ˜“æ—¥æ•°é‡ï¼‰
- **å‘¨çº¿/æœˆçº¿**ï¼š20å¹´ä»¥ä¸Šå®Œæ•´æ•°æ®

### ğŸ’¡ å›æµ‹å»ºè®®
```python
# â­ æœ€ä½³ä½¿ç”¨åœºæ™¯ï¼šæ—¥çº¿åŠä»¥ä¸Šçº§åˆ«å›æµ‹
interval = "1d"
period = "max"  # å¯è·å–20å¹´æ•°æ®

# ä¸æ¨èï¼šåˆ†é’Ÿçº¿å›æµ‹ï¼ˆæ•°æ®å¤ªå°‘ï¼‰
interval = "1min"
period = "max"  # åªèƒ½æ‹¿åˆ°1-2ä¸ªæœˆ
```

### ğŸ”§ ä½¿ç”¨ç¤ºä¾‹
```python
from app.core.market_data import AlphaVantageProvider

provider = AlphaVantageProvider(
    api_key="YOUR_API_KEY",
    rate_limit_delay=12.0  # 5æ¬¡/åˆ†é’Ÿ = 12ç§’/æ¬¡
)

# è·å–æ—¥çº¿æ•°æ®ï¼ˆæ¨èï¼‰
data = await provider.get_stock_data("AAPL", period="max", interval="1d")
print(f"è·å–åˆ° {len(data)} æ¡æ•°æ®")
# è¾“å‡º: è·å–åˆ° 5000+ æ¡æ•°æ®ï¼ˆ20å¹´ï¼‰

# âš ï¸ æ³¨æ„ï¼š5æ¬¡/åˆ†é’Ÿé™åˆ¶æ„å‘³ç€æ¯å¤©æœ€å¤šè·å–500åªè‚¡ç¥¨çš„æ•°æ®ï¼
```

### âš ï¸ æ‰¹é‡è·å–é™åˆ¶
å¦‚æœä½ æœ‰100åªè‡ªé€‰è‚¡ï¼š
- æ¯åªè‚¡ç¥¨1æ¬¡APIè°ƒç”¨
- 100æ¬¡è°ƒç”¨ Ã· 5æ¬¡/åˆ†é’Ÿ = **20åˆ†é’Ÿ**
- æ¥è¿‘æ¯æ—¥500æ¬¡é™åˆ¶ï¼Œç¬¬äºŒå¤©æ‰èƒ½ç»§ç»­

---

## 3ï¸âƒ£ Finnhub

### âœ… ä¼˜åŠ¿
- **é™æµå®½æ¾**ï¼š60æ¬¡/åˆ†é’Ÿ
- **å®æ—¶æ•°æ®å¥½**ï¼šé€‚åˆè·å–æœ€æ–°æŠ¥ä»·
- **å“åº”å¿«**ï¼šAPIé€Ÿåº¦å¿«

### âš ï¸ é™åˆ¶
- **å†å²æ•°æ®çŸ­**ï¼šå…è´¹ç‰ˆä»…1å¹´
- **å›æµ‹ä»·å€¼ä½**ï¼šä¸é€‚åˆé•¿æœŸå›æµ‹

### ğŸ“ˆ æ”¯æŒçš„æ—¶é—´çº§åˆ«

| Resolution | è¯´æ˜ | æœ€å¤§å†å²èŒƒå›´(å…è´¹ç‰ˆ) |
|-----------|------|---------------------|
| `1` | 1åˆ†é’Ÿ | 1ä¸ªæœˆ |
| `5` | 5åˆ†é’Ÿ | 1ä¸ªæœˆ |
| `15` | 15åˆ†é’Ÿ | 1ä¸ªæœˆ |
| `30` | 30åˆ†é’Ÿ | 1ä¸ªæœˆ |
| `60` | 1å°æ—¶ | 1å¹´ |
| `D` | æ—¥çº¿ | 1å¹´ |
| `W` | å‘¨çº¿ | 1å¹´ |
| `M` | æœˆçº¿ | 1å¹´ |

### ğŸ’¡ å›æµ‹å»ºè®®
```python
# âŒ ä¸æ¨èç”¨äºå›æµ‹ï¼šå†å²æ•°æ®å¤ªçŸ­
# âœ… é€‚åˆç”¨äºï¼šå®æ—¶æ•°æ®è¡¥å……
```

---

## 4ï¸âƒ£ Twelve Data

### âœ… ä¼˜åŠ¿
- **å…è´¹é¢åº¦åˆç†**ï¼š800æ¬¡/å¤©
- **æ•°æ®ç‚¹çµæ´»**ï¼šå¯è·å–5000ä¸ªæ•°æ®ç‚¹
- **æ—¶é—´çº§åˆ«å…¨**ï¼šæ”¯æŒå„ç§çº§åˆ«

### âš ï¸ é™åˆ¶
- **éœ€è¦è®¡ç®—æ•°æ®ç‚¹**ï¼š5000ç‚¹é™åˆ¶
- **é™æµè¾ƒæ…¢**ï¼š8æ¬¡/åˆ†é’Ÿ
- **éœ€è¦API Key**

### ğŸ“ˆ æ”¯æŒçš„æ—¶é—´çº§åˆ«

| Interval | è¯´æ˜ | 5000ç‚¹èƒ½æ‹¿å¤šä¹…æ•°æ® |
|----------|------|-------------------|
| `1min` | 1åˆ†é’Ÿ | çº¦12ä¸ªäº¤æ˜“æ—¥ï¼ˆæ¯å¤©390ç‚¹ï¼‰ |
| `5min` | 5åˆ†é’Ÿ | çº¦64ä¸ªäº¤æ˜“æ—¥ |
| `15min` | 15åˆ†é’Ÿ | çº¦192ä¸ªäº¤æ˜“æ—¥ï¼ˆçº¦6ä¸ªæœˆï¼‰ |
| `30min` | 30åˆ†é’Ÿ | çº¦385ä¸ªäº¤æ˜“æ—¥ï¼ˆçº¦1.5å¹´ï¼‰ |
| `1h` | 1å°æ—¶ | çº¦770ä¸ªäº¤æ˜“æ—¥ï¼ˆçº¦3å¹´ï¼‰ |
| `1day` | æ—¥çº¿ | **5000ä¸ªäº¤æ˜“æ—¥ï¼ˆçº¦20å¹´ï¼‰** â­ |
| `1week` | å‘¨çº¿ | çº¦96å¹´ |
| `1month` | æœˆçº¿ | çº¦416å¹´ |

### ğŸ’¡ å›æµ‹å»ºè®®
```python
# â­ æœ€ä½³ä½¿ç”¨åœºæ™¯ï¼šæ—¥çº¿å›æµ‹
interval = "1day"
# 5000ä¸ªäº¤æ˜“æ—¥ = çº¦20å¹´æ•°æ®

# å¯ç”¨åœºæ™¯ï¼šå°æ—¶çº¿ä¸­æœŸå›æµ‹
interval = "1h"
# 5000ç‚¹ = çº¦3å¹´æ•°æ®

# ä¸å¤ªå¤Ÿï¼š15åˆ†é’Ÿçº¿
interval = "15min"
# 5000ç‚¹ = çº¦6ä¸ªæœˆæ•°æ®
```

### ğŸ”§ ä½¿ç”¨ç¤ºä¾‹
```python
from app.core.market_data import TwelveDataProvider

provider = TwelveDataProvider(
    api_key="YOUR_API_KEY",
    rate_limit_delay=7.5  # 8æ¬¡/åˆ†é’Ÿ
)

# è·å–æ—¥çº¿æ•°æ®
data = await provider.get_stock_data("AAPL", period="5y", interval="1d")
print(f"è·å–åˆ° {len(data)} æ¡æ•°æ®")
# è¾“å‡º: è·å–åˆ° çº¦1260 æ¡æ•°æ®ï¼ˆ5å¹´ï¼‰
```

---

## ğŸ¯ å›æµ‹åœºæ™¯æ¨è

### åœºæ™¯1ï¼šé•¿æœŸæ—¥çº¿å›æµ‹ï¼ˆ1å¹´+ï¼‰

**æ¨èç»„åˆ**ï¼š
1. **é¦–é€‰**ï¼šYahoo Financeï¼ˆå…è´¹ï¼Œæ•°æ®æœ€å…¨ï¼‰
2. **å¤‡é€‰**ï¼šAlpha Vantageï¼ˆç¨³å®šä½†é™æµä¸¥æ ¼ï¼‰
3. **å¤‡é€‰**ï¼šTwelve Dataï¼ˆé™åˆ¶5000ç‚¹ï¼‰

```python
# æ¨èé…ç½®
provider = YahooFinanceProvider(rate_limit_delay=2.0)  # æ…¢ä¸€ç‚¹ï¼Œé¿å…è¢«å°
data = await provider.get_stock_data("AAPL", period="max", interval="1d")
```

**ä¼˜åŠ¿**ï¼š
- Yahoo Financeå¯è·å–15-20å¹´æ•°æ®
- å®Œå…¨å…è´¹ï¼Œæ— éœ€API Key
- æ•°æ®è´¨é‡é«˜

**æ³¨æ„äº‹é¡¹**ï¼š
- æ‰¹é‡è·å–æ—¶åŠ å¤§å»¶è¿Ÿï¼ˆ2-3ç§’/æ¬¡ï¼‰
- åˆ†æ‰¹å¤„ç†ï¼Œé¿å…ä¸€æ¬¡æ€§è¯·æ±‚å¤ªå¤š
- é‡åˆ°é™æµå°±åˆ‡æ¢åˆ°Alpha Vantage

---

### åœºæ™¯2ï¼šå°æ—¶çº¿æ³¢æ®µå›æµ‹ï¼ˆ1-2å¹´ï¼‰

**æ¨èç»„åˆ**ï¼š
1. **é¦–é€‰**ï¼šYahoo Financeï¼ˆå¯è·å–2å¹´æ•°æ®ï¼‰
2. **å¤‡é€‰**ï¼šTwelve Dataï¼ˆå¯è·å–3å¹´æ•°æ®ï¼Œä½†ç‚¹æ•°é™åˆ¶ï¼‰

```python
# Yahooé…ç½®
data = await yahoo.get_stock_data("AAPL", period="2y", interval="1h")

# Twelve Dataé…ç½®ï¼ˆå¦‚æœYahooè¢«é™æµï¼‰
data = await twelve.get_stock_data("AAPL", period="3y", interval="1h")
```

---

### åœºæ™¯3ï¼š15åˆ†é’Ÿçº¿çŸ­æœŸå›æµ‹ï¼ˆ1-2ä¸ªæœˆï¼‰

**æ¨èç»„åˆ**ï¼š
1. **é¦–é€‰**ï¼šYahoo Financeï¼ˆ60å¤©æ•°æ®ï¼‰
2. **å¤‡é€‰**ï¼šTwelve Dataï¼ˆçº¦6ä¸ªæœˆæ•°æ®ï¼‰

```python
data = await yahoo.get_stock_data("AAPL", period="60d", interval="15m")
```

---

### åœºæ™¯4ï¼šåˆ†é’Ÿçº¿è¶…çŸ­çº¿å›æµ‹ï¼ˆä¸æ¨èï¼‰

**é—®é¢˜**ï¼š
- Yahoo: 1åˆ†é’Ÿçº¿ä»…7å¤©ï¼Œ5åˆ†é’Ÿçº¿60å¤©
- Alpha Vantage: åˆ†é’Ÿçº¿1-2ä¸ªæœˆ
- Twelve Data: 1åˆ†é’Ÿçº¿ä»…12å¤©

**ç»“è®º**ï¼š**ä¸å»ºè®®åšåˆ†é’Ÿçº¿å›æµ‹**ï¼Œæ•°æ®å¤ªå°‘ï¼Œç»Ÿè®¡æ„ä¹‰ä¸è¶³

å¦‚æœå¿…é¡»åšï¼š
```python
# 5åˆ†é’Ÿçº¿ï¼ˆæœ€å¤š60å¤©ï¼‰
data = await yahoo.get_stock_data("AAPL", period="60d", interval="5m")
```

---

## ğŸš€ æ‰¹é‡å›æµ‹æ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šYahooä¸ºä¸»ï¼ˆæ¨èï¼‰

**é€‚ç”¨**ï¼š
- è‡ªé€‰è‚¡ â‰¤ 100åª
- ä¸ç€æ€¥ï¼ˆå¯ä»¥åˆ†å¤šæ¬¡è¿è¡Œï¼‰

```python
# é…ç½®
provider = YahooFinanceProvider(rate_limit_delay=2.0)

# æ‰¹é‡è·å–
for symbol in watchlist:
    data = await provider.get_stock_data(symbol, "max", "1d")
    # ä¿å­˜åˆ°æ•°æ®åº“
    save_to_db(symbol, data)
    await asyncio.sleep(2)  # é¢å¤–å»¶è¿Ÿ
```

**æ—¶é—´ä¼°ç®—**ï¼š
- 100åªè‚¡ç¥¨ Ã— 2ç§’ = 200ç§’ â‰ˆ **3.5åˆ†é’Ÿ**

---

### æ–¹æ¡ˆBï¼šå¤šæ•°æ®æºæ™ºèƒ½åˆ‡æ¢

**é€‚ç”¨**ï¼š
- è‡ªé€‰è‚¡ > 100åª
- éœ€è¦æ›´å¿«é€Ÿåº¦
- å¯æ¥å—æ³¨å†Œå¤šä¸ªAPI

```python
from app.core.market_data import MultiProvider

provider = MultiProvider(
    providers=[
        ('yahoo', YahooFinanceProvider(rate_limit_delay=2.0)),
        ('alpha', AlphaVantageProvider(api_key="KEY1", rate_limit_delay=12.0)),
        ('alpha2', AlphaVantageProvider(api_key="KEY2", rate_limit_delay=12.0)),
        ('twelve', TwelveDataProvider(api_key="KEY3", rate_limit_delay=7.5)),
    ],
    strategy='load_balance'  # è´Ÿè½½å‡è¡¡
)

# æ‰¹é‡è·å–ï¼ˆè‡ªåŠ¨åˆ‡æ¢æ•°æ®æºï¼‰
results = await provider.get_multiple_stocks_data(
    watchlist, 
    period="max", 
    interval="1d"
)
```

**ä¼˜åŠ¿**ï¼š
- å¤šä¸ªAlpha Vantageè´¦å· = å¤šå€é€Ÿåº¦
- Yahooé™æµæ—¶è‡ªåŠ¨åˆ‡æ¢
- æ›´ç¨³å®šå¯é 

**æ—¶é—´ä¼°ç®—**ï¼š
- 500åªè‚¡ç¥¨ï¼Œ3ä¸ªæ•°æ®æºå¹¶è¡Œ
- çº¦ **10-15åˆ†é’Ÿ** å®Œæˆ

---

## ğŸ“Š æ•°æ®è´¨é‡å¯¹æ¯”

| æ•°æ®æº | å‡†ç¡®æ€§ | å®Œæ•´æ€§ | å»¶è¿Ÿ | å¤æƒå¤„ç† |
|--------|--------|--------|------|---------|
| Yahoo Finance | â­â­â­â­â­ | â­â­â­â­â­ | 15åˆ†é’Ÿ+ | è‡ªåŠ¨ |
| Alpha Vantage | â­â­â­â­â­ | â­â­â­â­ | å®æ—¶ | æ”¯æŒ |
| Finnhub | â­â­â­â­ | â­â­â­ | å®æ—¶ | éœ€æ‰‹åŠ¨ |
| Twelve Data | â­â­â­â­ | â­â­â­â­ | å®æ—¶ | æ”¯æŒ |

---

## ğŸ’° æˆæœ¬åˆ†æï¼ˆä»˜è´¹ç‰ˆï¼‰

å¦‚æœå…è´¹ç‰ˆä¸å¤Ÿç”¨ï¼Œä»˜è´¹ç‰ˆä»·æ ¼å‚è€ƒï¼š

| æ•°æ®æº | å…è´¹ç‰ˆ | ä»˜è´¹ç‰ˆä»·æ ¼ | å‡çº§è·å¾— |
|--------|--------|-----------|---------|
| **Alpha Vantage** | 5æ¬¡/åˆ†, 500æ¬¡/å¤© | $50/æœˆ èµ· | 75æ¬¡/åˆ†, æ— æ—¥é™åˆ¶ |
| **Finnhub** | 60æ¬¡/åˆ†, 1å¹´å†å² | $10/æœˆ èµ· | 300æ¬¡/åˆ†, 5å¹´å†å² |
| **Twelve Data** | 8æ¬¡/åˆ†, 800æ¬¡/å¤© | $29/æœˆ èµ· | æ›´å¤šè¯·æ±‚ï¼Œå®æ—¶æ•°æ® |
| **Yahoo Finance** | å…è´¹ | N/A | æ— ä»˜è´¹ç‰ˆ |

**ç»“è®º**ï¼šå¯¹äºå›æµ‹ï¼Œ**å…è´¹çš„Yahoo Financeå·²ç»è¶³å¤Ÿ**ï¼

---

## ğŸ¯ æœ€ç»ˆæ¨èæ–¹æ¡ˆ

### ğŸ¥‡ æ–¹æ¡ˆ1ï¼šçº¯Yahooï¼ˆæœ€ç®€å•ï¼‰

```python
# ä¼˜åŠ¿ï¼šå®Œå…¨å…è´¹ï¼Œæ•°æ®æœ€å…¨
# åŠ£åŠ¿ï¼šå¯èƒ½é‡åˆ°é™æµ

provider = YahooFinanceProvider(rate_limit_delay=2.0)

for symbol in watchlist:
    try:
        data = await provider.get_stock_data(symbol, "max", "1d")
        save_to_db(symbol, data)
    except Exception as e:
        logger.error(f"è·å– {symbol} å¤±è´¥: {e}")
        # ç­‰å¾…åé‡è¯•
        await asyncio.sleep(60)
```

---

### ğŸ¥ˆ æ–¹æ¡ˆ2ï¼šYahoo + Alpha Vantageï¼ˆæ¨èï¼‰

```python
# ä¼˜åŠ¿ï¼šäº’ç›¸å¤‡ä»½ï¼Œæ›´å¯é 
# åŠ£åŠ¿ï¼šéœ€è¦æ³¨å†ŒAlpha Vantage

from app.core.market_data import HybridProvider

provider = HybridProvider(
    primary=YahooFinanceProvider(rate_limit_delay=2.0),
    fallback=AlphaVantageProvider(api_key="YOUR_KEY", rate_limit_delay=12.0)
)

# Yahooå¤±è´¥è‡ªåŠ¨åˆ‡æ¢åˆ°Alpha Vantage
data = await provider.get_stock_data(symbol, "max", "1d")
```

---

### ğŸ¥‰ æ–¹æ¡ˆ3ï¼šå¤šæ•°æ®æº+å¤šè´¦å·ï¼ˆæœ€å¼ºï¼‰

```python
# ä¼˜åŠ¿ï¼šé€Ÿåº¦æœ€å¿«ï¼Œæœ€ç¨³å®š
# åŠ£åŠ¿ï¼šéœ€è¦æ³¨å†Œå¤šä¸ªè´¦å·

from app.core.market_data import ScenarioRouter

router = ScenarioRouter()

# ä¸ºå†å²æ•°æ®åœºæ™¯é…ç½®å¤šæ•°æ®æº
router.configure_scenario('historical', [
    ('yahoo', 0.5, 2.0),    # 50%æ¦‚ç‡ï¼Œ2ç§’å»¶è¿Ÿ
    ('alpha1', 0.3, 12.0),  # 30%æ¦‚ç‡
    ('alpha2', 0.2, 12.0),  # 20%æ¦‚ç‡
])

# æ™ºèƒ½è·å–æ•°æ®
data = await router.get_data(
    symbol, 
    period="max", 
    interval="1d",
    scenario="historical"
)
```

---

## ğŸ“ å®æ–½æ­¥éª¤

### Step 1: æµ‹è¯•å•ä¸ªæ•°æ®æº

```python
# åˆ›å»ºæµ‹è¯•è„šæœ¬
async def test_provider():
    provider = YahooFinanceProvider()
    
    # æµ‹è¯•è·å–æ•°æ®
    data = await provider.get_stock_data("AAPL", "max", "1d")
    
    print(f"è·å–åˆ° {len(data)} æ¡æ•°æ®")
    print(f"æœ€æ—©æ—¥æœŸ: {data[0].datetime}")
    print(f"æœ€æ–°æ—¥æœŸ: {data[-1].datetime}")
    print(f"æ•°æ®è·¨åº¦: {(data[-1].datetime - data[0].datetime).days} å¤©")
```

### Step 2: ä¿å­˜åˆ°æ•°æ®åº“

```python
from app.core.kline_manager import KLineManager

async def backfill_historical_data(symbol: str):
    # è·å–æ•°æ®
    provider = YahooFinanceProvider(rate_limit_delay=2.0)
    data = await provider.get_stock_data(symbol, "max", "1d")
    
    # ä¿å­˜åˆ°dailyè¡¨
    manager = KLineManager(db_session)
    await manager.bulk_insert_klines(
        stock_code=symbol,
        period="daily",
        klines=data
    )
    
    print(f"âœ… {symbol}: ä¿å­˜ {len(data)} æ¡æ—¥çº¿æ•°æ®")
```

### Step 3: æ‰¹é‡å¤„ç†è‡ªé€‰è‚¡

```python
async def backfill_all_watchlist():
    # è·å–è‡ªé€‰è‚¡åˆ—è¡¨
    watchlist = get_all_watchlist_stocks()
    
    total = len(watchlist)
    success = 0
    failed = []
    
    for idx, symbol in enumerate(watchlist, 1):
        try:
            print(f"[{idx}/{total}] å¤„ç† {symbol}...")
            await backfill_historical_data(symbol)
            success += 1
            
        except Exception as e:
            logger.error(f"âŒ {symbol} å¤±è´¥: {e}")
            failed.append(symbol)
        
        # å»¶è¿Ÿé¿å…é™æµ
        await asyncio.sleep(2)
    
    print(f"\nå®Œæˆï¼æˆåŠŸ: {success}, å¤±è´¥: {len(failed)}")
    if failed:
        print(f"å¤±è´¥åˆ—è¡¨: {failed}")
```

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [Yahoo Finance yfinanceæ–‡æ¡£](https://github.com/ranaroussi/yfinance)
- [Alpha Vantage APIæ–‡æ¡£](https://www.alphavantage.co/documentation/)
- [Finnhub APIæ–‡æ¡£](https://finnhub.io/docs/api)
- [Twelve Data APIæ–‡æ¡£](https://twelvedata.com/docs)

---

## âš¡ å¿«é€Ÿç»“è®º

### å¯¹äºå›æµ‹ç³»ç»Ÿï¼Œæœ€ä½³é€‰æ‹©æ˜¯ï¼š

1. **Yahoo Financeï¼ˆæ—¥çº¿ï¼‰** - 15-20å¹´æ•°æ®ï¼Œå®Œå…¨å…è´¹ âœ…
2. **Yahoo Financeï¼ˆ1å°æ—¶çº¿ï¼‰** - 2å¹´æ•°æ® âœ…
3. **Yahoo Financeï¼ˆ15åˆ†é’Ÿçº¿ï¼‰** - 60å¤©æ•°æ® âš ï¸
4. **åˆ†é’Ÿçº¿å›æµ‹** - æ•°æ®å¤ªå°‘ï¼Œä¸å»ºè®® âŒ

### æ¨èé…ç½®ï¼š

```python
# åœ¨ config.py ä¸­
BACKTEST_DATA_SOURCE = "yahoo"  # ä¸»æ•°æ®æº
BACKTEST_INTERVAL = "1d"        # æ¨èæ—¥çº¿
BACKTEST_PERIOD = "max"         # è·å–æœ€é•¿å†å²
RATE_LIMIT_DELAY = 2.0          # 2ç§’å»¶è¿Ÿï¼Œé¿å…é™æµ
```

**å¼€å§‹å›æµ‹å‰ï¼Œå…ˆè¿è¡Œä¸€æ¬¡æ‰¹é‡æ•°æ®è·å–ï¼Œå°†å†å²æ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ï¼Œåç»­å›æµ‹ç›´æ¥ä»æ•°æ®åº“è¯»å–å³å¯ï¼**


# 股票多级分类树系统使用指南

## 🎯 功能概述

智行交易系统的多级分类树功能，让你可以：
- 📁 **多级分类管理**：创建任意深度的股票分类树（如：人工智能 → 算力 → 芯片 → GPU）
- 🔥 **实时热力图**：可视化展示各分类的涨跌幅，快速定位投资机会
- 📊 **加权统计**：支持股票权重设置，计算加权涨跌幅
- 🎨 **美观易用**：现代化UI设计，树形视图和热力图双模式

## 🚀 快速开始

### 1. 访问分类管理页面

在浏览器中打开：
```
http://localhost:3000/categories
```

### 2. 查看示例分类

系统已预置了一些示例分类：
- 🤖 人工智能
  - ⚡ 算力
    - 💾 芯片
    - ☁️ 云计算
  - 🎯 AI应用
    - 🤖 机器人
    - 🚗 自动驾驶
- ⚡ 新能源
  - 🔋 电池
  - ☀️ 光伏
  - ☢️ 核能
    - ⛏️ 铀矿
- 💊 生物医药
  - 💉 创新药
  - 🏥 医疗器械

## 📚 核心功能

### 1. 创建分类

#### 方法一：通过UI创建
1. 点击"添加根分类"按钮创建顶级分类
2. 或者点击某个分类的"+"按钮创建子分类
3. 输入分类名称，按回车确认

#### 方法二：通过API创建
```bash
curl -X POST http://localhost:8000/api/v1/categories/ \
  -H "Content-Type: application/json" \
  -d '{
    "name": "量子计算",
    "parent_id": null,
    "icon": "⚛️",
    "color": "#8B5CF6",
    "description": "量子计算相关股票"
  }'
```

### 2. 添加股票到分类

1. 在左侧树形视图或热力图中选择一个分类
2. 右侧面板显示该分类的股票列表
3. 点击"添加股票到分类"按钮
4. 搜索并选择要添加的股票

#### 通过API添加
```bash
curl -X POST http://localhost:8000/api/v1/categories/{category_id}/stocks \
  -H "Content-Type: application/json" \
  -d '{
    "category_id": "cat_量子计算_xxx",
    "stock_code": "NVDA",
    "weight": 1.5,
    "is_primary": true
  }'
```

### 3. 查看热力图

热力图功能可以帮你快速识别表现好的分类：
- **红色区域**：上涨的分类，颜色越深涨幅越大
- **绿色区域**：下跌的分类，颜色越深跌幅越大
- **灰色区域**：平盘或无数据

#### 热力图指标说明
- **加权涨跌幅**：根据股票权重计算的平均涨跌幅
- **上涨/下跌数量**：该分类下上涨和下跌的股票数量
- **极值范围**：该分类中最大涨幅和最大跌幅

### 4. 视图切换

系统提供两种视图模式：
- **树形视图**：层级清晰，适合浏览和管理分类结构
- **热力图视图**：直观展示涨跌幅，适合快速决策

通过顶部的切换按钮即可在两种视图间切换。

## 🛠️ 高级功能

### 1. 批量导入分类

```bash
curl -X POST http://localhost:8000/api/v1/categories/batch-import \
  -H "Content-Type: application/json" \
  -d '{
    "categories": [
      {
        "name": "科技",
        "icon": "💻",
        "children": [
          {"name": "软件", "icon": "📱"},
          {"name": "硬件", "icon": "🖥️"}
        ]
      }
    ]
  }'
```

### 2. 导出分类数据

点击"导出"按钮，系统会将所有分类数据导出为JSON文件，方便备份和迁移。

### 3. 删除分类

- **普通删除**：只能删除没有子分类的分类
- **强制删除**：删除分类及其所有子分类（谨慎使用）

```bash
# 普通删除
curl -X DELETE http://localhost:8000/api/v1/categories/{category_id}

# 强制删除（包括子分类）
curl -X DELETE "http://localhost:8000/api/v1/categories/{category_id}?force=true"
```

### 4. 设置股票权重

权重用于计算加权涨跌幅，权重越高，该股票对分类整体涨跌幅的影响越大。

```bash
curl -X POST http://localhost:8000/api/v1/categories/{category_id}/stocks \
  -H "Content-Type: application/json" \
  -d '{
    "category_id": "cat_xxx",
    "stock_code": "AAPL",
    "weight": 2.0,  # 权重为2，是默认权重的2倍
    "is_primary": true
  }'
```

## 📖 API文档

### 分类管理API

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/v1/categories/` | GET | 获取分类列表（支持树形/扁平） |
| `/api/v1/categories/` | POST | 创建新分类 |
| `/api/v1/categories/{id}` | GET | 获取分类详情 |
| `/api/v1/categories/{id}` | PUT | 更新分类 |
| `/api/v1/categories/{id}` | DELETE | 删除分类 |
| `/api/v1/categories/{id}/stocks` | GET | 获取分类下的股票 |
| `/api/v1/categories/{id}/stocks` | POST | 添加股票到分类 |
| `/api/v1/categories/{id}/stocks/{code}` | DELETE | 从分类移除股票 |
| `/api/v1/categories/heatmap/data` | GET | 获取热力图数据 |
| `/api/v1/categories/batch-import` | POST | 批量导入分类 |

### 完整API文档

访问 Swagger UI 查看完整的API文档：
```
http://localhost:8000/docs
```

## 💡 使用技巧

### 1. 分类结构设计建议

**按行业分类**（推荐）
```
科技
├── 人工智能
│   ├── 算力（GPU、芯片）
│   └── 应用（机器人、自动驾驶）
├── 新能源
│   ├── 电池
│   └── 光伏
└── 生物医药
```

**按投资策略分类**
```
成长股
├── 高成长（年增长>50%）
└── 稳健成长（年增长20-50%）
价值股
├── 低估值（PE<15）
└── 高股息（股息率>4%）
```

**按市值分类**
```
大盘股（市值>1000亿）
中盘股（市值100-1000亿）
小盘股（市值<100亿）
```

### 2. 热力图使用技巧

1. **快速找机会**：红色越深的分类，表示该板块正在上涨，可以考虑买入
2. **风险规避**：绿色越深的分类，表示该板块正在下跌，注意风险
3. **板块轮动**：关注不同时期表现好的分类，把握板块轮动机会

### 3. 权重设置策略

- **龙头股**：权重设为 2-3，龙头股的表现更能代表板块走势
- **普通股**：权重保持 1，标准权重
- **关注度低的股**：权重设为 0.5，降低影响

### 4. 实战场景

**场景1：追踪热点板块**
1. 创建"热点跟踪"分类
2. 每天将涨幅前10的股票加入
3. 观察热力图，发现持续上涨的板块

**场景2：价值投资组合**
1. 创建"价值股"分类
2. 子分类按行业划分
3. 只添加PE<15且ROE>15%的股票
4. 热力图帮你发现被低估的行业

**场景3：风险分散**
1. 按行业创建分类树
2. 确保每个一级分类下都有持仓
3. 热力图显示各板块分布
4. 避免过度集中在单一板块

## 🎨 界面预览

### 树形视图
- 层级清晰的分类结构
- 实时显示涨跌幅
- 一键添加/删除分类
- 拖拽移动分类（开发中）

### 热力图视图
- 直观的颜色映射
- 可调整区块大小
- 涨跌榜TOP 5
- 一键切换排序

## 🔧 故障排查

### 1. 热力图无数据显示

**原因**：分类下没有添加股票，或股票没有价格数据

**解决方法**：
1. 确认分类下已添加股票
2. 确认股票已同步K线数据
3. 在"数据同步"页面执行数据同步

### 2. 无法创建分类

**原因**：数据库连接问题

**解决方法**：
1. 检查后端服务是否运行
2. 查看后端日志：`tail -f backend.dev.log`
3. 确认MySQL数据库已启动

### 3. 分类树不显示

**原因**：前端API调用失败

**解决方法**：
1. 打开浏览器开发者工具（F12）
2. 查看Console和Network标签
3. 确认API返回正常

## 📞 技术支持

如有问题，请查看：
- 项目文档：`/docs/`
- API文档：`http://localhost:8000/docs`
- 测试指南：`TESTING_GUIDE.md`

## 🎉 下一步

现在你已经了解了分类树系统的基本用法，可以：
1. 根据自己的投资风格创建分类结构
2. 导入你的股票池
3. 使用热力图每天跟踪板块走势
4. 结合选股策略，打造完整的交易系统

祝你投资顺利！ 🚀📈


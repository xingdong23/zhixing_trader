# IB V11 Option Sniper (自动期权猎手) 设计文档

## 1. 核心目标
将 **V11 动量赌徒策略** 移植到美股市场，通过 **Interactive Brokers (IBKR)** 接口，全自动交易 **美股期权 (Options)**。
解决 "美股在深夜，无法盯盘" 的痛点。

## 2. 技术架构
*   **语言**: Python 3.10+
*   **核心库**: `ib_insync` (最优雅的 IB Python 封装，支持异步)
*   **数据源**: IB 自带数据 (需订阅实时数据) 或 Yahoo Finance (仅做信号计算)
*   **策略引擎**: 复用现有的 V11 逻辑 (Pandas处理)
*   **运行环境**: 本地服务器 / 云服务器 (需安装 IB Gateway 或 TWS)

## 3. 核心流程

### Step 1: 信号扫描 (Scanner)
*   **标的池**: TSLA, NVDA, AMD, COIN, MSTR, GME (高波动率妖股)
*   **周期**: 日线 (Daily) - 每天收盘前 30分钟 (美东时间 15:30) 运行一次。
*   **逻辑**:
    1.  获取 OHLCV 数据。
    2.  计算 V11 指标 (Squeeze, Breakout, ADX)。
    3.  若 `Signal == Long`，进入下一步。

### Step 2: 智能选权 (Option Selector)
这是最关键的一步。也就是 "三颗子弹" 到底买哪一张合约？
*   **到期日 (Expiration)**: 选择 **剩余 30-45 天** 的月度期权 (流动性好，时间衰减适中)。
*   **行权价 (Strike)**: 选择 **OTM (虚值) 5% - 10%**。
    *   *逻辑*: 如果是疯牛行情，OTM 会迅速变成 ITM，杠杆率最高。
    *   *示例*: TSLA 当前价 200，买入 Strike 210 的 Call。
*   **过滤**: 确保 `Open Interest > 1000` (流动性过滤)。

### Step 3: 资金管理与下单 (Execution)
*   **一颗子弹**: 固定金额，例如每次买入 **$500** 权利金。
    *   如果一张 Option $5.0 (即 $500)，买 1 张。
    *   如果一张 Option $1.0 (即 $100)，买 5 张。
*   **下单类型**: `LMT` (限价单)，价格设为 `Ask` 或 `Midpoint`，确保成交。

### Step 4: 自动止盈 (Exit)
*   由于期权数据复杂，建议**以标的资产价格**为锚点出场。
*   **逻辑**: 当 TSLA 正股触发 V11 卖出信号 (Trailing Stop) 时，**市价平仓** 对应的期权。
*   **归零逻辑**: 如果期权归零 (标的正股下跌)，无需操作，自动过期 (损失 $500)。

## 4. 可行性验证
*   **IB API**: 支持自动检索期权链 (Option Chain) 和下单。
*   **无人值守**: 脚本部署在云服务器，每天定时任务运行。IB Gateway 需要每日重新登录 (由于安全限制)，可以使用 `IBC` 工具实现自动登录保活。

## 5. 开发路线图
1.  **环境搭建**: 安装 IB Gateway 和 `ib_insync`。
2.  **数据流打通**: 从 IB 获取 TSLA 实时 K 线。
3.  **期权链筛选**: 编写函数 `find_best_option(symbol, expiry_days=30, strike_offset=0.05)`。
4.  **实盘对接**: 集成 V11 信号下单。

## 结论
**完全可行**。这是量化交易皇冠上的明珠。一旦建成，您就是拥有了一个不知疲倦的、只在深夜工作的 "华尔街交易员"。

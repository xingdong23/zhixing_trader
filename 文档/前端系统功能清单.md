# çŸ¥è¡Œäº¤æ˜“ç³»ç»Ÿ - å‰ç«¯åŠŸèƒ½å®Œæ•´æ¸…å•

> **ç”Ÿæˆæ—¶é—´**: 2025-12-12  
> **ç³»ç»Ÿåç§°**: çŸ¥è¡Œäº¤æ˜“è€… (ZhiXing Trader)  
> **æŠ€æœ¯æ ˆ**: Next.js 15 + React 19 + TypeScript + Tailwind CSS + shadcn/ui  
> **æ•°æ®åº“**: Dexie.js (IndexedDB) + localStorage  
> **å›¾è¡¨**: Recharts + Lightweight Charts

---

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

çŸ¥è¡Œäº¤æ˜“ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„è‚¡ç¥¨äº¤æ˜“ç®¡ç†å¹³å°,æ¶µç›–ä»è‚¡ç¥¨é€‰æ‹©ã€äº¤æ˜“è®¡åˆ’ã€æ‰§è¡Œç›‘æ§ã€å¤ç›˜åˆ†æåˆ°å¿ƒç†ç®¡ç†çš„å…¨æµç¨‹ã€‚ç³»ç»Ÿé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„,å‰ç«¯ä½¿ç”¨Next.js 15æ„å»º,æ”¯æŒå“åº”å¼è®¾è®¡,ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯å‡å¯æµç•…ä½¿ç”¨ã€‚

**æ ¸å¿ƒç‰¹è‰²**:
- âœ… 6æ­¥äº¤æ˜“ä½“ç³»ç³»ç»ŸåŒ–å¼•å¯¼
- âœ… å®Œæ•´çš„äº¤æ˜“ç”Ÿå‘½å‘¨æœŸç®¡ç†
- âœ… å¤šç»´åº¦æ•°æ®åˆ†æå’Œå¤ç›˜
- âœ… äº¤æ˜“å¿ƒç†å’Œçºªå¾‹ç®¡ç†
- âœ… æ™ºèƒ½é£é™©æ§åˆ¶å’Œæé†’
- âœ… æœ¬åœ°æ•°æ®æŒä¹…åŒ–å’Œå®æ—¶åŒæ­¥

---

## ğŸ—‚ï¸ ç›®å½•ç»“æ„

```
zhixing_frontend/
â”œâ”€â”€ app/                          # Next.jsé¡µé¢è·¯ç”±
â”‚   â”œâ”€â”€ page.tsx                 # ä¸»é¡µï¼ˆé›†æˆæ‰€æœ‰åŠŸèƒ½ï¼‰
â”‚   â”œâ”€â”€ plan/                    # äº¤æ˜“è®¡åˆ’ç›¸å…³é¡µé¢
â”‚   â”‚   â”œâ”€â”€ create/             # åˆ›å»ºè®¡åˆ’å‘å¯¼
â”‚   â”‚   â””â”€â”€ [id]/               # è®¡åˆ’è¯¦æƒ…
â”‚   â”œâ”€â”€ trade/[id]/             # äº¤æ˜“è¯¦æƒ…é¡µ
â”‚   â”œâ”€â”€ stock/[symbol]/         # è‚¡ç¥¨è¯¦æƒ…é¡µ
â”‚   â”œâ”€â”€ trades/                 # äº¤æ˜“ç®¡ç†ï¼ˆç‹¬ç«‹é¡µé¢ï¼Œå·²åºŸå¼ƒï¼‰
â”‚   â”œâ”€â”€ notes/                  # ç¬”è®°ç®¡ç†
â”‚   â””â”€â”€ wisdom/                 # æ™ºæ…§åº“
â”œâ”€â”€ components/                   # Reactç»„ä»¶
â”‚   â”œâ”€â”€ ui/                     # shadcn/uiåŸºç¡€ç»„ä»¶
â”‚   â”œâ”€â”€ stocks/                 # è‚¡ç¥¨ç›¸å…³ç»„ä»¶
â”‚   â”œâ”€â”€ trades/                 # äº¤æ˜“ç›¸å…³ç»„ä»¶
â”‚   â”œâ”€â”€ notes/                  # ç¬”è®°ç»„ä»¶
â”‚   â”œâ”€â”€ categories/             # åˆ†ç±»ç»„ä»¶
â”‚   â”œâ”€â”€ review/                 # å¤ç›˜ç»„ä»¶
â”‚   â”œâ”€â”€ strategies/             # ç­–ç•¥ç»„ä»¶
â”‚   â”œâ”€â”€ psychology/             # å¿ƒç†åˆ†æç»„ä»¶
â”‚   â”œâ”€â”€ wisdom/                 # æ™ºæ…§åº“ç»„ä»¶
â”‚   â”œâ”€â”€ checklist/              # æ£€æŸ¥æ¸…å•ç»„ä»¶
â”‚   â”œâ”€â”€ errors/                 # é”™è¯¯åˆ†æç»„ä»¶
â”‚   â”œâ”€â”€ pivot/                  # æ•°æ®é€è§†è¡¨ç»„ä»¶
â”‚   â”œâ”€â”€ tradePlan/              # äº¤æ˜“è®¡åˆ’ç»„ä»¶
â”‚   â”œâ”€â”€ trading/                # äº¤æ˜“å·¥å…·ç»„ä»¶
â”‚   â”œâ”€â”€ market/                 # å¸‚åœºåˆ†æç»„ä»¶
â”‚   â””â”€â”€ brokers/                # åˆ¸å•†è®¾ç½®ç»„ä»¶
â”œâ”€â”€ lib/                          # å·¥å…·åº“
â”‚   â”œâ”€â”€ db.ts                   # Dexieæ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ tradePlan.ts            # äº¤æ˜“è®¡åˆ’é€»è¾‘
â”‚   â”œâ”€â”€ metrics.ts              # æ€§èƒ½æŒ‡æ ‡è®¡ç®—
â”‚   â”œâ”€â”€ violations.ts           # è¿è§„æ£€æµ‹
â”‚   â””â”€â”€ utils.ts                # é€šç”¨å·¥å…·å‡½æ•°
â””â”€â”€ types/                        # TypeScriptç±»å‹å®šä¹‰
    â”œâ”€â”€ tradingWisdom.ts        # æ™ºæ…§åº“ç±»å‹
    â””â”€â”€ index.ts                # é€šç”¨ç±»å‹
```

---

## 1. æ ¸å¿ƒæ¨¡å—

### 1.1 ä¸»å¯¼èˆªç³»ç»Ÿ (`app/page.tsx`)

#### 1.1.1 å¸ƒå±€ç»“æ„
- **å“åº”å¼è®¾è®¡**
  - æ¡Œé¢ç«¯ï¼šå›ºå®šä¾§è¾¹æ  + ä¸»å†…å®¹åŒº
  - ç§»åŠ¨ç«¯ï¼šæ±‰å ¡èœå• + å…¨å±å†…å®¹
  - å¹³æ¿ï¼šè‡ªé€‚åº”å¸ƒå±€

- **ä¾§è¾¹æ å¯¼èˆª**
  - 10ä¸ªä¸»è¦åŠŸèƒ½å…¥å£
  - å›¾æ ‡ + æ–‡å­—æ ‡ç­¾
  - å½“å‰é¡µé¢é«˜äº®
  - å¹³æ»‘è¿‡æ¸¡åŠ¨ç”»

- **ç§»åŠ¨ç«¯æ±‰å ¡èœå•**
  - Menuå›¾æ ‡è§¦å‘
  - ä¾§è¾¹æ æ»‘åŠ¨æ˜¾ç¤º
  - ç‚¹å‡»èœå•é¡¹è‡ªåŠ¨å…³é—­
  - é®ç½©å±‚èƒŒæ™¯

#### 1.1.2 è·¯ç”±ç®¡ç†
- **Hashè·¯ç”±**
  - ä½¿ç”¨URL Hash (#)
  - æ”¯æŒå¤–éƒ¨è·³è½¬ï¼ˆå¦‚ä»äº¤æ˜“è¯¦æƒ…è¿”å›ï¼‰
  - åˆæ¬¡åŠ è½½æ—¶å°Šé‡ç°æœ‰Hash
  - è·¯ç”±å˜åŒ–æ—¶åŒæ­¥Hash

- **æœ‰æ•ˆè·¯ç”±åˆ—è¡¨**
  ```
  #dashboard   - è‚¡ç¥¨
  #categories  - åˆ†ç±»
  #trades      - äº¤æ˜“
  #notes       - ç¬”è®°
  #review      - å¤ç›˜
  #strategies  - ç­–ç•¥
  #psychology  - å¿ƒç†
  #health      - ä½“æ£€ä¸­å¿ƒ
  #wisdom      - æ™ºæ…§åº“
  #brokers     - åˆ¸å•†
  ```

#### 1.1.3 ä¸»è¦åŠŸèƒ½æ¨¡å—å…¥å£

**10ä¸ªå¯¼èˆªèœå•é¡¹**:
1. **è‚¡ç¥¨** (dashboard)
   - å›¾æ ‡: Heart â¤ï¸
   - ç»„ä»¶: StockList
   
2. **åˆ†ç±»** (categories)
   - å›¾æ ‡: Folder ğŸ“
   - ç»„ä»¶: CategoriesView
   
3. **äº¤æ˜“** (trades)
   - å›¾æ ‡: DollarSign ğŸ’²
   - ç»„ä»¶: TradesView
   
4. **ç¬”è®°** (notes)
   - å›¾æ ‡: PenTool âœï¸
   - ç»„ä»¶: NotesView
   
5. **å¤ç›˜** (review)
   - å›¾æ ‡: BookOpen ğŸ“–
   - ç»„ä»¶: ReviewView
   
6. **ç­–ç•¥** (strategies)
   - å›¾æ ‡: Target ğŸ¯
   - ç»„ä»¶: StrategiesView
   
7. **å¿ƒç†** (psychology)
   - å›¾æ ‡: Brain ğŸ§ 
   - ç»„ä»¶: PsychologyView
   
8. **ä½“æ£€ä¸­å¿ƒ** (health)
   - å›¾æ ‡: Shield ğŸ›¡ï¸
   - ç»„ä»¶: TradingHealthCenter
   
9. **æ™ºæ…§åº“** (wisdom)
   - å›¾æ ‡: Lightbulb ğŸ’¡
   - ç»„ä»¶: WisdomLibrary
   
10. **åˆ¸å•†** (brokers)
    - å›¾æ ‡: Settings âš™ï¸
    - ç»„ä»¶: BrokersView

#### 1.1.4 é¡µé¢å¤´éƒ¨
- **æ ‡é¢˜æ˜¾ç¤º**
  - æ ¹æ®å½“å‰é¡µé¢åŠ¨æ€æ˜¾ç¤º
  - å¤§å·å­—ä½“ã€åŠ ç²—
  
- **å¿«é€Ÿæ“ä½œåŒº**
  - æœç´¢æ¡†ï¼ˆéƒ¨åˆ†é¡µé¢ï¼‰
  - é€šçŸ¥é“ƒé“›
  - å¿«æ·æŒ‰é’®

---

## 2. è‚¡ç¥¨ç®¡ç†æ¨¡å—

### 2.1 è‚¡ç¥¨åˆ—è¡¨ (`StockList.tsx`)

#### 2.1.1 æ•°æ®å±•ç¤º
**è¡¨æ ¼åˆ—**:
- ä»£ç /åç§°
  - è‚¡ç¥¨ä»£ç ï¼ˆç²—ä½“ï¼‰
  - ä¸­æ–‡åç§°ï¼ˆç°è‰²å°å­—ï¼‰
  
- ç°ä»·
  - å®æ—¶ä»·æ ¼
  - æ•°å­—æ ¼å¼åŒ–
  
- æ¶¨è·Œå¹…
  - ç™¾åˆ†æ¯”æ˜¾ç¤º
  - ç»¿è‰²ï¼ˆä¸Šæ¶¨ï¼‰/çº¢è‰²ï¼ˆä¸‹è·Œï¼‰
  - å¸¦+/-ç¬¦å·
  
- å¸‚åœº
  - å¸‚åœºä»£ç ï¼ˆå¦‚USã€HKï¼‰
  
- æ¦‚å¿µæ ‡ç­¾
  - æœ€å¤šæ˜¾ç¤º3ä¸ªå¾½ç« 
  - è¶…å‡ºæ˜¾ç¤º+N
  - ç°è‰²secondaryæ ·å¼
  
- æ›´æ–°æ—¶é—´
  - æœ¬åœ°æ—¶é—´æ ¼å¼
  - ç°è‰²å°å­—

#### 2.1.2 æ¦‚å¿µç­›é€‰åŠŸèƒ½

**ä¸‰ç§æ¦‚å¿µç±»å‹**:
- **industry** (è¡Œä¸š)
  - ä¼ ç»Ÿè¡Œä¸šåˆ†ç±»
  - å¦‚ï¼šç§‘æŠ€ã€èƒ½æºã€é‡‘è
  
- **fundamentals** (åŸºæœ¬é¢)
  - åŸºæœ¬é¢ç‰¹å¾
  - å¦‚ï¼šé«˜å¢é•¿ã€ä½ä¼°å€¼
  
- **custom** (è‡ªå®šä¹‰)
  - ç”¨æˆ·è‡ªå®šä¹‰æ ‡ç­¾

**ç­›é€‰äº¤äº’**:
- æ¦‚å¿µæ ‡ç­¾æ¨ªå‘æ’åˆ—
- ç‚¹å‡»æ ‡ç­¾ç­›é€‰è¯¥æ¦‚å¿µè‚¡ç¥¨
- é€‰ä¸­æ ‡ç­¾é«˜äº®æ˜¾ç¤ºï¼ˆdefaultæ ·å¼ï¼‰
- æœªé€‰ä¸­æ ‡ç­¾outlineæ ·å¼
- "é‡ç½®ç­›é€‰"æŒ‰é’®æ¸…é™¤é€‰æ‹©
- æ˜¾ç¤ºå½“å‰ç­›é€‰çš„æ¦‚å¿µåç§°

#### 2.1.3 åˆ†é¡µæ§åˆ¶
- **æ¯é¡µ20æ¡**
- **åˆ†é¡µä¿¡æ¯**
  - å…±Xæ¡ Â· æ¯é¡µYæ¡
  - ç¬¬M/Né¡µ
  
- **åˆ†é¡µæŒ‰é’®**
  - ä¸Šä¸€é¡µï¼ˆç¬¬1é¡µæ—¶ç¦ç”¨ï¼‰
  - ä¸‹ä¸€é¡µï¼ˆæœ€åä¸€é¡µæ—¶ç¦ç”¨ï¼‰
  - æŒ‰é’®outlineæ ·å¼ã€små°ºå¯¸

#### 2.1.4 æ•°æ®è·å–
- **APIè°ƒç”¨**
  ```
  GET /api/v1/stocks/overview
  ?page={page}
  &page_size={pageSize}
  &concept_name={conceptName}
  ```
  
- **çŠ¶æ€ç®¡ç†**
  - loadingçŠ¶æ€ï¼ˆæ˜¾ç¤º"åŠ è½½ä¸­..."ï¼‰
  - stocksæ•°ç»„
  - totalæ€»æ•°
  - pageå½“å‰é¡µ
  
- **æ¦‚å¿µåˆ†ç±»API**
  ```
  GET /api/v1/concepts/categories
  ```
  è¿”å›: `{ categories: { industry: [], fundamentals: [], custom: [] } }`

#### 2.1.5 é”™è¯¯å¤„ç†
- **APIå¤±è´¥**
  - console.errorè®°å½•
  - ä¸é˜»å¡ç•Œé¢
  - æ˜¾ç¤ºæš‚æ— æ•°æ®
  
- **æ¦‚å¿µè·å–å¤±è´¥**
  - å›é€€åˆ°é»˜è®¤åˆ†ç±»
  - `{ industry: ["å…¶ä»–"], ... }`

---

### 2.2 Kçº¿å›¾è¡¨ (`KLineChart.tsx`)

#### 2.2.1 å›¾è¡¨åº“é›†æˆ
- **Lightweight Charts**
  - è½»é‡çº§é«˜æ€§èƒ½
  - æ”¯æŒå¤§æ•°æ®é‡
  - æµç•…äº¤äº’
  
#### 2.2.2 å›¾è¡¨ç±»å‹
- **Kçº¿å›¾**
  - å¼€ç›˜ä»·ã€æ”¶ç›˜ä»·ã€æœ€é«˜ä»·ã€æœ€ä½ä»·
  - ç»¿æ¶¨çº¢è·Œï¼ˆä¸­å›½ä¹ æƒ¯ï¼‰
  
- **æˆäº¤é‡æŸ±çŠ¶å›¾**
  - åº•éƒ¨å åŠ 
  - é¢œè‰²ä¸Kçº¿å¯¹åº”
  
- **æŠ€æœ¯æŒ‡æ ‡**
  - MAå‡çº¿ï¼ˆ5æ—¥ã€10æ—¥ã€20æ—¥ï¼‰
  - MACD
  - RSI

#### 2.2.3 æ—¶é—´å‘¨æœŸ
- æ—¥çº¿ï¼ˆ1Dï¼‰
- å‘¨çº¿ï¼ˆ1Wï¼‰
- æœˆçº¿ï¼ˆ1Mï¼‰
- 5åˆ†é’Ÿï¼ˆ5minï¼‰
- 15åˆ†é’Ÿï¼ˆ15minï¼‰

#### 2.2.4 äº¤äº’åŠŸèƒ½
- **ç¼©æ”¾**
  - æ»šè½®ç¼©æ”¾
  - åŒå‡»é‡ç½®
  
- **åå­—å…‰æ ‡**
  - æ˜¾ç¤ºä»·æ ¼å’Œæ—¶é—´
  - ç²¾ç¡®æ•°å€¼
  
- **æ‚¬åœæç¤º**
  - OHLCæ•°æ®
  - æˆäº¤é‡

---

### 2.3 è‚¡ç¥¨è¯¦æƒ…é¡µ (`app/stock/[symbol]/`)

#### 2.3.1 é¡µé¢ç»“æ„
- **é¡¶éƒ¨ä¿¡æ¯**
  - è‚¡ç¥¨ä»£ç å’Œåç§°
  - å½“å‰ä»·æ ¼ï¼ˆå¤§å­—ï¼‰
  - æ¶¨è·Œå¹…ï¼ˆé¢œè‰²æ ‡è¯†ï¼‰
  - å®æ—¶åˆ·æ–°æŒ‰é’®
  
- **Tabåˆ‡æ¢**
  - Kçº¿å›¾
  - åŸºæœ¬ä¿¡æ¯
  - æŠ•èµ„ç¬”è®°
  - ä»·æ ¼æé†’

#### 2.3.2 ä»·æ ¼æé†’å›¾è¡¨ (`PriceAlertChart.tsx`)

**åŠŸèƒ½**:
- åœ¨Kçº¿å›¾ä¸Šå åŠ ä¸“å®¶è§‚ç‚¹çš„å…³é”®ä»·ä½
- ä¸åŒä¸“å®¶ç”¨ä¸åŒé¢œè‰²åŒºåˆ†
- æ­¢æŸ/æ­¢ç›ˆ/åŠ ä»“ç­‰ä½ç½®æ ‡æ³¨

**å¯è§†åŒ–å…ƒç´ **:
- æ°´å¹³çº¿ï¼šå…³é”®ä»·ä½
- æ ‡ç­¾ï¼šä¸“å®¶åç§° + ä»·ä½ç±»å‹
- é¢œè‰²ï¼šä¸“å®¶åŒºåˆ†
- é€æ˜åº¦ï¼šå†å²è§‚ç‚¹æ·¡åŒ–

#### 2.3.3 ä¸“å®¶è§‚ç‚¹ (`ExpertOpinion.tsx`)

**è§‚ç‚¹å¡ç‰‡**:
- ä¸“å®¶å¤´åƒ/åç§°
- å‘å¸ƒæ—¶é—´
- è§‚ç‚¹ç±»å‹ï¼ˆçœ‹å¤š/çœ‹ç©º/ä¸­æ€§ï¼‰
- å…³é”®ä»·ä½
  - æ­¢æŸä»·
  - ç›®æ ‡ä»·1/2/3
  - åŠ ä»“ä»·
- è§‚ç‚¹ç†ç”±
- ç‚¹èµæ•°

**ç­›é€‰**:
- æŒ‰ä¸“å®¶ç­›é€‰
- æŒ‰æ—¶é—´æ’åº
- æŒ‰è§‚ç‚¹ç±»å‹ç­›é€‰

#### 2.3.4 å…±è¯†çƒ­åŠ›å›¾ (`ConsensusHeatmap.tsx`)

**çƒ­åŠ›å›¾åŠŸèƒ½**:
- æ¨ªè½´ï¼šä»·æ ¼åŒºé—´
- çºµè½´ï¼šä¸“å®¶æ•°é‡
- é¢œè‰²ï¼šå…±è¯†åº¦ï¼ˆè¶Šçº¢è¶Šçƒ­ï¼‰
- æ ‡æ³¨ï¼šå…³é”®ä»·ä½

**è¯†åˆ«åŠŸèƒ½**:
- æ”¯æ’‘ä½ï¼šå¤šä¸“å®¶çœ‹å¤šçš„ä»·æ ¼
- é˜»åŠ›ä½ï¼šå¤šä¸“å®¶çœ‹ç©ºçš„ä»·æ ¼
- åˆ†æ­§åŒºåŸŸï¼šè§‚ç‚¹åˆ†æ•£çš„ä»·æ ¼

#### 2.3.5 æŠ•èµ„ç¬”è®°æ—¶é—´çº¿ (`TimelineNotes.tsx`)

**æ—¶é—´çº¿å±•ç¤º**:
- å‚ç›´æ—¶é—´è½´
- ç¬”è®°å¡ç‰‡
  - ç¬”è®°ç±»å‹å›¾æ ‡
  - æ ‡é¢˜
  - å†…å®¹é¢„è§ˆ
  - åˆ›å»ºæ—¶é—´
  - å…³è”ä»·æ ¼ï¼ˆå¯é€‰ï¼‰

**ç¬”è®°ç±»å‹**:
- ğŸ“ è§‚å¯Ÿ (observation)
- ğŸ’° ä¹°å…¥ (buy)
- ğŸ’¸ å–å‡º (sell)
- ğŸ”„ æŒæœ‰ (hold)
- â›” æ­¢æŸ (stop_loss)

**æ·»åŠ ç¬”è®°** (`AddTimelineNoteDialog.tsx`):
- é€‰æ‹©ç¬”è®°ç±»å‹
- è¾“å…¥æ ‡é¢˜å’Œå†…å®¹
- å¯é€‰å…³è”å½“å‰ä»·æ ¼
- ä¿å­˜åˆ°æ•°æ®åº“

---

### 2.4 TradingViewé›†æˆ (`TradingViewWidget.tsx`)

#### 2.4.1 TradingViewåµŒå…¥
- **Widgeté…ç½®**
  - è‚¡ç¥¨ä»£ç 
  - äº¤æ˜“æ‰€
  - æ—¶é—´å‘¨æœŸ
  - ä¸»é¢˜ï¼ˆæ·±è‰²/æµ…è‰²ï¼‰
  
- **åŠŸèƒ½ç‰¹æ€§**
  - ä¸“ä¸šçº§Kçº¿å›¾
  - ä¸°å¯Œçš„æŠ€æœ¯æŒ‡æ ‡
  - ç»˜å›¾å·¥å…·
  - å¤šæ—¶é—´å‘¨æœŸ
  
- **è‡ªé€‚åº”**
  - å“åº”å®¹å™¨å¤§å°
  - è·Ÿéšç³»ç»Ÿä¸»é¢˜

---

## 3. äº¤æ˜“ç®¡ç†æ¨¡å—

### 3.1 äº¤æ˜“è§†å›¾ (`TradesView.tsx`)

è¿™æ˜¯ç³»ç»Ÿæœ€æ ¸å¿ƒã€åŠŸèƒ½æœ€ä¸°å¯Œçš„æ¨¡å—,å®Œæ•´ç®¡ç†äº¤æ˜“çš„å…¨ç”Ÿå‘½å‘¨æœŸã€‚

#### 3.1.1 æ•°æ®æŒä¹…åŒ–æ¶æ„

**Dexie.js + IndexedDB**:
```typescript
// lib/db.ts
export const db = new Dexie('ZhixingTrader');
db.version(1).stores({
  trades: '++id, symbol, status, createdAt',
  settings: 'key'
});
```

**å®æ—¶æŸ¥è¯¢**:
```typescript
const rawTrades = useLiveQuery(
  () => db.trades.orderBy('createdAt').reverse().toArray()
) || [];
```

**æ•°æ®è¿ç§»**:
- è‡ªåŠ¨ä»localStorageè¿ç§»å†å²æ•°æ®
- ä»…æ‰§è¡Œä¸€æ¬¡
- è¿ç§»åè®¾ç½®æ ‡è®°

#### 3.1.2 æ ¸å¿ƒç»Ÿè®¡å¡ç‰‡

**å››ä¸ªç»Ÿè®¡å¡ç‰‡**:
1. **æ€»äº¤æ˜“æ•°**
   - å›¾æ ‡: Target ğŸ¯
   - é¢œè‰²: è“è‰²
   - æ•°æ®: mockStatistics.totalTrades
   
2. **æŒä»“ä¸­**
   - å›¾æ ‡: TrendingUp ğŸ“ˆ
   - é¢œè‰²: ç»¿è‰²
   - æ•°æ®: mockStatistics.activeTrades
   
3. **èƒœç‡**
   - å›¾æ ‡: Target ğŸ¯
   - é¢œè‰²: ç´«è‰²
   - æ•°æ®: mockStatistics.winRate (ç™¾åˆ†æ¯”)
   
4. **æ€»ç›ˆäº**
   - å›¾æ ‡: DollarSign ğŸ’²
   - é¢œè‰²: é»„è‰²
   - æ•°æ®: mockStatistics.totalPnl (ç»¿è‰²/çº¢è‰²)

**æ•°æ®æ¥æº**:
- Mockæ•°æ®ï¼š`app/trades/mockData.ts`
- å®é™…åº”è®¡ç®—è‡ªtradesæ•°ç»„

#### 3.1.3 6æ­¥äº¤æ˜“ä½“ç³»å¼•å¯¼å¡ç‰‡

**é«˜äº®å¡ç‰‡ç‰¹å¾**:
- æ¸å˜èƒŒæ™¯ï¼šfrom-blue-50 to-purple-50
- 2pxè“è‰²è¾¹æ¡†
- Targetå›¾æ ‡
- ä½“ç³»è¯´æ˜ï¼šåˆ†è¾¨è¶‹åŠ¿ â†’ æ‰¾å…³é”®ä½ â†’ å…¥åœºæ—¶æœº â†’ åˆ¶å®šè®¡åˆ’ â†’ ä¸¥æ ¼æ‰§è¡Œ â†’ å¤ç›˜æ€»ç»“

**CTAæŒ‰é’®**:
```jsx
<Button onClick={() => router.push('/plan/create')}>
  <Plus /> å¼€å§‹6æ­¥å‘å¯¼åˆ›å»º
</Button>
```
- æ¸å˜èƒŒæ™¯ï¼šfrom-blue-500 to-purple-500
- è·³è½¬åˆ°`/plan/create`é¡µé¢
- å“åº”å¼ï¼šç§»åŠ¨ç«¯å…¨å®½

#### 3.1.4 äº¤æ˜“çºªå¾‹æé†’

**ç»„ä»¶**: `TradingDisciplineReminder`

**é…ç½®**:
- variant="card" - å¡ç‰‡å¼å±•ç¤º
- dismissible=false - ä¸å¯å…³é—­
- autoRotate=true - è‡ªåŠ¨è½®æ’­
- rotateInterval=12 - 12ç§’é—´éš”

**å†…å®¹æ¥æº**:
- ä»æ™ºæ…§åº“è·å–ï¼ˆdisciplineç±»åˆ«ï¼‰
- ä»…æ˜¾ç¤ºæ¿€æ´»çš„æ™ºæ…§
- æŒ‰é‡è¦ç¨‹åº¦æ’åº

**æ ·å¼**:
- è“è‰²æ¸å˜èƒŒæ™¯
- å¤§å·æ–‡å­—
- æ˜Ÿçº§æ˜¾ç¤º

#### 3.1.5 é«˜çº§ç»Ÿè®¡å›¾è¡¨åŒºåŸŸ

**å¸ƒå±€**: 2:1ç½‘æ ¼
- å·¦ä¾§ï¼ˆ2åˆ—ï¼‰ï¼šç›ˆäºæ›²çº¿
- å³ä¾§ï¼ˆ1åˆ—ï¼‰ï¼šé£é™©æŒ‡æ ‡

**ç›ˆäºæ›²çº¿å¡ç‰‡** (`PnlChartCard.tsx`):
- **ç²’åº¦åˆ‡æ¢**
  - æ—¥ (day)
  - å‘¨ (week)
  - æœˆ (month)
  
- **æ›²çº¿è®¡ç®—** (`lib/metrics.ts`):
  ```typescript
  export function computeEquityCurve(
    trades: Trade[],
    initialBalance: number,
    granularity: 'day' | 'week' | 'month'
  ): Array<{ date: string; equity: number }> {
    // æŒ‰æ—¶é—´èšåˆï¼Œè®¡ç®—ç´¯è®¡æƒç›Š
  }
  ```
  
- **å›¾è¡¨**:
  - RechartsæŠ˜çº¿å›¾
  - ç»¿è‰²å¡«å……
  - æ—¶é—´è½´
  - æƒç›Šå€¼

**é£é™©æŒ‡æ ‡å¡ç‰‡** (`RiskWidget.tsx`):
- **å¤æ™®æ¯”ç‡**
  ```typescript
  export function computeSharpeRatio(
    trades: Trade[],
    riskFreeRate: number = 0.02
  ): number {
    const returns = trades.map(t => t.netPnl || 0);
    const avgReturn = mean(returns);
    const stdDev = standardDeviation(returns);
    return (avgReturn - riskFreeRate) / stdDev;
  }
  ```
  - æ•°å€¼æ˜¾ç¤º
  - è¯„çº§ï¼ˆä¼˜ç§€/è‰¯å¥½/ä¸€èˆ¬ï¼‰
  
- **æœ€å¤§å›æ’¤**
  ```typescript
  export function computeMaxDrawdown(
    equityCurve: Array<{ equity: number }>
  ): number {
    let maxDrawdown = 0;
    let peak = -Infinity;
    for (const point of equityCurve) {
      if (point.equity > peak) peak = point.equity;
      const drawdown = (peak - point.equity) / peak * 100;
      if (drawdown > maxDrawdown) maxDrawdown = drawdown;
    }
    return maxDrawdown;
  }
  ```
  - ç™¾åˆ†æ¯”æ˜¾ç¤º
  - é¢œè‰²è­¦å‘Šï¼ˆ>20%çº¢è‰²ï¼‰

#### 3.1.6 è¿è§„ç»Ÿè®¡ä¸ç›®æ ‡è¿›åº¦

**è¿è§„ç»Ÿè®¡å¡ç‰‡** (`ViolationStats.tsx`):

**è‡ªåŠ¨è¿è§„æ£€æµ‹** (`lib/violations.ts`):
```typescript
export function detectViolations(trade: Trade): Violation[] {
  const violations: Violation[] = [];
  
  // 1. æ­¢æŸæœªè®¾ç½®
  if (!trade.planStopLoss) {
    violations.push({
      type: 'no_stop_loss',
      severity: 'high',
      message: 'æœªè®¾ç½®æ­¢æŸ'
    });
  }
  
  // 2. ä»“ä½è¿‡å¤§
  if (trade.positionSize && trade.positionSize > 20) {
    violations.push({
      type: 'position_too_large',
      severity: 'medium',
      message: `ä»“ä½è¿‡å¤§: ${trade.positionSize}%`
    });
  }
  
  // 3. æŒæœ‰æ—¶é—´è¿‡é•¿
  if (trade.expectedHoldDays && trade.actualHoldDays) {
    if (trade.actualHoldDays > trade.expectedHoldDays * 1.5) {
      violations.push({
        type: 'hold_too_long',
        severity: 'low',
        message: 'æŒæœ‰æ—¶é—´è¶…å‡ºè®¡åˆ’50%'
      });
    }
  }
  
  // 4. é¢‘ç¹äº¤æ˜“
  // ...æ›´å¤šè§„åˆ™
  
  return violations;
}
```

**è¿è§„æˆæœ¬è®¡ç®—**:
```typescript
export function calculateViolationCost(trade: Trade): number {
  let cost = 0;
  trade.violations.forEach(v => {
    if (v.type === 'no_stop_loss' && trade.netPnl < 0) {
      // ä¼°ç®—ï¼šå¦‚æœè®¾ç½®äº†æ­¢æŸï¼ŒäºæŸå¯èƒ½å‡å°‘30%
      cost += Math.abs(trade.netPnl) * 0.3;
    }
    // ...å…¶ä»–è¿è§„æˆæœ¬è®¡ç®—
  });
  return cost;
}
```

**å¡ç‰‡å±•ç¤º**:
- è¿è§„æ¬¡æ•°ç»Ÿè®¡
- è¿è§„ç±»å‹åˆ†å¸ƒï¼ˆé¥¼å›¾ï¼‰
- è¿è§„æˆæœ¬æ€»è®¡
- æ”¹è¿›å»ºè®®åˆ—è¡¨

**ç›®æ ‡è¿›åº¦å¡ç‰‡** (`GoalProgressCard.tsx`):
- **æœˆåº¦ç›®æ ‡**
  - è®¾ç½®ç›®æ ‡é‡‘é¢
  - å½“å‰è¿›åº¦
  - è¿›åº¦æ¡
  - è¾¾æˆç‡
  
- **å¹´åº¦ç›®æ ‡**
  - è®¾ç½®å¹´åº¦ç›®æ ‡
  - ç´¯è®¡æ”¶ç›Š
  - è·ç¦»ç›®æ ‡
  - æœˆå‡éœ€æ±‚

#### 3.1.7 æ“ä½œæŒ‰é’®æ 

**å·¦ä¾§æŒ‰é’®ç»„**:
1. **å¯¼å…¥CSV**
   ```jsx
   <input ref={fileInputRef} type="file" accept=".csv" className="hidden" />
   <Button onClick={() => fileInputRef.current?.click()}>å¯¼å…¥CSV</Button>
   ```
   
2. **å¯¼å‡ºCSV**
   ```typescript
   const exportCsv = () => {
     const cols = ['id', 'symbol', 'status', 'entryPrice', ...];
     const lines = [cols.join(',')];
     filteredTrades.forEach(t => {
       const row = cols.map(c => t[c]).join(',');
       lines.push(row);
     });
     const blob = new Blob([lines.join('\n')], { type: 'text/csv' });
     const url = URL.createObjectURL(blob);
     const a = document.createElement('a');
     a.href = url;
     a.download = `trades-export-${Date.now()}.csv`;
     a.click();
   };
   ```
   
3. **ä¿å­˜çš„ç­›é€‰** (`SavedFiltersMenu`)
   - ä¿å­˜å½“å‰ç­›é€‰ç»„åˆ
   - å¿«é€Ÿåº”ç”¨å†å²ç­›é€‰
   - åˆ é™¤ä¿å­˜çš„æ–¹æ¡ˆ
   
4. **é…ç½®æé†’** (`AlertConfigDialog`)
   - ç›ˆåˆ©ç›®æ ‡æé†’
   - æœ€å¤§å›æ’¤æé†’
   
5. **æ‰‹åŠ¨å½•å…¥**
   - è·³è¿‡æ£€æŸ¥æ¸…å•
   - å¿«é€Ÿå½•å…¥å·²æ‰§è¡Œäº¤æ˜“

**å³ä¾§æŒ‰é’®ç»„**:
1. **å¿«é€Ÿå½•å…¥è®¡åˆ’**
   - å…ˆæ˜¾ç¤ºäº¤æ˜“å‰æ£€æŸ¥æ¸…å•
   - é€šè¿‡åæ‰“å¼€è®¡åˆ’è¡¨å•
   
2. **6æ­¥å‘å¯¼åˆ›å»º**
   - è·³è½¬åˆ°`/plan/create`
   - ç³»ç»ŸåŒ–å¼•å¯¼æµç¨‹

#### 3.1.8 æ ‡ç­¾é¡µç³»ç»Ÿ

**ä¸‰ä¸ªæ ‡ç­¾é¡µ**:
```jsx
<Button variant={activeTab === "active" ? "default" : "ghost"}>
  <TrendingUp /> æ­£åœ¨äº¤æ˜“ ({activeTrades.length})
</Button>
<Button variant={activeTab === "pending" ? "default" : "ghost"}>
  <Target /> äº¤æ˜“è®¡åˆ’ ({pendingTrades.length})
</Button>
<Button variant={activeTab === "history" ? "default" : "ghost"}>
  <DollarSign /> å†å²è®°å½• ({closedTrades.length})
</Button>
```

**æ•°æ®ç­›é€‰**:
```typescript
const filteredTrades = useMemo(() => {
  let result = trades;
  
  if (activeTab === "active") {
    result = result.filter(t => t.status === "active");
  } else if (activeTab === "pending") {
    result = result.filter(t => t.status === "pending" || t.status === "planned");
  } else {
    result = result.filter(t => t.status === "closed" || t.status === "cancelled");
  }
  
  // åº”ç”¨å…¶ä»–ç­›é€‰æ¡ä»¶
  if (filters.symbol) {
    result = result.filter(t => t.symbol.toLowerCase().includes(filters.symbol));
  }
  // ...
  
  return result;
}, [trades, filters, activeTab]);
```

**å½“å‰æ ‡ç­¾é¡µç»Ÿè®¡**:
- æ•°é‡
- æ€»ç›ˆäºï¼ˆæ´»è·ƒäº¤æ˜“ä¸ºæµ®åŠ¨ç›ˆäºï¼Œå†å²ä¸ºå·²å®ç°ï¼‰
- ç›ˆåˆ©/äºæŸæ•°é‡
- èƒœç‡ï¼ˆä»…å†å²è®°å½•ï¼‰

#### 3.1.9 ç­›é€‰å™¨ (`TradeFilters.tsx`)

**ç­›é€‰æ¡ä»¶**:
1. **è‚¡ç¥¨ä»£ç **
   - æ–‡æœ¬è¾“å…¥
   - æ¨¡ç³Šæœç´¢
   
2. **äº¤æ˜“çŠ¶æ€**
   - å¤šé€‰ä¸‹æ‹‰
   - pending, active, closed, cancelled
   
3. **äº¤æ˜“ç±»å‹**
   - long (åšå¤š)
   - short (åšç©º)
   
4. **æ—¥æœŸèŒƒå›´**
   - èµ·å§‹æ—¥æœŸ
   - ç»“æŸæ—¥æœŸ
   - æ—¥æœŸé€‰æ‹©å™¨

**æ“ä½œæŒ‰é’®**:
- é‡ç½®ç­›é€‰
- ä¿å­˜ç­›é€‰æ–¹æ¡ˆ

#### 3.1.10 äº¤æ˜“å¡ç‰‡ (`TradeCard.tsx`)

**å¡ç‰‡å¸ƒå±€**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [çŠ¶æ€å¾½ç« ] AAPL - è‹¹æœå…¬å¸          â”‚
â”‚ å…¥åœº: $180.50 â†’ å½“å‰: $185.20       â”‚
â”‚ ç›ˆäº: +$470 (+2.60%) [ç»¿è‰²]         â”‚
â”‚                                     â”‚
â”‚ æ­¢æŸ: $175.00 | æ­¢ç›ˆ: $190.00       â”‚
â”‚ ä»“ä½: 25% | é£é™©å›æŠ¥æ¯”: 2.2:1       â”‚
â”‚                                     â”‚
â”‚ [ç¬”è®°] [æˆªå›¾] [æé†’] [è¯¦æƒ…] [ç¼–è¾‘]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**çŠ¶æ€å¾½ç« é¢œè‰²**:
- pending - é»„è‰²
- active - ç»¿è‰²
- closed - è“è‰²
- cancelled - ç°è‰²

**ç›ˆäºæ˜¾ç¤º**:
- æ­£æ•°ï¼šç»¿è‰²æ–‡å­—ï¼Œå‘ä¸Šç®­å¤´
- è´Ÿæ•°ï¼šçº¢è‰²æ–‡å­—ï¼Œå‘ä¸‹ç®­å¤´
- é‡‘é¢ + ç™¾åˆ†æ¯”

**æ“ä½œæŒ‰é’®**:
1. **æ·»åŠ ç¬”è®°**
   - æ‰“å¼€ç¬”è®°å¯¹è¯æ¡†
   - é¢„å¡«å……äº¤æ˜“ä¿¡æ¯
   
2. **ä¸Šä¼ æˆªå›¾** (`ImageManager`)
   - æ”¯æŒæ‹–æ‹½ä¸Šä¼ 
   - å›¾ç‰‡é¢„è§ˆ
   - åˆ é™¤åŠŸèƒ½
   
3. **è®¾ç½®æé†’**
   - ä»·æ ¼æé†’
   - æ—¶é—´æé†’
   
4. **æŸ¥çœ‹è¯¦æƒ…**
   - è·³è½¬åˆ°äº¤æ˜“è¯¦æƒ…é¡µ
   - `/trade/[id]`
   
5. **ç¼–è¾‘**
   - æ‰“å¼€ç¼–è¾‘å¯¹è¯æ¡†
   - ä¿®æ”¹è®¡åˆ’å‚æ•°
   
6. **åˆ é™¤**
   - ç¡®è®¤å¯¹è¯æ¡†
   - è½¯åˆ é™¤/ç¡¬åˆ é™¤

**é«˜äº®åŠ¨ç”»**:
```typescript
const [highlightTradeId, setHighlightTradeId] = useState<number | null>(null);

// åˆ›å»ºæ–°äº¤æ˜“å
setHighlightTradeId(newTrade.id);
setTimeout(() => setHighlightTradeId(null), 3000);

// CSS
className={`transition-all duration-500 ${
  highlightTradeId === trade.id
    ? 'ring-4 ring-green-400 ring-opacity-50 rounded-lg scale-105'
    : ''
}`}
```

#### 3.1.11 æ‰‹åŠ¨å½•å…¥å¯¹è¯æ¡† (`ManualTradeDialog.tsx`)

**ç›®çš„**: å¿«é€Ÿå½•å…¥å·²æ‰§è¡Œçš„äº¤æ˜“ï¼Œè·³è¿‡ç¹ççš„è®¡åˆ’æµç¨‹

**è¡¨å•å­—æ®µ**:
- è‚¡ç¥¨ä»£ç ï¼ˆå¿…å¡«ï¼‰
- è‚¡ç¥¨åç§°
- äº¤æ˜“æ–¹å‘ï¼ˆlong/shortï¼‰
- å…¥åœºä»·ï¼ˆå¿…å¡«ï¼‰
- å…¥åœºæ•°é‡
- å…¥åœºæ—¶é—´
- å½“å‰ä»·æ ¼ï¼ˆå¯é€‰ï¼‰
- æ­¢æŸä»·
- æ­¢ç›ˆä»·
- ç®€å•å¤‡æ³¨

**ä¿å­˜é€»è¾‘**:
```typescript
const handleSave = async (tradeData: Partial<Trade>) => {
  const maxIdTrade = await db.trades.orderBy('id').last();
  const nextId = (maxIdTrade?.id || 0) + 1;
  
  const newTrade: Trade = {
    ...tradeData,
    id: nextId,
    status: 'active',
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString()
  };
  
  await db.trades.add(newTrade);
  toast.success('äº¤æ˜“å·²å½•å…¥');
  onClose();
};
```

#### 3.1.12 CSVå¯¼å…¥è¯¦è§£

**CSVæ ¼å¼è¦æ±‚**:
```csv
symbol,name,date,side,quantity,price
AAPL,è‹¹æœå…¬å¸,2024-01-15,long,100,180.50
TSLA,ç‰¹æ–¯æ‹‰,2024-01-16,long,50,245.30
```

**è§£æå‡½æ•°**:
```typescript
const parseCsv = (text: string): Array<Record<string, string>> => {
  const lines = text.split(/\r?\n/).filter(Boolean);
  if (lines.length === 0) return [];
  
  const header = lines[0];
  const columns = header.split(",").map(c => c.trim());
  
  const rows: Array<Record<string, string>> = [];
  for (let i = 1; i < lines.length; i++) {
    const parts = lines[i]
      .split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/)  // å¤„ç†å¼•å·ä¸­çš„é€—å·
      .map(s => s.replace(/^"|"$/g, "").trim());
    
    if (parts.length !== columns.length) continue;
    
    const obj: Record<string, string> = {};
    columns.forEach((c, idx) => (obj[c] = parts[idx] ?? ""));
    rows.push(obj);
  }
  
  return rows;
};
```

**å­—æ®µæ˜ å°„**:
- symbol/Symbol/SYMBOL â†’ symbol
- name/stockName â†’ stockName
- date/createdAt/time â†’ createdAt
- side/action â†’ planType
- quantity/qty/shares â†’ entryQuantity
- price/entryPrice/planEntryPrice â†’ entryPrice

**å»é‡é€»è¾‘**:
```typescript
const existingKey = new Set(trades.map(t => `${t.symbol}|${t.createdAt}`));
const key = `${symbol}|${date}`;
if (existingKey.has(key)) return; // è·³è¿‡é‡å¤
```

**æ‰¹é‡æ·»åŠ **:
```typescript
await db.trades.bulkAdd(newOnes).catch(err => 
  toast.error("å¯¼å…¥å¤±è´¥: " + err.message)
);
```

**ç»“æœæç¤º**:
```
å¯¼å…¥å®Œæˆï¼šæ–°å¢ 8 æ¡ï¼Œé‡å¤ 2 æ¡
```

#### 3.1.13 æé†’é…ç½® (`AlertConfigDialog.tsx`)

**é…ç½®é¡¹**:
```typescript
interface AlertConfig {
  targetTotalPnl?: number;      // ç›ˆåˆ©ç›®æ ‡
  maxDrawdownPct?: number;       // æœ€å¤§å›æ’¤ç™¾åˆ†æ¯”
  dailyLossLimit?: number;       // æ—¥äºæŸé™é¢
  consecutiveLosses?: number;    // è¿ç»­äºæŸæ¬¡æ•°
}
```

**æé†’è§¦å‘**:
```typescript
useEffect(() => {
  const totalPnl = trades.reduce((s, t) => s + (t.netPnl || 0), 0);
  const curve = computeEquityCurve(trades, 100000, "day");
  const dd = computeMaxDrawdown(curve);
  
  // ç›®æ ‡è¾¾æˆ
  if (alertCfg?.targetTotalPnl && totalPnl >= alertCfg.targetTotalPnl) {
    if (!goalTriggered) {
      toast.success(`ğŸ¯ ç›ˆåˆ©ç›®æ ‡å·²è¾¾æˆï¼š$${totalPnl.toFixed(2)}`);
      setGoalTriggered(true);
    }
  }
  
  // å›æ’¤è¶…æ ‡
  if (alertCfg?.maxDrawdownPct && dd >= alertCfg.maxDrawdownPct) {
    if (!ddTriggered) {
      toast.warning(`âš ï¸ æœ€å¤§å›æ’¤è¾¾åˆ° ${dd.toFixed(2)}%`);
      setDdTriggered(true);
    }
  }
}, [trades, alertCfg]);
```

**æŒä¹…åŒ–**:
```typescript
await db.settings.put({ key: 'alertConfig', value: alertCfg });
```

---

## 4. ç¬”è®°ç³»ç»Ÿ

### 4.1 ç¬”è®°è§†å›¾ (`NotesView.tsx`)

#### 4.1.1 ç¬”è®°ç±»å‹å®šä¹‰

```typescript
type NoteType = 'trade' | 'idea' | 'research' | 'review' | 'lesson' | 'plan';

interface Note {
  id?: number;
  type: NoteType;
  title: string;
  content: string;
  tags: NoteTag[];
  isStarred: boolean;
  relatedId?: string;       // å…³è”IDï¼ˆå¦‚è‚¡ç¥¨ä»£ç ã€äº¤æ˜“IDï¼‰
  relatedLabel?: string;    // å…³è”æ ‡ç­¾
  createdAt?: string;
}
```

**ç±»å‹å›¾æ ‡å’Œé¢œè‰²**:
- trade ğŸ’¹ - è“è‰² - äº¤æ˜“ç¬”è®°
- idea ğŸ’¡ - é»„è‰² - æŠ•èµ„æƒ³æ³•
- research ğŸ” - ç»¿è‰² - ç ”ç©¶ç¬”è®°
- review ğŸ“ - ç´«è‰² - å¤ç›˜æ€»ç»“
- lesson âš ï¸ - çº¢è‰² - ç»éªŒæ•™è®­
- plan ğŸ“‹ - æ©™è‰² - è®¡åˆ’

#### 4.1.2 ç­›é€‰åŠŸèƒ½ (`NoteFilters.tsx`)

**ç­›é€‰ç»´åº¦**:
1. **æœç´¢**
   ```typescript
   const filteredNotes = notes.filter(n =>
     n.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
     n.content.toLowerCase().includes(searchQuery.toLowerCase())
   );
   ```

2. **ç±»å‹ç­›é€‰**
   ```jsx
   <Select value={noteType} onValueChange={setNoteType}>
     <SelectItem value="all">å…¨éƒ¨ç±»å‹</SelectItem>
     <SelectItem value="trade">äº¤æ˜“ç¬”è®°</SelectItem>
     <SelectItem value="idea">æŠ•èµ„æƒ³æ³•</SelectItem>
     {/* ... */}
   </Select>
   ```

3. **æ ‡ç­¾ç­›é€‰**
   - å¤šé€‰æ ‡ç­¾
   - æ»¡è¶³ä»»ä¸€æ ‡ç­¾å³æ˜¾ç¤º
   ```typescript
   if (selectedTags.length > 0) {
     result = result.filter(n =>
       n.tags.some(tag => selectedTags.includes(tag.id))
     );
   }
   ```

4. **æ”¶è—ç­›é€‰**
   ```typescript
   if (starredOnly) {
     result = result.filter(n => n.isStarred);
   }
   ```

5. **æ—¥æœŸèŒƒå›´**
   - é»˜è®¤æ˜¾ç¤ºæœ€è¿‘30å¤©
   ```typescript
   const [dateRange, setDateRange] = useState({
     start: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split("T")[0],
     end: new Date().toISOString().split("T")[0]
   });
   ```

**ç­›é€‰ç»“æœç»Ÿè®¡**:
```jsx
<div>
  <span>å…± {filteredNotes.length} æ¡ç¬”è®°</span>
  {selectedTags.length > 0 && <span>â€¢ å·²é€‰æ‹© {selectedTags.length} ä¸ªæ ‡ç­¾</span>}
  {starredOnly && <span>â€¢ ä»…æ˜¾ç¤ºæ”¶è—</span>}
</div>
```

#### 4.1.3 ç¬”è®°å¡ç‰‡ (`NoteCard.tsx`)

**å¡ç‰‡å¸ƒå±€**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ç±»å‹å›¾æ ‡] [æ”¶è—â­]         â”‚
â”‚ æ ‡é¢˜ï¼ˆç²—ä½“å¤§å­—ï¼‰            â”‚
â”‚ å†…å®¹é¢„è§ˆï¼ˆæœ€å¤š3è¡Œï¼‰         â”‚
â”‚ [æ ‡ç­¾1] [æ ‡ç­¾2] [æ ‡ç­¾3]    â”‚
â”‚ 2024-01-15 14:30           â”‚
â”‚                            â”‚
â”‚ [ç¼–è¾‘âœï¸] [åˆ é™¤ğŸ—‘ï¸]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç±»å‹å›¾æ ‡**:
```jsx
const getTypeIcon = (type: NoteType) => {
  switch(type) {
    case 'trade': return <TrendingUp className="w-5 h-5 text-blue-500" />;
    case 'idea': return <Lightbulb className="w-5 h-5 text-yellow-500" />;
    // ...
  }
};
```

**æ”¶è—åˆ‡æ¢**:
```jsx
<button onClick={() => onToggleStar(note.id)}>
  {note.isStarred ? <Star className="fill-yellow-400 text-yellow-400" /> : <Star />}
</button>
```

**æ ‡ç­¾å±•ç¤º**:
- æœ€å¤šæ˜¾ç¤º5ä¸ªæ ‡ç­¾
- è¶…å‡ºæ˜¾ç¤º+N
- æ ‡ç­¾é¢œè‰²

#### 4.1.4 ç»Ÿä¸€ç¬”è®°å¯¹è¯æ¡† (`UnifiedNoteDialog.tsx`)

**è¡¨å•å­—æ®µ**:
```jsx
<Select value={formData.type} onValueChange={setType}>
  {/* 6ç§ç¬”è®°ç±»å‹ */}
</Select>

<Input placeholder="æ ‡é¢˜" value={formData.title} />

<Textarea placeholder="å†…å®¹" rows={10} value={formData.content} />

<div>
  {/* æ ‡ç­¾é€‰æ‹©ï¼Œæ”¯æŒå¤šé€‰ */}
  {tags.map(tag => (
    <Badge onClick={() => toggleTag(tag.id)}>{tag.name}</Badge>
  ))}
</div>

<Checkbox checked={formData.isStarred} label="æ ‡è®°ä¸ºæ”¶è—" />
```

**ä¿å­˜é€»è¾‘**:
```typescript
const handleSave = () => {
  if (editingNote?.id) {
    // æ›´æ–°
    setNotes(prev => prev.map(n =>
      n.id === editingNote.id
        ? { ...formData, id: editingNote.id, createdAt: n.createdAt }
        : n
    ));
  } else {
    // æ–°å»º
    const newNote: NoteWithId = {
      ...formData,
      id: Math.max(...notes.map(n => n.id)) + 1,
      createdAt: new Date().toISOString()
    };
    setNotes(prev => [newNote, ...prev]);
  }
  
  setShowEditor(false);
  setEditingNote(null);
};
```

#### 4.1.5 æ ‡ç­¾ç®¡ç†å™¨ (`TagManager.tsx`)

**æ ‡ç­¾CRUD**:

**åˆ›å»ºæ ‡ç­¾**:
```jsx
<Dialog>
  <Input placeholder="æ ‡ç­¾åç§°" value={newTagName} />
  <Select value={newTagColor}>
    {/* 10ç§é¢„è®¾é¢œè‰² */}
  </Select>
  <Button onClick={handleCreate}>åˆ›å»º</Button>
</Dialog>
```

**æ ‡ç­¾åˆ—è¡¨**:
```jsx
{tags.map(tag => (
  <div key={tag.id} className={`p-3 rounded border-l-4 ${tag.color}`}>
    <div className="flex justify-between">
      <span>{tag.name}</span>
      <span className="text-sm text-gray-500">ä½¿ç”¨ {tag.count} æ¬¡</span>
    </div>
    <div className="flex gap-2 mt-2">
      <Button onClick={() => handleEdit(tag)}>ç¼–è¾‘</Button>
      <Button onClick={() => handleDelete(tag.id)}>åˆ é™¤</Button>
    </div>
  </div>
))}
```

**åˆ é™¤æ ‡ç­¾**:
- åˆ é™¤æ ‡ç­¾æœ¬èº«
- ä»æ‰€æœ‰ç¬”è®°ä¸­ç§»é™¤è¯¥æ ‡ç­¾
```typescript
const handleDeleteTag = (id: number) => {
  setTags(prev => prev.filter(t => t.id !== id));
  setNotes(prev => prev.map(note => ({
    ...note,
    tags: note.tags.filter(t => t.id !== id)
  })));
};
```

#### 4.1.6 åˆ†é¡µ

**åˆ†é¡µé€»è¾‘**:
```typescript
const [currentPage, setCurrentPage] = useState(1);
const [perPage, setPerPage] = useState(20);

const paginatedNotes = useMemo(() => {
  const start = (currentPage - 1) * perPage;
  const end = start + perPage;
  return filteredNotes.slice(start, end);
}, [filteredNotes, currentPage, perPage]);

const totalPages = Math.ceil(filteredNotes.length / perPage);
```

**åˆ†é¡µæ§ä»¶**:
```jsx
<div className="flex justify-center gap-2">
  <Button disabled={currentPage === 1} onClick={() => setCurrentPage(p => p - 1)}>
    ä¸Šä¸€é¡µ
  </Button>
  <span>ç¬¬ {currentPage} / {totalPages} é¡µ</span>
  <Button disabled={currentPage === totalPages} onClick={() => setCurrentPage(p => p + 1)}>
    ä¸‹ä¸€é¡µ
  </Button>
</div>
```

#### 4.1.7 å¯¼å‡ºåŠŸèƒ½

**JSONå¯¼å‡º**:
```typescript
const handleExport = () => {
  const dataStr = JSON.stringify(filteredNotes, null, 2);
  const dataBlob = new Blob([dataStr], { type: "application/json" });
  const url = URL.createObjectURL(dataBlob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `notes-${new Date().toISOString().split('T')[0]}.json`;
  link.click();
  URL.revokeObjectURL(url);
};
```

#### 4.1.8 ä»å…¶ä»–é¡µé¢æ·»åŠ ç¬”è®°

**URLå‚æ•°ä¼ é€’**:
```typescript
// ä»äº¤æ˜“é¡µé¢è·³è½¬
const noteData = {
  type: "trade",
  relatedId: trade.symbol,
  relatedLabel: `${trade.symbol} ${trade.type === "buy" ? "ä¹°å…¥" : "å–å‡º"}`,
  title: `${trade.symbol} äº¤æ˜“å¤ç›˜`
};

const params = new URLSearchParams({
  type: noteData.type,
  relatedId: noteData.relatedId,
  relatedLabel: noteData.relatedLabel,
  title: noteData.title
});

router.push(`/notes?${params.toString()}`);
```

**æ¥æ”¶å‚æ•°**:
```typescript
// NotesView.tsx
const searchParams = useSearchParams();

useEffect(() => {
  const typeParam = searchParams.get('type');
  const titleParam = searchParams.get('title');
  const relatedIdParam = searchParams.get('relatedId');
  const relatedLabelParam = searchParams.get('relatedLabel');
  
  if (typeParam) {
    setEditingNote({
      type: typeParam as NoteType,
      title: titleParam || '',
      relatedId: relatedIdParam || undefined,
      relatedLabel: relatedLabelParam || undefined,
      content: '',
      tags: [],
      isStarred: false
    });
    setShowEditor(true);
  }
}, [searchParams]);
```

---

## 5. åˆ†ç±»ç®¡ç† (`CategoriesView.tsx`)

### 5.1 åˆ†ç±»æ•°æ®ç»“æ„

```typescript
interface Category {
  id: number;
  category_id: string;        // å”¯ä¸€æ ‡è¯†
  name: string;                // åˆ†ç±»åç§°
  parent_id: string | null;    // çˆ¶åˆ†ç±»ID
  path: string;                // å®Œæ•´è·¯å¾„ï¼ˆå¦‚"è¡Œä¸š/ç§‘æŠ€/AI"ï¼‰
  level: number;               // å±‚çº§ï¼ˆ0ä¸ºé¡¶çº§ï¼‰
  icon: string | null;         // å›¾æ ‡emoji
  color: string | null;        // é¢œè‰²
  stock_count: number;         // å½“å‰å±‚çº§è‚¡ç¥¨æ•°
  total_stock_count: number;   // åŒ…å«å­åˆ†ç±»çš„æ€»è‚¡ç¥¨æ•°
  children: Category[];        // å­åˆ†ç±»æ•°ç»„
}
```

### 5.2 æ ‘å½¢å±•ç¤º

**é€’å½’æ¸²æŸ“**:
```typescript
const renderCategoryNode = (node: Category, level: number = 0) => {
  const isExpanded = expandedNodes.has(node.category_id);
  const hasChildren = node.children && node.children.length > 0;
  
  return (
    <div key={node.category_id}>
      {/* å½“å‰èŠ‚ç‚¹ */}
      <div style={{ marginLeft: `${level * 24}px` }}>
        {/* å±•å¼€/æŠ˜å æŒ‰é’® */}
        {hasChildren && (
          <button onClick={() => toggleNode(node.category_id)}>
            {isExpanded ? <ChevronDown /> : <ChevronRight />}
          </button>
        )}
        
        {/* å›¾æ ‡ */}
        <div>{node.icon || <Folder />}</div>
        
        {/* åç§°å’Œè·¯å¾„ */}
        <div>
          <div>{node.name}</div>
          <div className="text-xs text-gray-500">{node.path}</div>
        </div>
        
        {/* ç»Ÿè®¡ */}
        <div>
          <span>{node.stock_count} è‚¡ç¥¨</span>
          {hasChildren && <span>{node.total_stock_count} æ€»è®¡</span>}
        </div>
        
        {/* æ“ä½œæŒ‰é’® */}
        <Button onClick={() => handleEdit(node)}>ç¼–è¾‘</Button>
        <Button onClick={() => handleDelete(node.category_id)}>åˆ é™¤</Button>
      </div>
      
      {/* å­èŠ‚ç‚¹ */}
      {isExpanded && hasChildren && (
        <div>
          {node.children.map(child => renderCategoryNode(child, level + 1))}
        </div>
      )}
    </div>
  );
};
```

**å±•å¼€/æŠ˜å çŠ¶æ€**:
```typescript
const [expandedNodes, setExpandedNodes] = useState<Set<string>>(new Set());

const toggleNode = (categoryId: string) => {
  const newExpanded = new Set(expandedNodes);
  if (newExpanded.has(categoryId)) {
    newExpanded.delete(categoryId);
  } else {
    newExpanded.add(categoryId);
  }
  setExpandedNodes(newExpanded);
};

// åˆæ¬¡åŠ è½½æ—¶å±•å¼€æ‰€æœ‰èŠ‚ç‚¹
useEffect(() => {
  const allIds = getAllCategoryIds(categories);
  setExpandedNodes(new Set(allIds));
}, [categories]);
```

### 5.3 åˆ›å»º/ç¼–è¾‘åˆ†ç±»

**åˆ›å»ºå¯¹è¯æ¡†**:
```jsx
<Dialog open={showCreateDialog}>
  <DialogContent>
    <Input placeholder="åˆ†ç±»åç§°" value={formData.name} />
    
    {/* çˆ¶åˆ†ç±»é€‰æ‹© */}
    <Select value={formData.parent_id || 'none'}>
      <SelectItem value="none">æ— ï¼ˆé¡¶çº§åˆ†ç±»ï¼‰</SelectItem>
      {flatCategories.map(cat => (
        <SelectItem value={cat.category_id}>
          {'  '.repeat(cat.level)}{cat.name}
        </SelectItem>
      ))}
    </Select>
    
    {/* å›¾æ ‡é€‰æ‹©ï¼ˆ12ä¸ªé¢„è®¾ï¼‰ */}
    <div className="grid grid-cols-6 gap-2">
      {['ğŸ“', 'ğŸ“‚', 'â­', 'ğŸ¯', 'ğŸ’¼', 'ğŸ¢', 'ğŸš€', 'ğŸ’¡', 'ğŸ”¥', 'âš¡', 'ğŸŒŸ', 'ğŸ“Š'].map(icon => (
        <button onClick={() => setIcon(icon)}>{icon}</button>
      ))}
    </div>
    
    {/* é¢œè‰²é€‰æ‹©ï¼ˆ7ç§é¢œè‰²ï¼‰ */}
    <div className="flex gap-2">
      {['blue', 'green', 'red', 'yellow', 'purple', 'pink', 'gray'].map(color => (
        <button onClick={() => setColor(color)}>{color}</button>
      ))}
    </div>
    
    <Button onClick={handleSubmit}>
      {editingCategory ? 'æ›´æ–°' : 'åˆ›å»º'}
    </Button>
  </DialogContent>
</Dialog>
```

**æäº¤é€»è¾‘**:
```typescript
const handleSubmit = async () => {
  if (!formData.name.trim()) {
    toast.error('è¯·è¾“å…¥åˆ†ç±»åç§°');
    return;
  }
  
  const base = process.env.NEXT_PUBLIC_API_BASE_URL ?? '';
  const url = editingCategory
    ? `${base}/api/v1/categories/${editingCategory.category_id}`
    : `${base}/api/v1/categories/`;
  
  const method = editingCategory ? 'PUT' : 'POST';
  
  const response = await fetch(url, {
    method,
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      name: formData.name,
      parent_id: formData.parent_id || null,
      icon: formData.icon,
      color: formData.color
    })
  });
  
  const result = await response.json();
  
  if (result.success) {
    toast.success(editingCategory ? 'åˆ†ç±»æ›´æ–°æˆåŠŸ' : 'åˆ†ç±»åˆ›å»ºæˆåŠŸ');
    setShowCreateDialog(false);
    fetchCategories();  // é‡æ–°è·å–åˆ†ç±»æ ‘
  }
};
```

### 5.4 åˆ é™¤åˆ†ç±»

**åˆ é™¤ç¡®è®¤**:
```typescript
const handleDelete = async (categoryId: string) => {
  if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªåˆ†ç±»å—ï¼Ÿå­åˆ†ç±»ä¹Ÿä¼šè¢«åˆ é™¤ã€‚')) {
    return;
  }
  
  const base = process.env.NEXT_PUBLIC_API_BASE_URL ?? '';
  const response = await fetch(`${base}/api/v1/categories/${categoryId}`, {
    method: 'DELETE'
  });
  
  const result = await response.json();
  
  if (result.success) {
    toast.success('åˆ†ç±»åˆ é™¤æˆåŠŸ');
    fetchCategories();
  }
};
```

**çº§è”åˆ é™¤**:
- åç«¯è´Ÿè´£åˆ é™¤å­åˆ†ç±»
- å‰ç«¯åˆ·æ–°æ•´ä¸ªåˆ†ç±»æ ‘

### 5.5 Mockæ¨¡å¼

**å¼€å…³æ§åˆ¶**:
```typescript
const USE_MOCK_DATA = false;  // é»˜è®¤å…³é—­
```

**Mockæ•°æ®ç¤ºä¾‹**:
```typescript
const mockCategories: Category[] = [
  {
    id: 1,
    category_id: 'cat_1',
    name: 'è¡Œä¸šæ¿å—',
    parent_id: null,
    path: 'è¡Œä¸šæ¿å—',
    level: 0,
    icon: 'ğŸ“',
    color: 'blue',
    stock_count: 0,
    total_stock_count: 50,
    children: [
      {
        id: 2,
        category_id: 'cat_2',
        name: 'ç§‘æŠ€è‚¡',
        parent_id: 'cat_1',
        path: 'è¡Œä¸šæ¿å—/ç§‘æŠ€è‚¡',
        level: 1,
        icon: 'ğŸ’»',
        color: 'blue',
        stock_count: 30,
        total_stock_count: 30,
        children: []
      }
    ]
  }
];
```

### 5.6 ç»Ÿè®¡å¡ç‰‡

**ä¸‰ä¸ªç»Ÿè®¡å¡ç‰‡**:
```jsx
<Card>
  <div>
    <p className="text-sm text-gray-500">æ€»åˆ†ç±»æ•°</p>
    <p className="text-2xl font-bold">{getAllCategoryIds(categories).length}</p>
  </div>
  <Folder className="w-8 h-8 text-blue-500" />
</Card>

<Card>
  <div>
    <p className="text-sm text-gray-500">é¡¶çº§åˆ†ç±»</p>
    <p className="text-2xl font-bold">{categories.length}</p>
  </div>
  <FolderOpen className="w-8 h-8 text-green-500" />
</Card>

<Card>
  <div>
    <p className="text-sm text-gray-500">æ€»è‚¡ç¥¨æ•°</p>
    <p className="text-2xl font-bold">
      {categories.reduce((sum, cat) => sum + cat.total_stock_count, 0)}
    </p>
  </div>
  <BarChart3 className="w-8 h-8 text-purple-500" />
</Card>
```

---

ç”±äºç¯‡å¹…é™åˆ¶ï¼Œæ–‡æ¡£å·²ç»è¦†ç›–äº†æ ¸å¿ƒæ¨¡å—ã€‚å®Œæ•´æ–‡æ¡£åŒ…å«ä»¥ä¸‹å‰©ä½™å†…å®¹ï¼š

6. å¤ç›˜ç³»ç»Ÿ
7. ç­–ç•¥ç®¡ç†
8. å¿ƒç†åˆ†æ
9. äº¤æ˜“æ™ºæ…§åº“
10. æ£€æŸ¥æ¸…å•ç³»ç»Ÿ
11. é”™è¯¯åˆ†æ
12. æ•°æ®é€è§†è¡¨
13. äº¤æ˜“è®¡åˆ’ç³»ç»Ÿï¼ˆ6æ­¥ä½“ç³»ï¼‰
14. å¸‚åœºåˆ†æå·¥å…·
15. äº¤æ˜“é˜²æŠ¤ç³»ç»Ÿ
16. åˆ¸å•†è®¾ç½®
17. è¾…åŠ©åŠŸèƒ½ï¼ˆä¸»é¢˜åˆ‡æ¢ã€é€šçŸ¥ç³»ç»Ÿç­‰ï¼‰

---

## æŠ€æœ¯å®ç°è¦ç‚¹

### æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆ
- **IndexedDB (Dexie.js)**: æ ¸å¿ƒäº¤æ˜“æ•°æ®
- **localStorage**: é…ç½®ã€ç­›é€‰æ–¹æ¡ˆã€å†å²è®°å½•
- **å®æ—¶åŒæ­¥**: useLiveQueryè‡ªåŠ¨æ›´æ–°UI

### çŠ¶æ€ç®¡ç†
- **React Hooks**: useState, useEffect, useMemo
- **URL Hash**: è·¯ç”±çŠ¶æ€
- **Dexie**: æ•°æ®åº“çŠ¶æ€

### UIæ¡†æ¶
- **shadcn/ui**: é«˜è´¨é‡ç»„ä»¶åº“
- **Tailwind CSS**: åŸå­åŒ–CSS
- **Lucide Icons**: å›¾æ ‡åº“
- **Recharts**: å›¾è¡¨åº“

### æ€§èƒ½ä¼˜åŒ–
- **useMemo**: é¿å…é‡å¤è®¡ç®—
- **è™šæ‹Ÿæ»šåŠ¨**: å¤§åˆ—è¡¨ä¼˜åŒ–
- **ä»£ç åˆ†å‰²**: æŒ‰éœ€åŠ è½½
- **å›¾ç‰‡æ‡’åŠ è½½**: ä¼˜åŒ–é¦–å±åŠ è½½

---

**æ–‡æ¡£ç”Ÿæˆæ—¶é—´**: 2025-12-12  
**ä½œè€…**: AIåŠ©æ‰‹  
**ç‰ˆæœ¬**: v1.0
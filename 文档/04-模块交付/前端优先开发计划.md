# 前端优先开发计划 - 8大核心功能

> **策略**: 先完成前端UI和交互,使用Mock数据验证需求  
> **优势**: 快速迭代、及时调整、需求验证  
> **开始日期**: 2025年10月18日  
> **预计完成**: 4-5周

---

## 🎯 开发原则

1. **使用 LocalStorage** - 所有数据暂时存储在浏览器本地
2. **Mock数据优先** - 创建丰富的Mock数据模拟真实场景
3. **组件化设计** - 便于后续接入真实API
4. **完整交互** - 所有按钮和表单都要有响应
5. **美观易用** - UI/UX是第一优先级

---

## 📅 4周开发计划

### Week 1: 券商连接 + 执行记录 (前端完整体验)

#### Day 1-2: 券商连接设置页面
**目标**: 完整的券商连接UI,模拟连接状态

```tsx
// zhixing_fronted/app/settings/brokers/page.tsx
// 功能:
// - IBKR连接配置界面
// - Longbridge连接配置界面
// - 连接状态模拟(延迟2秒显示连接成功)
// - 同步按钮(显示同步动画和成功提示)
// - 自动同步设置
```

**Mock数据**:
```typescript
// lib/mockBrokerData.ts
export const mockBrokerConfig = {
  ibkr: {
    connected: false,
    lastSync: null,
    config: { host: '127.0.0.1', port: 7497, clientId: 1 }
  },
  longbridge: {
    connected: false,
    lastSync: null,
  }
};

export const mockSyncedTrades = [
  {
    id: 1,
    symbol: 'AAPL',
    side: 'buy',
    quantity: 100,
    price: 178.50,
    time: '2024-10-18T10:30:00Z',
    commission: 1.00,
    source: 'ibkr',
    executionId: 'IB12345'
  },
  // ... 20+ mock trades
];
```

#### Day 3-4: 交易执行记录
**目标**: 完整的执行记录管理界面

```tsx
// components/trades/ExecutionHistory.tsx
// 功能:
// - 显示多次执行记录
// - 计算平均价格、总佣金
// - 添加执行记录弹窗
// - 执行时间线展示
// - 滑点计算和显示
```

**页面位置**: 
- 在交易详情页 `/plan/[id]` 添加"执行记录"标签页
- 在交易列表的每个卡片显示执行次数

#### Day 5: 数据联动测试
- 测试券商同步到执行记录的数据流
- 测试执行记录汇总到交易统计
- 优化交互体验

---

### Week 2: 复盘系统 + 策略管理

#### Day 1-2: 复盘系统
**目标**: 完整的复盘界面

```tsx
// app/review/page.tsx
// 4个Tab页面:
// 1. 日度复盘 - 每日交易总结
// 2. 周度复盘 - 每周总结
// 3. 月度复盘 - 每月回顾
// 4. 交易复盘 - 单笔深度分析
```

**日度复盘表单**:
```typescript
{
  date: '2024-10-18',
  totalTrades: 5,
  totalPnl: 1250,
  winRate: 0.6,
  
  // 状态
  mentalState: 'good', // excellent/good/normal/tired/stressed
  marketCondition: 'bull', // bull/bear/sideways/volatile
  
  // 纪律
  followedPlan: true,
  violations: [],
  
  // 反思
  learnings: '今天MACD金叉信号非常准确...',
  mistakes: '过早止盈了TSLA...',
  improvements: '下次等待第二次确认...',
  tomorrowPlan: '关注NVDA的支撑位...'
}
```

**周度复盘模板**:
```typescript
{
  weekStart: '2024-10-14',
  weekEnd: '2024-10-18',
  
  // 统计
  totalTrades: 25,
  totalPnl: 5200,
  winRate: 0.64,
  bestDay: '2024-10-16',
  worstDay: '2024-10-15',
  
  // 总结
  achievements: '本周胜率提升,纪律性更好...',
  challenges: '震荡市中频繁止损...',
  patterns: '周一周五表现较好...',
  
  // 下周计划
  nextWeekGoals: '胜率保持60%以上...',
  focusAreas: ['止损执行', '仓位控制']
}
```

#### Day 3-4: 策略管理增强
**目标**: 策略库和对比分析

```tsx
// app/strategies/page.tsx
// 功能:
// - 策略卡片展示(胜率、盈亏、交易次数)
// - 策略对比图表
// - 策略模板库
// - 自定义策略创建
```

**策略模板**:
```typescript
export const strategyTemplates = [
  {
    id: 1,
    name: '动量突破',
    description: '突破关键阻力位,MACD金叉确认',
    tags: ['momentum', 'breakout'],
    defaultChecklist: [
      '价格突破阻力位',
      'MACD金叉',
      '成交量放大',
      '大盘趋势一致'
    ]
  },
  {
    id: 2,
    name: '回调买入',
    description: '上升趋势中的回调至支撑位',
    tags: ['pullback', 'support'],
    defaultChecklist: [
      '确认上升趋势',
      '回调至斐波那契38.2%',
      'RSI超卖',
      '支撑位有效'
    ]
  },
  // ... 8-10个常用策略模板
];
```

**策略统计页面**:
```tsx
// components/strategies/StrategyStats.tsx
// 显示:
// - 各策略的盈亏曲线对比
// - 胜率对比雷达图
// - 策略使用频率
// - 最佳/最差策略
```

#### Day 5: 整合测试
- 复盘数据与交易数据联动
- 策略标签与交易关联
- 数据一致性检查

---

### Week 3: 检查清单 + 心理分析

#### Day 1-2: 检查清单系统
**目标**: 完整的检查清单管理和使用流程

```tsx
// app/checklist/page.tsx
// 功能:
// - 检查清单模板管理(CRUD)
// - 预定义检查清单
// - 自定义检查清单
// - 完成率统计
```

**检查清单类型**:
```typescript
// 交易前检查清单
export const preTradeChecklist = [
  { id: 1, content: '确认市场趋势', required: true },
  { id: 2, content: '计算仓位大小', required: true },
  { id: 3, content: '设置止损价位', required: true },
  { id: 4, content: '设置止盈目标', required: true },
  { id: 5, content: '检查资金使用率', required: true },
  { id: 6, content: '确认无重大新闻', required: false },
  { id: 7, content: '心理状态良好', required: true },
  { id: 8, content: '已记录入场理由', required: true },
];

// 交易后检查清单
export const postTradeChecklist = [
  { id: 1, content: '记录实际入场价', required: true },
  { id: 2, content: '记录执行质量', required: true },
  { id: 3, content: '是否遵守计划', required: true },
  { id: 4, content: '情绪状态记录', required: false },
  { id: 5, content: '经验教训记录', required: true },
];

// 每日检查清单
export const dailyChecklist = [
  { id: 1, content: '查看经济日历', required: true },
  { id: 2, content: '复盘昨日交易', required: true },
  { id: 3, content: '制定今日计划', required: true },
  { id: 4, content: '检查账户状态', required: true },
  { id: 5, content: '确认风险限额', required: true },
];
```

**检查清单弹窗集成**:
- 在创建交易计划后弹出"交易前检查清单"
- 在关闭交易后弹出"交易后检查清单"
- 每日首次打开系统弹出"每日检查清单"

#### Day 3-4: 心理分析
**目标**: 情绪追踪和心理模式识别

```tsx
// app/psychology/page.tsx
// 功能:
// - 情绪记录界面
// - 情绪分布图表
// - 纪律性评分
// - 心理模式识别
```

**情绪记录组件**:
```tsx
// components/psychology/EmotionRecorder.tsx
export function EmotionRecorder() {
  const emotions = [
    { value: 'calm', label: '😌 冷静', color: 'blue' },
    { value: 'confident', label: '😎 自信', color: 'green' },
    { value: 'excited', label: '🤩 兴奋', color: 'yellow' },
    { value: 'anxious', label: '😰 焦虑', color: 'orange' },
    { value: 'fearful', label: '😨 恐惧', color: 'red' },
    { value: 'greedy', label: '🤑 贪婪', color: 'purple' },
    { value: 'frustrated', label: '😤 沮丧', color: 'gray' },
  ];
  
  const [selectedEmotion, setSelectedEmotion] = useState('calm');
  const [intensity, setIntensity] = useState(3); // 1-5
  const [disciplineScore, setDisciplineScore] = useState(7); // 1-10
  
  // ... 表单和保存逻辑
}
```

**心理模式卡片**:
```tsx
// components/psychology/PatternCard.tsx
// 显示识别的心理模式:
// - 冲动交易 (未按计划开仓)
// - 报复交易 (亏损后立即交易)
// - 过度交易 (超出计划次数)
// - 分析瘫痪 (错过机会)
```

**心理分析图表**:
```tsx
// components/psychology/PsychologyCharts.tsx
// 1. 情绪分布饼图
// 2. 纪律性趋势折线图
// 3. 情绪vs盈亏散点图
// 4. 心理模式频率柱状图
```

#### Day 5: 数据关联
- 情绪记录与交易关联
- 分析情绪对交易表现的影响
- 生成心理分析报告

---

### Week 4: 错误分析 + 数据透视表

#### Day 1-2: 错误分析
**目标**: 系统化的错误管理

```tsx
// app/errors/page.tsx
// 功能:
// - 错误分类统计
// - 错误趋势图
// - 改进计划管理
```

**错误分类**:
```typescript
export const errorCategories = [
  {
    id: 'entry_error',
    name: '入场错误',
    icon: '🚪',
    subcategories: [
      '入场过早',
      '入场过晚',
      '逆势入场',
      '未等待确认',
      '追涨杀跌'
    ]
  },
  {
    id: 'exit_error',
    name: '出场错误',
    icon: '🚪',
    subcategories: [
      '过早止盈',
      '未执行止损',
      '移动止损',
      '情绪化平仓',
      '犹豫不决'
    ]
  },
  {
    id: 'position_error',
    name: '仓位错误',
    icon: '📊',
    subcategories: [
      '仓位过大',
      '仓位过小',
      '未分批建仓',
      '加仓时机错误'
    ]
  },
  {
    id: 'psychology_error',
    name: '心理错误',
    icon: '🧠',
    subcategories: [
      '冲动交易',
      '报复交易',
      '过度交易',
      '恐惧不敢入场',
      '贪婪不止盈'
    ]
  },
  {
    id: 'planning_error',
    name: '计划错误',
    icon: '📋',
    subcategories: [
      '未制定计划',
      '计划不详细',
      '未遵守计划',
      '风险计算错误'
    ]
  },
  {
    id: 'analysis_error',
    name: '分析错误',
    icon: '🔍',
    subcategories: [
      '误读技术指标',
      '忽视基本面',
      '忽视大盘',
      '过度依赖指标'
    ]
  }
];
```

**错误标记流程**:
```tsx
// components/errors/ErrorMarker.tsx
// 在交易卡片上添加"标记错误"按钮
// 弹窗选择错误类型和子类别
// 输入错误描述和造成的损失
// 保存到该交易的errors字段
```

**改进计划**:
```tsx
// components/errors/ImprovementPlan.tsx
export interface ImprovementPlan {
  errorType: string;
  description: string;
  actions: string[]; // 改进措施
  startDate: string;
  reviewDate: string;
  status: 'active' | 'completed' | 'abandoned';
  effectiveness: number; // 1-10分
}

// 示例:
{
  errorType: 'entry_error',
  description: '经常入场过早,未等待确认信号',
  actions: [
    '必须等待MACD金叉确认',
    '等待突破后的回踩',
    '参考多个时间周期'
  ],
  startDate: '2024-10-18',
  reviewDate: '2024-11-18',
  status: 'active',
  effectiveness: null
}
```

#### Day 3-4: 数据透视表
**目标**: 多维度数据分析工具

```bash
# 安装依赖
cd zhixing_fronted
npm install react-pivottable
npm install plotly.js
```

```tsx
// app/pivot/page.tsx
'use client';

import dynamic from 'next/dynamic';
import { useMemo } from 'react';
import { Card } from '@/components/ui/card';
import 'react-pivottable/pivottable.css';

const PivotTableUI = dynamic(
  () => import('react-pivottable').then((mod) => mod.PivotTableUI),
  { ssr: false }
);

export default function PivotTablePage() {
  // 准备数据
  const data = useMemo(() => {
    const trades = JSON.parse(localStorage.getItem('trades') || '[]');
    
    return trades.map(trade => ({
      '品种': trade.symbol,
      '策略': trade.strategyTags?.[0] || '未分类',
      '方向': trade.planType === 'long' ? '做多' : '做空',
      '状态': getTradeStatusLabel(trade.status),
      '盈亏': trade.realizedPnl || trade.unrealizedPnl || 0,
      '胜负': (trade.realizedPnl || 0) > 0 ? '盈利' : '亏损',
      '日期': new Date(trade.createdAt).toLocaleDateString(),
      '年份': new Date(trade.createdAt).getFullYear(),
      '月份': new Date(trade.createdAt).getMonth() + 1 + '月',
      '星期': ['周日', '周一', '周二', '周三', '周四', '周五', '周六'][
        new Date(trade.createdAt).getDay()
      ],
      '时段': getTimeSegment(new Date(trade.createdAt).getHours()),
      '数量': trade.planQuantity || trade.entryQuantity || 0,
      '金额': (trade.planQuantity || 0) * (trade.planEntryPrice || 0),
      '佣金': trade.commission || 0,
      '持仓天数': calculateHoldingDays(trade),
    }));
  }, []);

  return (
    <div className="container mx-auto p-6">
      <h1 className="text-3xl font-bold mb-6">数据透视表</h1>
      
      <Card className="p-6">
        <div className="mb-4 text-sm text-gray-600">
          <p>💡 使用指南:</p>
          <ul className="list-disc list-inside mt-2 space-y-1">
            <li>拖拽字段到"行"、"列"区域进行分组</li>
            <li>拖拽到"值"区域进行聚合统计</li>
            <li>点击单元格查看详细数据</li>
            <li>切换不同的聚合方式(求和、平均、计数等)</li>
          </ul>
        </div>

        <PivotTableUI
          data={data}
          onChange={s => setPivotState(s)}
          rendererName="Table"
          {...pivotState}
        />
      </Card>

      {/* 保存的透视表配置 */}
      <Card className="p-6 mt-6">
        <h2 className="text-xl font-semibold mb-4">常用透视表</h2>
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
          <Button variant="outline" onClick={() => loadPreset('strategy')}>
            📊 按策略分析
          </Button>
          <Button variant="outline" onClick={() => loadPreset('time')}>
            📅 按时间分析
          </Button>
          <Button variant="outline" onClick={() => loadPreset('symbol')}>
            📈 按品种分析
          </Button>
          <Button variant="outline" onClick={() => loadPreset('weekday')}>
            🗓️ 按星期分析
          </Button>
        </div>
      </Card>
    </div>
  );
}

// 预设配置
const presets = {
  strategy: {
    rows: ['策略', '胜负'],
    cols: ['月份'],
    vals: ['盈亏'],
    aggregatorName: 'Sum',
  },
  time: {
    rows: ['月份', '星期'],
    cols: ['时段'],
    vals: ['盈亏'],
    aggregatorName: 'Average',
  },
  symbol: {
    rows: ['品种'],
    cols: ['策略'],
    vals: ['盈亏', '胜负'],
    aggregatorName: 'Sum',
  },
  weekday: {
    rows: ['星期'],
    cols: ['策略'],
    vals: ['盈亏'],
    aggregatorName: 'Sum as Fraction of Columns',
  },
};
```

#### Day 5: 整合与优化
- 所有8个功能完整测试
- 数据流验证
- UI/UX优化
- 准备演示

---

## 📦 立即可用的代码模板

### 1. Mock数据生成器

```typescript
// zhixing_fronted/lib/mockDataGenerator.ts
import { Trade } from '@/app/trades/types';

export function generateMockTrades(count: number = 50): Trade[] {
  const symbols = ['AAPL', 'TSLA', 'NVDA', 'MSFT', 'GOOGL', 'AMZN', 'META'];
  const strategies = ['momentum', 'pullback', 'breakout', 'swing', 'value'];
  const statuses = ['planned', 'active', 'closed'];
  
  const trades: Trade[] = [];
  
  for (let i = 0; i < count; i++) {
    const status = statuses[Math.floor(Math.random() * statuses.length)];
    const isWin = Math.random() > 0.4; // 60%胜率
    const daysAgo = Math.floor(Math.random() * 90); // 过去90天
    const date = new Date();
    date.setDate(date.getDate() - daysAgo);
    
    const entryPrice = 100 + Math.random() * 200;
    const quantity = Math.floor(Math.random() * 200) + 10;
    const pnlPercent = isWin 
      ? (Math.random() * 0.15) // 0-15%盈利
      : -(Math.random() * 0.10); // 0-10%亏损
    
    const trade: Trade = {
      id: i + 1,
      symbol: symbols[Math.floor(Math.random() * symbols.length)],
      stockName: symbols[Math.floor(Math.random() * symbols.length)] + ' Inc.',
      status,
      planType: 'long',
      strategyTags: [strategies[Math.floor(Math.random() * strategies.length)]],
      
      planEntryPrice: entryPrice,
      planQuantity: quantity,
      planStopLoss: entryPrice * 0.95,
      planTakeProfit: entryPrice * 1.10,
      planNotes: generateRandomNote(),
      
      ...(status !== 'planned' && {
        entryPrice: entryPrice * (1 + (Math.random() - 0.5) * 0.02),
        entryQuantity: quantity,
        entryTime: date.toISOString(),
      }),
      
      ...(status === 'closed' && {
        exitPrice: entryPrice * (1 + pnlPercent),
        exitQuantity: quantity,
        exitTime: new Date(date.getTime() + Math.random() * 7 * 24 * 60 * 60 * 1000).toISOString(),
        realizedPnl: entryPrice * quantity * pnlPercent,
      }),
      
      createdAt: date.toISOString(),
      updatedAt: date.toISOString(),
    };
    
    trades.push(trade);
  }
  
  return trades.sort((a, b) => 
    new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()
  );
}

function generateRandomNote(): string {
  const notes = [
    '突破关键阻力位,MACD金叉确认',
    '回调至斐波那契38.2%支撑',
    '成交量放大,趋势延续信号',
    '技术指标超卖,反弹机会',
    '基本面良好,财报超预期',
  ];
  return notes[Math.floor(Math.random() * notes.length)];
}

// 初始化Mock数据
export function initMockData() {
  if (!localStorage.getItem('trades')) {
    const mockTrades = generateMockTrades(50);
    localStorage.setItem('trades', JSON.stringify(mockTrades));
  }
}
```

### 2. LocalStorage Hook

```typescript
// zhixing_fronted/hooks/useLocalStorage.ts
import { useState, useEffect } from 'react';

export function useLocalStorage<T>(key: string, initialValue: T) {
  const [storedValue, setStoredValue] = useState<T>(() => {
    if (typeof window === 'undefined') return initialValue;
    
    try {
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      console.error(error);
      return initialValue;
    }
  });

  const setValue = (value: T | ((val: T) => T)) => {
    try {
      const valueToStore = value instanceof Function ? value(storedValue) : value;
      setStoredValue(valueToStore);
      
      if (typeof window !== 'undefined') {
        window.localStorage.setItem(key, JSON.stringify(valueToStore));
      }
    } catch (error) {
      console.error(error);
    }
  };

  return [storedValue, setValue] as const;
}
```

---

## 🎨 UI组件清单

### 需要创建的新组件 (按优先级)

1. **券商设置** (`app/settings/brokers/page.tsx`) - Week 1
2. **执行记录** (`components/trades/ExecutionHistory.tsx`) - Week 1
3. **复盘系统** (`app/review/page.tsx`) - Week 2
4. **策略管理** (`app/strategies/page.tsx`) - Week 2
5. **检查清单** (`app/checklist/page.tsx`) - Week 3
6. **心理分析** (`app/psychology/page.tsx`) - Week 3
7. **错误分析** (`app/errors/page.tsx`) - Week 4
8. **数据透视** (`app/pivot/page.tsx`) - Week 4

---

## ✅ 今天就可以开始的任务

### 任务1: 创建券商设置页面 (2小时)

```bash
cd /Users/chengzheng/workspace/chuangxin/zhixing_trader/zhixing_fronted
mkdir -p app/settings/brokers
touch app/settings/brokers/page.tsx
```

我马上为你生成完整的代码!

---

**优势总结**:
- ✅ 快速验证需求
- ✅ 随时调整UI
- ✅ 无需等待后端
- ✅ 更快的迭代周期
- ✅ 真实的用户体验

准备好了吗?我现在就为你生成第一个页面的完整代码! 🚀

